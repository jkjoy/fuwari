import{_ as kr}from"./preload-helper.BiBI96sQ.js";import{b as wr,c as br,s as $r,g as xr}from"./setting-utils.H_x_02w0.js";import{p as Cr,u as Sr}from"./url-utils.Co0GbPFH.js";import"./zh_TW.Cn8XYgkS.js";const In=new MutationObserver(Ti);function Ti(){In.disconnect();let e=Array.from(document.querySelectorAll("pre"));for(let t of e){if("DIV"===t.parentElement?.nodeName&&t.parentElement?.classList.contains("code-block"))continue;let e=document.createElement("div");e.className="relative code-block";let n=document.createElement("button");n.className="copy-btn btn-regular-dark absolute active:scale-90 h-8 w-8 top-2 right-2 opacity-75 text-sm p-1.5 rounded-lg transition-all ease-in-out",t.setAttribute("tabindex","0"),t.parentNode&&t.parentNode.insertBefore(e,t);let s,i='<svg class="copy-btn-icon copy-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M368.37-237.37q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-474.26q0-34.48 24.26-58.74 24.26-24.26 58.74-24.26h378.26q34.48 0 58.74 24.26 24.26 24.26 24.26 58.74v474.26q0 34.48-24.26 58.74-24.26 24.26-58.74 24.26H368.37Zm0-83h378.26v-474.26H368.37v474.26Zm-155 238q-34.48 0-58.74-24.26-24.26-24.26-24.26-58.74v-515.76q0-17.45 11.96-29.48 11.97-12.02 29.33-12.02t29.54 12.02q12.17 12.03 12.17 29.48v515.76h419.76q17.45 0 29.48 11.96 12.02 11.97 12.02 29.33t-12.02 29.54q-12.03 12.17-29.48 12.17H213.37Zm155-238v-474.26 474.26Z"/></svg>',o='<svg class="copy-btn-icon success-icon" xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="m389-377.13 294.7-294.7q12.58-12.67 29.52-12.67 16.93 0 29.61 12.67 12.67 12.68 12.67 29.53 0 16.86-12.28 29.14L419.07-288.41q-12.59 12.67-29.52 12.67-16.94 0-29.62-12.67L217.41-430.93q-12.67-12.68-12.79-29.45-.12-16.77 12.55-29.45 12.68-12.67 29.62-12.67 16.93 0 29.28 12.67L389-377.13Z"/></svg>';n.innerHTML=`<div>${i} ${o}</div>\n      `,e.appendChild(t),e.appendChild(n),n.addEventListener("click",(async()=>{s&&clearTimeout(s);let e=t?.querySelector("code")?.innerText;void 0!==e&&(await navigator.clipboard.writeText(e),n.classList.add("success"),s=setTimeout((()=>{n.classList.remove("success")}),1e3))}))}In.observe(document.body,{childList:!0,subtree:!0})}In.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("DOMContentLoaded",Ti);var Er=Object.defineProperty,Tr=Object.defineProperties,Lr=Object.getOwnPropertyDescriptors,Vt=Object.getOwnPropertySymbols,Li=Object.prototype.hasOwnProperty,Ai=Object.prototype.propertyIsEnumerable,Mn=(e,t,n)=>t in e?Er(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))Li.call(t,n)&&Mn(e,n,t[n]);if(Vt)for(var n of Vt(t))Ai.call(t,n)&&Mn(e,n,t[n]);return e},Fe=(e,t)=>Tr(e,Lr(t)),Ar=(e,t)=>{var n={};for(var s in e)Li.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&Vt)for(var s of Vt(e))t.indexOf(s)<0&&Ai.call(e,s)&&(n[s]=e[s]);return n},h=(e,t,n)=>Mn(e,"symbol"!=typeof t?t+"":t,n),G=(e,t,n)=>new Promise(((s,i)=>{var o=e=>{try{a(n.next(e))}catch(e){i(e)}},r=e=>{try{a(n.throw(e))}catch(e){i(e)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,r);a((n=n.apply(e,t)).next())}));class _r{constructor(e={}){h(this,"baseUrl","/api/v2"),h(this,"securityData",null),h(this,"securityWorker"),h(this,"abortControllers",new Map),h(this,"customFetch",((...e)=>fetch(...e))),h(this,"baseApiParams",{credentials:"same-origin",headers:{},redirect:"follow",referrerPolicy:"no-referrer"}),h(this,"setSecurityData",(e=>{this.securityData=e})),h(this,"contentFormatters",{"application/json":e=>null===e||"object"!=typeof e&&"string"!=typeof e?e:JSON.stringify(e),"text/plain":e=>null!==e&&"string"!=typeof e?JSON.stringify(e):e,"multipart/form-data":e=>Object.keys(e||{}).reduce(((t,n)=>{const s=e[n];return t.append(n,s instanceof Blob?s:"object"==typeof s&&null!==s?JSON.stringify(s):`${s}`),t}),new FormData),"application/x-www-form-urlencoded":e=>this.toQueryString(e)}),h(this,"createAbortSignal",(e=>{if(this.abortControllers.has(e)){const t=this.abortControllers.get(e);return t?t.signal:void 0}const t=new AbortController;return this.abortControllers.set(e,t),t.signal})),h(this,"abortRequest",(e=>{const t=this.abortControllers.get(e);t&&(t.abort(),this.abortControllers.delete(e))})),h(this,"request",(e=>G(this,null,(function*(){var t=e,{body:n,secure:s,path:i,type:o,query:r,format:a,baseUrl:l,cancelToken:c}=t,h=Ar(t,["body","secure","path","type","query","format","baseUrl","cancelToken"]);const d=("boolean"==typeof s?s:this.baseApiParams.secure)&&this.securityWorker&&(yield this.securityWorker(this.securityData))||{},u=this.mergeRequestParams(h,d),p=r&&this.toQueryString(r),m=this.contentFormatters[o||"application/json"],g=a||u.format;return this.customFetch(`${l||this.baseUrl||""}${i}${p?`?${p}`:""}`,Fe(y({},u),{headers:y(y({},u.headers||{}),o&&"multipart/form-data"!==o?{"Content-Type":o}:{}),signal:(c?this.createAbortSignal(c):u.signal)||null,body:typeof n>"u"||null===n?null:m(n)})).then((e=>G(this,null,(function*(){const t=e.clone();t.data=null,t.error=null;const n=g?yield e[g]().then((e=>(t.ok?t.data=e:t.error=e,t))).catch((e=>(t.error=e,t))):t;if(c&&this.abortControllers.delete(c),!e.ok)throw n;return n}))))})))),Object.assign(this,e)}encodeQueryParam(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent("number"==typeof t?t:`${t}`)}`}addQueryParam(e,t){return this.encodeQueryParam(t,e[t])}addArrayQueryParam(e,t){return e[t].map((e=>this.encodeQueryParam(t,e))).join("&")}toQueryString(e){const t=e||{};return Object.keys(t).filter((e=>typeof t[e]<"u")).map((e=>Array.isArray(t[e])?this.addArrayQueryParam(t,e):this.addQueryParam(t,e))).join("&")}addQueryParams(e){const t=this.toQueryString(e);return t?`?${t}`:""}mergeRequestParams(e,t){return Fe(y(y(y({},this.baseApiParams),e),t||{}),{headers:y(y(y({},this.baseApiParams.headers||{}),e.headers||{}),t&&t.headers||{})})}}let Pr=class extends _r{constructor(){super(...arguments),h(this,"auth",{loginByEmail:(e,t={})=>this.request(y({path:"/auth/email/login",method:"POST",body:e,type:"application/json",format:"json"},t)),registerByEmail:(e,t={})=>this.request(y({path:"/auth/email/register",method:"POST",body:e,type:"application/json",format:"json"},t)),sendVerifyEmail:(e,t={})=>this.request(y({path:"/auth/email/send",method:"POST",body:e,type:"application/json",format:"json"},t)),checkDataMerge:(e={})=>this.request(y({path:"/auth/merge",method:"GET",secure:!0,format:"json"},e)),applyDataMerge:(e,t={})=>this.request(y({path:"/auth/merge",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t))}),h(this,"cache",{flushCache:(e={})=>this.request(y({path:"/cache/flush",method:"POST",secure:!0,format:"json"},e)),warmUpCache:(e={})=>this.request(y({path:"/cache/warm_up",method:"POST",secure:!0,format:"json"},e))}),h(this,"captcha",{getCaptcha:(e={})=>this.request(y({path:"/captcha",method:"GET",format:"json"},e)),getCaptchaStatus:(e={})=>this.request(y({path:"/captcha/status",method:"GET",format:"json"},e)),verifyCaptcha:(e,t={})=>this.request(y({path:"/captcha/verify",method:"POST",body:e,type:"application/json",format:"json"},t))}),h(this,"comments",{getComments:(e,t={})=>this.request(y({path:"/comments",method:"GET",query:e,secure:!0,type:"application/json",format:"json"},t)),createComment:(e,t={})=>this.request(y({path:"/comments",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t)),getComment:(e,t={})=>this.request(y({path:`/comments/${e}`,method:"GET",type:"application/json",format:"json"},t)),updateComment:(e,t,n={})=>this.request(y({path:`/comments/${e}`,method:"PUT",body:t,secure:!0,type:"application/json",format:"json"},n)),deleteComment:(e,t={})=>this.request(y({path:`/comments/${e}`,method:"DELETE",secure:!0,format:"json"},t))}),h(this,"conf",{conf:(e={})=>this.request(y({path:"/conf",method:"GET",format:"json"},e)),getSocialLoginProviders:(e={})=>this.request(y({path:"/conf/auth/providers",method:"GET",format:"json"},e)),getDomain:(e,t={})=>this.request(y({path:"/conf/domain",method:"GET",query:e,format:"json"},t))}),h(this,"notifies",{getNotifies:(e,t={})=>this.request(y({path:"/notifies",method:"GET",query:e,type:"application/json",format:"json"},t)),markAllNotifyRead:(e,t={})=>this.request(y({path:"/notifies/read",method:"POST",body:e,type:"application/json",format:"json"},t)),markNotifyRead:(e,t,n={})=>this.request(y({path:`/notifies/${e}/${t}`,method:"POST",format:"json"},n))}),h(this,"pages",{getPages:(e,t={})=>this.request(y({path:"/pages",method:"GET",query:e,secure:!0,type:"application/json",format:"json"},t)),fetchAllPages:(e,t={})=>this.request(y({path:"/pages/fetch",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t)),getPageFetchStatus:(e={})=>this.request(y({path:"/pages/fetch/status",method:"GET",secure:!0,format:"json"},e)),logPv:(e,t={})=>this.request(y({path:"/pages/pv",method:"POST",body:e,type:"application/json",format:"json"},t)),updatePage:(e,t,n={})=>this.request(y({path:`/pages/${e}`,method:"PUT",body:t,secure:!0,type:"application/json",format:"json"},n)),deletePage:(e,t={})=>this.request(y({path:`/pages/${e}`,method:"DELETE",secure:!0,format:"json"},t)),fetchPage:(e,t={})=>this.request(y({path:`/pages/${e}/fetch`,method:"POST",secure:!0,type:"application/json",format:"json"},t))}),h(this,"sendEmail",{sendEmail:(e,t={})=>this.request(y({path:"/send_email",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t))}),h(this,"settings",{getSettings:(e={})=>this.request(y({path:"/settings",method:"GET",secure:!0,format:"json"},e)),applySettings:(e,t={})=>this.request(y({path:"/settings",method:"PUT",body:e,secure:!0,type:"application/json",format:"json"},t)),getSettingsTemplate:(e,t={})=>this.request(y({path:`/settings/template/${e}`,method:"GET",secure:!0,format:"json"},t))}),h(this,"sites",{getSites:(e={})=>this.request(y({path:"/sites",method:"GET",secure:!0,format:"json"},e)),createSite:(e,t={})=>this.request(y({path:"/sites",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t)),updateSite:(e,t,n={})=>this.request(y({path:`/sites/${e}`,method:"PUT",body:t,secure:!0,type:"application/json",format:"json"},n)),deleteSite:(e,t={})=>this.request(y({path:`/sites/${e}`,method:"DELETE",secure:!0,format:"json"},t))}),h(this,"stats",{getStats:(e,t,n={})=>this.request(y({path:`/stats/${e}`,method:"GET",query:t,type:"application/json",format:"json"},n))}),h(this,"transfer",{exportArtrans:(e={})=>this.request(y({path:"/transfer/export",method:"GET",secure:!0,format:"json"},e)),importArtrans:(e,t={})=>this.request(y({path:"/transfer/import",method:"POST",body:e,secure:!0,type:"application/json"},t)),uploadArtrans:(e,t={})=>this.request(y({path:"/transfer/upload",method:"POST",body:e,secure:!0,type:"multipart/form-data",format:"json"},t))}),h(this,"upload",{upload:(e,t={})=>this.request(y({path:"/upload",method:"POST",body:e,secure:!0,type:"multipart/form-data",format:"json"},t))}),h(this,"user",{getUser:(e,t={})=>this.request(y({path:"/user",method:"GET",query:e,secure:!0,format:"json"},t)),updateProfile:(e,t={})=>this.request(y({path:"/user",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t)),login:(e,t={})=>this.request(y({path:"/user/access_token",method:"POST",body:e,type:"application/json",format:"json"},t)),getUserStatus:(e,t={})=>this.request(y({path:"/user/status",method:"GET",query:e,secure:!0,format:"json"},t))}),h(this,"users",{createUser:(e,t={})=>this.request(y({path:"/users",method:"POST",body:e,secure:!0,type:"application/json",format:"json"},t)),updateUser:(e,t,n={})=>this.request(y({path:`/users/${e}`,method:"PUT",body:t,secure:!0,type:"application/json",format:"json"},n)),deleteUser:(e,t={})=>this.request(y({path:`/users/${e}`,method:"DELETE",secure:!0,format:"json"},t)),getUsers:(e,t,n={})=>this.request(y({path:`/users/${e}`,method:"GET",query:t,secure:!0,type:"application/json",format:"json"},n))}),h(this,"version",{getVersion:(e={})=>this.request(y({path:"/version",method:"GET",format:"json"},e))}),h(this,"votes",{syncVotes:(e={})=>this.request(y({path:"/votes/sync",method:"POST",secure:!0,format:"json"},e)),vote:(e,t,n,s={})=>this.request(y({path:`/votes/${e}/${t}`,method:"POST",body:n,type:"application/json",format:"json"},s))})}};const _i=(e,t,n)=>G(void 0,null,(function*(){const s=e.getApiToken&&e.getApiToken(),i=new Headers(y({Authorization:s?`Bearer ${s}`:""},n?.headers));i.get("Authorization")||i.delete("Authorization");const o=yield fetch(t,Fe(y({},n),{headers:i}));if(!o.ok){const s=(yield o.json().catch((()=>{})))||{};let i=!1;if(e.handlers&&(yield e.handlers.get().reduce(((e,t)=>G(void 0,null,(function*(){yield e,!0===s[t.action]&&(yield t.handler(s),i=!0)}))),Promise.resolve())),i)return _i(e,t,n);throw Mr(o.status,s)}return o}));class Ir extends Error{constructor(){super(...arguments),h(this,"code",0),h(this,"message","fetch error"),h(this,"data")}}function Mr(e,t){const n=new Ir;return n.message=t.msg||t.message||"fetch error",n.code=e,n.data=t,console.error(n),n}function Or(){const e=[];return{add:(t,n)=>{e.push({action:t,handler:n})},remove:t=>{const n=e.findIndex((e=>e.action===t));-1!==n&&e.splice(n,1)},get:()=>e}}class Pi extends Pr{constructor(e){super({baseUrl:e.baseURL,customFetch:(t,n)=>_i(e,t,n)}),h(this,"_opts"),this._opts=e}getUserFields(){const e=this._opts.userInfo;if(e?.name&&e?.email)return{name:e.name,email:e.email}}}function as(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let tt=as();function Ii(e){tt=e}const Mi=/[&<>"']/,Rr=new RegExp(Mi.source,"g"),Oi=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Dr=new RegExp(Oi.source,"g"),Br={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Us=e=>Br[e];function $e(e,t){if(t){if(Mi.test(e))return e.replace(Rr,Us)}else if(Oi.test(e))return e.replace(Dr,Us);return e}const qr=/(^|[^\[])\^/g;function te(e,t){let n="string"==typeof e?e:e.source;t=t||"";const s={replace:(e,t)=>{let i="string"==typeof t?t:t.source;return i=i.replace(qr,"$1"),n=n.replace(e,i),s},getRegex:()=>new RegExp(n,t)};return s}function Fs(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch{return null}return e}const wt={exec:()=>null};function zs(e,t){const n=e.replace(/\|/g,((e,t,n)=>{let s=!1,i=t;for(;--i>=0&&"\\"===n[i];)s=!s;return s?"|":" |"})).split(/ \|/);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(/\\\|/g,"|");return n}function gt(e,t,n){const s=e.length;if(0===s)return"";let i=0;for(;i<s;){const o=e.charAt(s-i-1);if(o!==t||n){if(o===t||!n)break;i++}else i++}return e.slice(0,s-i)}function Ur(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let s=0;s<e.length;s++)if("\\"===e[s])s++;else if(e[s]===t[0])n++;else if(e[s]===t[1]&&(n--,n<0))return s;return-1}function Hs(e,t,n,s){const i=t.href,o=t.title?$e(t.title):null,r=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){s.state.inLink=!0;const e={type:"link",raw:n,href:i,title:o,text:r,tokens:s.inlineTokens(r)};return s.state.inLink=!1,e}return{type:"image",raw:n,href:i,title:o,text:$e(r)}}function Fr(e,t){const n=e.match(/^(\s+)(?:```)/);if(null===n)return t;const s=n[1];return t.split("\n").map((e=>{const t=e.match(/^\s+/);if(null===t)return e;const[n]=t;return n.length>=s.length?e.slice(s.length):e})).join("\n")}class Gt{constructor(e){h(this,"options"),h(this,"rules"),h(this,"lexer"),this.options=e||tt}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(/^(?: {1,4}| {0,3}\t)/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:gt(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=Fr(e,t[3]||"");return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(/#$/.test(e)){const t=gt(e,"#");(this.options.pedantic||!t||/ $/.test(t))&&(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:gt(t[0],"\n")}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let e=gt(t[0],"\n").split("\n"),n="",s="";const i=[];for(;e.length>0;){let t=!1;const o=[];let r;for(r=0;r<e.length;r++)if(/^ {0,3}>/.test(e[r]))o.push(e[r]),t=!0;else{if(t)break;o.push(e[r])}e=e.slice(r);const a=o.join("\n"),l=a.replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,"\n    $1").replace(/^ {0,3}>[ \t]?/gm,"");n=n?`${n}\n${a}`:a,s=s?`${s}\n${l}`:l;const c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,i,!0),this.lexer.state.top=c,0===e.length)break;const h=i[i.length-1];if("code"===h?.type)break;if("blockquote"===h?.type){const t=h,o=t.raw+"\n"+e.join("\n"),r=this.blockquote(o);i[i.length-1]=r,n=n.substring(0,n.length-t.raw.length)+r.raw,s=s.substring(0,s.length-t.text.length)+r.text;break}if("list"!==h?.type);else{const t=h,o=t.raw+"\n"+e.join("\n"),r=this.list(o);i[i.length-1]=r,n=n.substring(0,n.length-h.raw.length)+r.raw,s=s.substring(0,s.length-t.raw.length)+r.raw,e=o.substring(i[i.length-1].raw.length).split("\n")}}return{type:"blockquote",raw:n,tokens:i,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,i={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const o=new RegExp(`^( {0,3}${n})((?:[\t ][^\\n]*)?(?:\\n|$))`);let r=!1;for(;e;){let n=!1,s="",a="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;s=t[0],e=e.substring(s.length);let l=t[2].split("\n",1)[0].replace(/^\t+/,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],h=!l.trim(),d=0;if(this.options.pedantic?(d=2,a=l.trimStart()):h?d=t[1].length+1:(d=t[2].search(/[^ ]/),d=d>4?1:d,a=l.slice(d),d+=t[1].length),h&&/^[ \t]*$/.test(c)&&(s+=c+"\n",e=e.substring(c.length+1),n=!0),!n){const t=new RegExp(`^ {0,${Math.min(3,d-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),n=new RegExp(`^ {0,${Math.min(3,d-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),i=new RegExp(`^ {0,${Math.min(3,d-1)}}(?:\`\`\`|~~~)`),o=new RegExp(`^ {0,${Math.min(3,d-1)}}#`),r=new RegExp(`^ {0,${Math.min(3,d-1)}}<[a-z].*>`,"i");for(;e;){const u=e.split("\n",1)[0];let p;if(c=u,this.options.pedantic?(c=c.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  "),p=c):p=c.replace(/\t/g,"    "),i.test(c)||o.test(c)||r.test(c)||t.test(c)||n.test(c))break;if(p.search(/[^ ]/)>=d||!c.trim())a+="\n"+p.slice(d);else{if(h||l.replace(/\t/g,"    ").search(/[^ ]/)>=4||i.test(l)||o.test(l)||n.test(l))break;a+="\n"+c}!h&&!c.trim()&&(h=!0),s+=u+"\n",e=e.substring(u.length+1),l=p.slice(d)}}i.loose||(r?i.loose=!0:/\n[ \t]*\n[ \t]*$/.test(s)&&(r=!0));let u,p=null;this.options.gfm&&(p=/^\[[ xX]\] /.exec(a),p&&(u="[ ] "!==p[0],a=a.replace(/^\[[ xX]\] +/,""))),i.items.push({type:"list_item",raw:s,task:!!p,checked:u,loose:!1,text:a,tokens:[]}),i.raw+=s}i.items[i.items.length-1].raw=i.items[i.items.length-1].raw.trimEnd(),i.items[i.items.length-1].text=i.items[i.items.length-1].text.trimEnd(),i.raw=i.raw.trimEnd();for(let e=0;e<i.items.length;e++)if(this.lexer.state.top=!1,i.items[e].tokens=this.lexer.blockTokens(i.items[e].text,[]),!i.loose){const t=i.items[e].tokens.filter((e=>"space"===e.type)),n=t.length>0&&t.some((e=>/\n.*\n/.test(e.raw)));i.loose=n}if(i.loose)for(let e=0;e<i.items.length;e++)i.items[e].loose=!0;return i}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(/\s+/g," "),n=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const n=zs(t[1]),s=t[2].replace(/^\||\| *$/g,"").split("|"),i=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split("\n"):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const e of s)/^ *-+: *$/.test(e)?o.align.push("right"):/^ *:-+: *$/.test(e)?o.align.push("center"):/^ *:-+ *$/.test(e)?o.align.push("left"):o.align.push(null);for(let e=0;e<n.length;e++)o.header.push({text:n[e],tokens:this.lexer.inline(n[e]),header:!0,align:o.align[e]});for(const e of i)o.rows.push(zs(e,o.header.length).map(((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:o.align[t]}))));return o}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:$e(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&/^</.test(e)){if(!/>$/.test(e))return;const t=gt(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=Ur(t[2],"()");if(e>-1){const n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],s="";if(this.options.pedantic){const e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n);e&&(n=e[1],s=e[3])}else s=t[3]?t[3].slice(1,-1):"";return n=n.trim(),/^</.test(n)&&(n=this.options.pedantic&&!/>$/.test(e)?n.slice(1):n.slice(1,-1)),Hs(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const e=t[(n[2]||n[1]).replace(/\s+/g," ").toLowerCase()];if(!e){const e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return Hs(n,e,n[0],this.lexer)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!(!s||s[3]&&n.match(/[\p{L}\p{N}]/u))&&(!s[1]&&!s[2]||!n||this.rules.inline.punctuation.exec(n))){const n=[...s[0]].length-1;let i,o,r=n,a=0;const l="*"===s[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+n);null!=(s=l.exec(t));){if(i=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!i)continue;if(o=[...i].length,s[3]||s[4]){r+=o;continue}if((s[5]||s[6])&&n%3&&!((n+o)%3)){a+=o;continue}if(r-=o,r>0)continue;o=Math.min(o,o+r+a);const t=[...s[0]][0].length,l=e.slice(0,n+s.index+t+o);if(Math.min(n,o)%2){const e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}const c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(/\n/g," ");const n=/[^ ]/.test(e),s=/^ /.test(e)&&/ $/.test(e);return n&&s&&(e=e.substring(1,e.length-1)),e=$e(e,!0),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=$e(t[1]),n="mailto:"+e):(e=$e(t[1]),n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){var t,n;let s;if(s=this.rules.inline.url.exec(e)){let e,i;if("@"===s[2])e=$e(s[0]),i="mailto:"+e;else{let o;do{o=s[0],s[0]=null!=(n=null==(t=this.rules.inline._backpedal.exec(s[0]))?void 0:t[0])?n:""}while(o!==s[0]);e=$e(s[0]),i="www."===s[1]?"http://"+s[0]:s[0]}return{type:"link",raw:s[0],text:e,href:i,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let e;return e=this.lexer.state.inRawBlock?t[0]:$e(t[0]),{type:"text",raw:t[0],text:e}}}}const zr=/^(?:[ \t]*(?:\n|$))+/,Hr=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Nr=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Et=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,jr=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Ri=/(?:[*+-]|\d{1,9}[.)])/,Di=te(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Ri).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),ls=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Wr=/^[^\n]+/,cs=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Vr=te(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",cs).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Gr=te(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Ri).getRegex(),ln="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ds=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Kr=te("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",ds).replace("tag",ln).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Bi=te(ls).replace("hr",Et).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ln).getRegex(),Zr=te(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Bi).getRegex(),hs={blockquote:Zr,code:Hr,def:Vr,fences:Nr,heading:jr,hr:Et,html:Kr,lheading:Di,list:Gr,newline:zr,paragraph:Bi,table:wt,text:Wr},Ns=te("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Et).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ln).getRegex(),Qr=Fe(y({},hs),{table:Ns,paragraph:te(ls).replace("hr",Et).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ns).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ln).getRegex()}),Yr=Fe(y({},hs),{html:te("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",ds).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:wt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:te(ls).replace("hr",Et).replace("heading"," *#{1,6} *[^\n]").replace("lheading",Di).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()}),qi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Xr=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Ui=/^( {2,}|\\)\n(?!\s*$)/,Jr=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Tt="\\p{P}\\p{S}",ea=te(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Tt).getRegex(),ta=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,na=te(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Tt).getRegex(),sa=te("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Tt).getRegex(),ia=te("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Tt).getRegex(),oa=te(/\\([punct])/,"gu").replace(/punct/g,Tt).getRegex(),ra=te(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),aa=te(ds).replace("(?:--\x3e|$)","--\x3e").getRegex(),la=te("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",aa).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Kt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ca=te(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Kt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Fi=te(/^!?\[(label)\]\[(ref)\]/).replace("label",Kt).replace("ref",cs).getRegex(),zi=te(/^!?\[(ref)\](?:\[\])?/).replace("ref",cs).getRegex(),da=te("reflink|nolink(?!\\()","g").replace("reflink",Fi).replace("nolink",zi).getRegex(),us={_backpedal:wt,anyPunctuation:oa,autolink:ra,blockSkip:ta,br:Ui,code:Xr,del:wt,emStrongLDelim:na,emStrongRDelimAst:sa,emStrongRDelimUnd:ia,escape:qi,link:ca,nolink:zi,punctuation:ea,reflink:Fi,reflinkSearch:da,tag:la,text:Jr,url:wt},ha=Fe(y({},us),{link:te(/^!?\[(label)\]\((.*?)\)/).replace("label",Kt).getRegex(),reflink:te(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Kt).getRegex()}),On=Fe(y({},us),{escape:te(qi).replace("])","~|])").getRegex(),url:te(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),ua=Fe(y({},On),{br:te(Ui).replace("{2,}","*").getRegex(),text:te(On.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),qt={normal:hs,gfm:Qr,pedantic:Yr},yt={normal:us,gfm:On,breaks:ua,pedantic:ha};class Le{constructor(e){h(this,"tokens"),h(this,"options"),h(this,"state"),h(this,"tokenizer"),h(this,"inlineQueue"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||tt,this.options.tokenizer=this.options.tokenizer||new Gt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:qt.normal,inline:yt.normal};this.options.pedantic?(t.block=qt.pedantic,t.inline=yt.pedantic):this.options.gfm&&(t.block=qt.gfm,this.options.breaks?t.inline=yt.breaks:t.inline=yt.gfm),this.tokenizer.rules=t}static get rules(){return{block:qt,inline:yt}}static lex(e,t){return new Le(t).lex(e)}static lexInline(e,t){return new Le(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){let s,i,o;for(this.options.pedantic&&(e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some((n=>!!(s=n.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))){if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length),1===s.raw.length&&t.length>0?t[t.length-1].raw+="\n":t.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length),i=t[t.length-1],!i||"paragraph"!==i.type&&"text"!==i.type?t.push(s):(i.raw+="\n"+s.raw,i.text+="\n"+s.text,this.inlineQueue[this.inlineQueue.length-1].src=i.text);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length),i=t[t.length-1],!i||"paragraph"!==i.type&&"text"!==i.type?this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title}):(i.raw+="\n"+s.raw,i.text+="\n"+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=i.text);continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(o=e,this.options.extensions&&this.options.extensions.startBlock){let t=1/0;const n=e.slice(1);let s;this.options.extensions.startBlock.forEach((e=>{s=e.call({lexer:this},n),"number"==typeof s&&s>=0&&(t=Math.min(t,s))})),t<1/0&&t>=0&&(o=e.substring(0,t+1))}if(this.state.top&&(s=this.tokenizer.paragraph(o))){i=t[t.length-1],n&&"paragraph"===i?.type?(i.raw+="\n"+s.raw,i.text+="\n"+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(s),n=o.length!==e.length,e=e.substring(s.raw.length);continue}if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length),i=t[t.length-1],i&&"text"===i.type?(i.raw+="\n"+s.raw,i.text+="\n"+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):t.push(s);continue}if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n,s,i,o,r,a,l=e;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(o=this.tokenizer.rules.inline.reflinkSearch.exec(l));)e.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(l=l.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(o=this.tokenizer.rules.inline.blockSkip.exec(l));)l=l.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(o=this.tokenizer.rules.inline.anyPunctuation.exec(l));)l=l.slice(0,o.index)+"++"+l.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(r||(a=""),r=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some((s=>!!(n=s.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),s=t[t.length-1],s&&"text"===n.type&&"text"===s.type?(s.raw+=n.raw,s.text+=n.text):t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),s=t[t.length-1],s&&"text"===n.type&&"text"===s.type?(s.raw+=n.raw,s.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,l,a)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),t.push(n);continue}if(i=e,this.options.extensions&&this.options.extensions.startInline){let t=1/0;const n=e.slice(1);let s;this.options.extensions.startInline.forEach((e=>{s=e.call({lexer:this},n),"number"==typeof s&&s>=0&&(t=Math.min(t,s))})),t<1/0&&t>=0&&(i=e.substring(0,t+1))}if(n=this.tokenizer.inlineText(i)){e=e.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(a=n.raw.slice(-1)),r=!0,s=t[t.length-1],s&&"text"===s.type?(s.raw+=n.raw,s.text+=n.text):t.push(n);continue}if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return t}}class Zt{constructor(e){h(this,"options"),h(this,"parser"),this.options=e||tt}space(e){return""}code({text:e,lang:t,escaped:n}){var s;const i=null==(s=(t||"").match(/^\S*/))?void 0:s[0],o=e.replace(/\n$/,"")+"\n";return i?'<pre><code class="language-'+$e(i)+'">'+(n?o:$e(o,!0))+"</code></pre>\n":"<pre><code>"+(n?o:$e(o,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){const t=e.ordered,n=e.start;let s="";for(let t=0;t<e.items.length;t++){const n=e.items[t];s+=this.listitem(n)}const i=t?"ol":"ul";return"<"+i+(t&&1!==n?' start="'+n+'"':"")+">\n"+s+"</"+i+">\n"}listitem(e){let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?e.tokens.length>0&&"paragraph"===e.tokens[0].type?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=n+" "+e.tokens[0].tokens[0].text)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" "}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",n="";for(let t=0;t<e.header.length;t++)n+=this.tablecell(e.header[t]);t+=this.tablerow({text:n});let s="";for(let t=0;t<e.rows.length;t++){const i=e.rows[t];n="";for(let e=0;e<i.length;e++)n+=this.tablecell(i[e]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+s+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${e}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),i=Fs(e);if(null===i)return s;let o='<a href="'+(e=i)+'"';return t&&(o+=' title="'+t+'"'),o+=">"+s+"</a>",o}image({href:e,title:t,text:n}){const s=Fs(e);if(null===s)return n;let i=`<img src="${e=s}" alt="${n}"`;return t&&(i+=` title="${t}"`),i+=">",i}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):e.text}}class ps{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class Ae{constructor(e){h(this,"options"),h(this,"renderer"),h(this,"textRenderer"),this.options=e||tt,this.options.renderer=this.options.renderer||new Zt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ps}static parse(e,t){return new Ae(t).parse(e)}static parseInline(e,t){return new Ae(t).parseInline(e)}parse(e,t=!0){let n="";for(let s=0;s<e.length;s++){const i=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){const e=i,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}const o=i;switch(o.type){case"space":n+=this.renderer.space(o);continue;case"hr":n+=this.renderer.hr(o);continue;case"heading":n+=this.renderer.heading(o);continue;case"code":n+=this.renderer.code(o);continue;case"table":n+=this.renderer.table(o);continue;case"blockquote":n+=this.renderer.blockquote(o);continue;case"list":n+=this.renderer.list(o);continue;case"html":n+=this.renderer.html(o);continue;case"paragraph":n+=this.renderer.paragraph(o);continue;case"text":{let i=o,r=this.renderer.text(i);for(;s+1<e.length&&"text"===e[s+1].type;)i=e[++s],r+="\n"+this.renderer.text(i);n+=t?this.renderer.paragraph({type:"paragraph",raw:r,text:r,tokens:[{type:"text",raw:r,text:r}]}):r;continue}default:{const e='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}parseInline(e,t){t=t||this.renderer;let n="";for(let s=0;s<e.length;s++){const i=e[s];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){const e=this.options.extensions.renderers[i.type].call({parser:this},i);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){n+=e||"";continue}}const o=i;switch(o.type){case"escape":case"text":n+=t.text(o);break;case"html":n+=t.html(o);break;case"link":n+=t.link(o);break;case"image":n+=t.image(o);break;case"strong":n+=t.strong(o);break;case"em":n+=t.em(o);break;case"codespan":n+=t.codespan(o);break;case"br":n+=t.br(o);break;case"del":n+=t.del(o);break;default:{const e='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}}class bt{constructor(e){h(this,"options"),h(this,"block"),this.options=e||tt}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?Le.lex:Le.lexInline}provideParser(){return this.block?Ae.parse:Ae.parseInline}}h(bt,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class Rn{constructor(...e){h(this,"defaults",as()),h(this,"options",this.setOptions),h(this,"parse",this.parseMarkdown(!0)),h(this,"parseInline",this.parseMarkdown(!1)),h(this,"Parser",Ae),h(this,"Renderer",Zt),h(this,"TextRenderer",ps),h(this,"Lexer",Le),h(this,"Tokenizer",Gt),h(this,"Hooks",bt),this.use(...e)}walkTokens(e,t){var n,s;let i=[];for(const o of e)switch(i=i.concat(t.call(this,o)),o.type){case"table":{const e=o;for(const n of e.header)i=i.concat(this.walkTokens(n.tokens,t));for(const n of e.rows)for(const e of n)i=i.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=o;i=i.concat(this.walkTokens(e.items,t));break}default:{const e=o;null!=(s=null==(n=this.defaults.extensions)?void 0:n.childTokens)&&s[e.type]?this.defaults.extensions.childTokens[e.type].forEach((n=>{const s=e[n].flat(1/0);i=i.concat(this.walkTokens(s,t))})):e.tokens&&(i=i.concat(this.walkTokens(e.tokens,t)))}}return i}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const n=y({},e);if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let s=e.renderer.apply(this,t);return!1===s&&(s=n.apply(this,t)),s}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),n.extensions=t),e.renderer){const t=this.defaults.renderer||new Zt(this.defaults);for(const n in e.renderer){if(!(n in t))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;const s=n,i=e.renderer[s],o=t[s];t[s]=(...e)=>{let n=i.apply(t,e);return!1===n&&(n=o.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new Gt(this.defaults);for(const n in e.tokenizer){if(!(n in t))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const s=n,i=e.tokenizer[s],o=t[s];t[s]=(...e)=>{let n=i.apply(t,e);return!1===n&&(n=o.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new bt;for(const n in e.hooks){if(!(n in t))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;const s=n,i=e.hooks[s],o=t[s];bt.passThroughHooks.has(n)?t[s]=e=>{if(this.defaults.async)return Promise.resolve(i.call(t,e)).then((e=>o.call(t,e)));const n=i.call(t,e);return o.call(t,n)}:t[s]=(...e)=>{let n=i.apply(t,e);return!1===n&&(n=o.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,s=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(s.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults=y(y({},this.defaults),n)})),this}setOptions(e){return this.defaults=y(y({},this.defaults),e),this}lexer(e,t){return Le.lex(e,t??this.defaults)}parser(e,t){return Ae.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{const s=y({},n),i=y(y({},this.defaults),s),o=this.onError(!!i.silent,!!i.async);if(!0===this.defaults.async&&!1===s.async)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||null===t)return o(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=e);const r=i.hooks?i.hooks.provideLexer():e?Le.lex:Le.lexInline,a=i.hooks?i.hooks.provideParser():e?Ae.parse:Ae.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then((e=>r(e,i))).then((e=>i.hooks?i.hooks.processAllTokens(e):e)).then((e=>i.walkTokens?Promise.all(this.walkTokens(e,i.walkTokens)).then((()=>e)):e)).then((e=>a(e,i))).then((e=>i.hooks?i.hooks.postprocess(e):e)).catch(o);try{i.hooks&&(t=i.hooks.preprocess(t));let e=r(t,i);i.hooks&&(e=i.hooks.processAllTokens(e)),i.walkTokens&&this.walkTokens(e,i.walkTokens);let n=a(e,i);return i.hooks&&(n=i.hooks.postprocess(n)),n}catch(e){return o(e)}}}onError(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+$e(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}}const Je=new Rn;function J(e,t){return Je.parse(e,t)}J.options=J.setOptions=function(e){return Je.setOptions(e),J.defaults=Je.defaults,Ii(J.defaults),J},J.getDefaults=as,J.defaults=tt,J.use=function(...e){return Je.use(...e),J.defaults=Je.defaults,Ii(J.defaults),J},J.walkTokens=function(e,t){return Je.walkTokens(e,t)},J.parseInline=Je.parseInline,J.Parser=Ae,J.parser=Ae.parse,J.Renderer=Zt,J.TextRenderer=ps,J.Lexer=Le,J.lexer=Le.lex,J.Tokenizer=Gt,J.Hooks=bt,J.parse=J,J.options,J.setOptions,J.use,J.walkTokens,J.parseInline,Ae.parse,Le.lex;var pa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fa={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ma={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ga=/(&amp;|&lt;|&gt;|&quot;|&#39;)/g,ya=/[&<>"']/g;function va(e){return fa[e]}function ka(e){return ma[e]}function Dn(e){return null==e?"":String(e).replace(ya,va)}function Bn(e){return null==e?"":String(e).replace(ga,ka)}Dn.options=Bn.options={};var Ni={encode:Dn,escape:Dn,decode:Bn,unescape:Bn,version:"1.0.0-browser"};function ji(e){for(var t,n,s=Array.prototype.slice.call(arguments,1);s.length;)for(n in t=s.shift())t.hasOwnProperty(n)&&("[object Object]"===Object.prototype.toString.call(e[n])?e[n]=ji(e[n],t[n]):e[n]=t[n]);return e}var wa=ji,Wi=function(e){return"string"==typeof e?e.toLowerCase():e};function ba(e){return e.reduce($a,{})}function $a(e,t){return e[t]=!0,e}var Vi=ba,xa=Vi,Ca=["background","base","cite","href","longdesc","src","usemap"],Sa={uris:xa(Ca)},Ea=Vi,Ta=["area","br","col","hr","img","wbr","input","base","basefont","link","meta"],Gi={voids:Ea(Ta)},La=Ni,js=Wi,Aa=Gi,_a=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,Pa=/^<\s*\/\s*([\w:-]+)[^>]*>/,Ia=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,Ma=/^</,Oa=/^<\s*\//;function Ra(){var e=[];return e.lastItem=function(){return e[e.length-1]},e}function Da(e,t){for(var n,s=Ra(),i=e;e;)o();function o(){n=!0,"\x3c!--"===e.substr(0,4)?function(){var s=e.indexOf("--\x3e");s>=0&&(t.comment&&t.comment(e.substring(4,s)),e=e.substring(s+3),n=!1)}():Oa.test(e)?r(Pa,l):Ma.test(e)&&r(_a,a),function(){if(n){var s,i=e.indexOf("<");i>=0?(s=e.substring(0,i),e=e.substring(i)):(s=e,e=""),t.chars&&t.chars(s)}}();var s=e===i;i=e,s&&(e="")}function r(t,s){var i=e.match(t);i&&(e=e.substring(i[0].length),i[0].replace(t,s),n=!1)}function a(e,n,i,o){var r={},a=js(n),l=Aa.voids[a]||!!o;i.replace(Ia,(function(e,t,n,s,i){r[t]=void 0===n&&void 0===s&&void 0===i?void 0:La.decode(n||s||i||"")})),l||s.push(a),t.start&&t.start(a,r,l)}function l(e,n){var i,o=0,r=js(n);if(r)for(o=s.length-1;o>=0&&s[o]!==r;o--);if(o>=0){for(i=s.length-1;i>=o;i--)t.end&&t.end(s[i]);s.length=o}}l()}var Ba=Da,qa=Ni,$n=Wi,Ua=Sa,Fa=Gi;function za(e,t){var n,s=t||{};return r(),{start:function(e,t,r){var a=$n(e);if(n.ignoring)return void o(a);if(-1===(s.allowedTags||[]).indexOf(a))return void o(a);if(s.filter&&!s.filter({tag:a,attrs:t}))return void o(a);i("<"),i(a),Object.keys(t).forEach((function(e){var n,o=t[e],r=(s.allowedClasses||{})[a]||[],l=(s.allowedAttributes||{})[a]||[],c=$n(e);n="class"===c&&-1===l.indexOf(c)?(o=o.split(" ").filter((function(e){return r&&-1!==r.indexOf(e)})).join(" ").trim()).length:-1!==l.indexOf(c)&&(!0!==Ua.uris[c]||function(e){var t=e[0];if("#"===t||"/"===t)return!0;var n=e.indexOf(":");if(-1===n)return!0;var i=e.indexOf("?");if(-1!==i&&n>i)return!0;var o=e.indexOf("#");return-1!==o&&n>o||s.allowedSchemes.some(r);function r(t){return 0===e.indexOf(t+":")}}(o)),n&&(i(" "),i(e),"string"==typeof o&&(i('="'),i(qa.encode(o)),i('"')))})),i(r?"/>":">")},end:function(e){var t=$n(e);-1!==(s.allowedTags||[]).indexOf(t)&&!1===n.ignoring?(i("</"),i(t),i(">")):function(e){n.ignoring===e&&--n.depth<=0&&r()}(t)},chars:function(e){!1===n.ignoring&&i(s.transformText?s.transformText(e):e)}};function i(t){e.push(t)}function o(e){Fa.voids[e]||(!1===n.ignoring?n={ignoring:e,depth:1}:n.ignoring===e&&n.depth++)}function r(){n={ignoring:!1,depth:0}}}var Ha=za,Na={allowedAttributes:{a:["href","name","target","title","aria-label"],iframe:["allowfullscreen","frameborder","src"],img:["src","alt","title","aria-label"]},allowedClasses:{},allowedSchemes:["http","https","mailto"],allowedTags:["a","abbr","article","b","blockquote","br","caption","code","del","details","div","em","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","li","main","mark","ol","p","pre","section","span","strike","strong","sub","summary","sup","table","tbody","td","th","thead","tr","u","ul"],filter:null},ja=Na,Wa=wa,Va=Ba,Ga=Ha,Ki=ja;function Zi(e,t,n){var s=[],i=!0===n?t:Wa({},Ki,t),o=Ga(s,i);return Va(e,o),s.join("")}Zi.defaults=Ki;var Ka=Zi;const Za=Hi(Ka),Qa={allowedClasses:{},allowedSchemes:["http","https","mailto","data"],allowedTags:["a","abbr","article","b","blockquote","br","caption","code","del","details","div","em","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","li","main","mark","ol","p","pre","section","span","strike","strong","sub","summary","sup","table","tbody","td","th","thead","tr","u","ul"],allowedAttributes:{"*":["title","accesskey"],a:["href","name","target","aria-label","rel"],img:["src","alt","title","atk-emoticon","aria-label","data-src","class","loading"],code:["class"],span:["class","style"]},filter:e=>([["code",/^hljs\W+language-(.*)$/],["span",/^(hljs-.*)$/],["img",/^lazyload$/]].forEach((([t,n])=>{e.tag===t&&e.attrs.class&&!n.test(e.attrs.class)&&delete e.attrs.class})),"span"===e.tag&&e.attrs.style&&!/^color:(\W+)?#[0-9a-f]{3,6};?$/i.test(e.attrs.style)&&delete e.attrs.style,!0)};function Qi(e){return Za(e,Qa)}var Yi={exports:{}};Yi.exports=function(){function e(e,t){return e(t={exports:{}},t.exports),t.exports}var t=e((function(e){var t=e.exports=function(){return new RegExp("(?:"+t.line().source+")|(?:"+t.block().source+")","gm")};t.line=function(){return/(?:^|\s)\/\/(.+?)$/gm},t.block=function(){return/\/\*([\S\s]*?)\*\//gm}})),n=["23AC69","91C132","F19726","E8552D","1AAB8E","E1147F","2980C1","1BA1E6","9FA0A0","F19726","E30B20","E30B20","A3338B"],s=function(e,s){void 0===s&&(s={});var o=s.colors;void 0===o&&(o=n);var r=0,a={},l=new RegExp("("+/[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af\u0400-\u04FF]+|\w+/.source+"|"+/</.source+")|("+t().source+")","gmi");return e.replace(l,(function(e,t,n){if(n)return i(n);if("<"===t)return"&lt;";var s;a[t]?s=a[t]:(s=o[r],a[t]=s);var l='<span style="color: #'+s+'">'+t+"</span>";return r=++r%o.length,l}))};function i(e){return'<span style="color: slategray">'+e+"</span>"}return s}();var Ya=Yi.exports;const Xa=Hi(Ya);function Xi(e){return Xa(e)}function Ja(e){const t=new J.Renderer;return t.link=el(t,t.link),t.code=tl(),t.image=nl(t,t.image,e),t}const el=(e,t)=>n=>{const s=(e=>{try{return new URL(e).origin}catch{return""}})(n.href)===window.location.origin;return t.call(e,n).replace(/^<a /,`<a target="_blank" ${s?"":'rel="noreferrer noopener nofollow"'} `)},tl=()=>({lang:e,text:t})=>{const n=e||"plaintext";let s=t;return window.hljs?n&&window.hljs.getLanguage(n)&&(s=window.hljs.highlight(n,t).value):s=Xi(t),`<pre rel="${n}">\n<code class="hljs language-${n}">${s.replace(/&amp;/g,"&")}</code>\n</pre>`},nl=(e,t,{imgLazyLoad:n})=>s=>{const i=t.call(e,s);return n?"native"===n||!0===n?i.replace(/^<img /,'<img class="lazyload" loading="lazy" '):"data-src"===n?i.replace(/^<img /,'<img class="lazyload" ').replace("src=","data-src="):i:i};let Ji,eo=[];const sl={gfm:!0,breaks:!0,async:!1};function to(){return Ji}function il(e){eo=e}function ol(e){try{if(!Rn.name)return}catch{return}const t=new Rn;t.setOptions(y(y({renderer:Ja({imgLazyLoad:e.imgLazyLoad})},sl),e.markedOptions)),Ji=t}function fs(e){var t;let n=null==(t=to())?void 0:t.parse(e);n||(n=rl(e));let s=Qi(n);return eo.forEach((e=>{"function"==typeof e&&(s=e(s))})),s}function rl(e){return e.replace(/```\s*([^]+?.*?[^]+?[^]+?)```/g,((e,t)=>`<pre><code>${Xi(t)}</code></pre>`)).replace(/!\[(.*?)\]\((.*?)\)/g,((e,t,n)=>`<img src="${n}" alt="${t}" />`)).replace(/\[(.*?)\]\((.*?)\)/g,((e,t,n)=>`<a href="${n}" target="_blank">${t}</a>`)).replace(/\n/g,"<br>")}function ms(...e){const t=e=>e&&"object"==typeof e&&e.constructor===Object;return e.reduce(((e,n)=>(Object.keys(n??{}).forEach((s=>{if("__proto__"===s||"constructor"===s||"prototype"===s)return;const i=e[s],o=n[s];Array.isArray(i)&&Array.isArray(o)?e[s]=i.concat(...o):t(i)&&t(o)?e[s]=ms(i,o):e[s]=o})),e)),{})}class al{constructor(e){h(this,"loading",!1),h(this,"listLastFetch"),h(this,"comments",[]),h(this,"notifies",[]),h(this,"page"),this.events=e}getLoading(){return this.loading}setLoading(e){this.loading=e}getListLastFetch(){return this.listLastFetch}setListLastFetch(e){this.listLastFetch=e}getComments(){return this.comments}fetchComments(e){this.events.trigger("list-fetch",e)}findComment(e){return this.comments.find((t=>t.id===e))}clearComments(){this.comments=[],this.events.trigger("list-loaded",this.comments)}loadComments(e){this.events.trigger("list-load",e),this.comments.push(...e),this.events.trigger("list-loaded",this.comments)}insertComment(e){this.comments.push(e),this.events.trigger("comment-inserted",e),this.events.trigger("list-loaded",this.comments)}updateComment(e){this.comments=this.comments.map((t=>t.id===e.id?e:t)),this.events.trigger("comment-updated",e),this.events.trigger("list-loaded",this.comments)}deleteComment(e){const t=this.comments.find((t=>t.id===e));if(!t)throw new Error(`Comment ${e} not found`);this.comments=this.comments.filter((t=>t.id!==e)),this.events.trigger("comment-deleted",t),this.events.trigger("list-loaded",this.comments)}getNotifies(){return this.notifies}updateNotifies(e){this.notifies=e,this.events.trigger("notifies-updated",this.notifies)}getPage(){return this.page}updatePage(e){this.page=e,this.events.trigger("page-loaded",e)}}function P(e=""){const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstElementChild||t}function ll(e){return parseFloat(getComputedStyle(e,null).height.replace("px",""))||0}function gs(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function no(e){const t=RegExp(`[?&]${e}=([^&]*)`).exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}function cl(e,t){const n=e=>{const t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+s,left:t.left+n}},s=n(e);if(!t)return s;const i=n(t);return{top:s.top-i.top,left:s.left-i.left}}function xn(e,t){let n=e.toString();for(;n.length<t;)n=`0${n}`;return n}function dl(e){const t=xn(e.getDate(),2),n=xn(e.getMonth()+1,2);return`${xn(e.getFullYear(),2)}-${n}-${t}`}function so(e,t=e=>e){try{const n=e.getTime(),s=(new Date).getTime()-n,i=Math.floor(s/864e5);if(0===i){const e=s%864e5,n=Math.floor(e/36e5);if(0===n){const n=e%36e5,s=Math.floor(n/6e4);if(0===s){const e=n%6e4,s=Math.round(e/1e3);return s<10?t("now"):`${s} ${t("seconds")}`}return`${s} ${t("minutes")}`}return`${n} ${t("hours")}`}return i<0?t("now"):i<8?`${i} ${t("days")}`:dl(e)}catch(e){return console.error(e)," - "}}function hl(e){return`${e.mirror.replace(/\/$/,"")}/${e.emailHash}?${e.params.replace(/^\?/,"")}`}function ul(e,t){const n=e.split("."),s=t.split(".");for(let e=0;e<3;e++){const t=Number(n[e]),i=Number(s[e]);if(t>i)return 1;if(i>t)return-1;if(!Number.isNaN(t)&&Number.isNaN(i))return 1;if(Number.isNaN(t)&&!Number.isNaN(i))return-1}return 0}function pl(){return G(this,null,(function*(){const e=navigator.userAgent;if(!navigator.userAgentData||!navigator.userAgentData.getHighEntropyValues)return e;const t=navigator.userAgentData;let n=null;try{n=yield t.getHighEntropyValues(["platformVersion"])}catch(t){return console.error(t),e}const s=Number(n.platformVersion.split(".")[0]);return"Windows"===t.platform&&s>=13?e.replace(/Windows NT 10.0/,"Windows NT 11.0"):"macOS"===t.platform&&s>=11?e.replace(/(Mac OS X \d+_\d+_\d+|Mac OS X)/,`Mac OS X ${n.platformVersion.replace(/\./g,"_")}`):e}))}function ys(e){let t;try{t=new URL(e)}catch{return!1}return"http:"===t.protocol||"https:"===t.protocol}function io(e){return fl(e.base,e.path)}function fl(e,t){return`${e.replace(/\/$/,"")}/${t.replace(/^\//,"")}`}const Ws={placeholder:"Leave a comment",noComment:"No Comment",send:"Send",signIn:"Sign in",signUp:"Sign up",save:"Save",nick:"Nickname",email:"Email",link:"Website",emoticon:"Emoji",preview:"Preview",uploadImage:"Upload Image",uploadFail:"Upload Failed",commentFail:"Failed to comment",restoredMsg:"Content has been restored",onlyAdminCanReply:"Only admin can reply",uploadLoginMsg:"Please fill in your name and email to upload",counter:"{count} Comments",sortLatest:"Latest",sortOldest:"Oldest",sortBest:"Best",sortAuthor:"Author",openComment:"Open Comment",closeComment:"Close Comment",listLoadFailMsg:"Failed to load comments",listRetry:"Retry",loadMore:"Load More",admin:"Admin",reply:"Reply",voteUp:"Up",voteDown:"Down",voteFail:"Vote Failed",readMore:"Read More",actionConfirm:"Confirm",collapse:"Collapse",collapsed:"Collapsed",collapsedMsg:"This comment has been collapsed",expand:"Expand",approved:"Approved",pending:"Pending",pendingMsg:"Pending, visible only to commenter.",edit:"Edit",editCancel:"Cancel Edit",delete:"Delete",deleteConfirm:"Confirm",pin:"Pin",unpin:"Unpin",seconds:"seconds ago",minutes:"minutes ago",hours:"hours ago",days:"days ago",now:"just now",adminCheck:"Enter admin password:",captchaCheck:"Enter the CAPTCHA to continue:",confirm:"Confirm",cancel:"Cancel",msgCenter:"Messages",ctrlCenter:"Dashboard",userProfile:"Profile",noAccountPrompt:"Don't have an account?",haveAccountPrompt:"Already have an account?",forgetPassword:"Forget Password",resetPassword:"Reset Password",changePassword:"Change Password",confirmPassword:"Confirm Password",passwordMismatch:"Passwords do not match",verificationCode:"Verification Code",verifySend:"Send Code",verifyResend:"Resend",waitSeconds:"Wait {seconds}s",emailVerified:"Email has been verified",password:"Password",username:"Username",nextStep:"Next Step",skipVerify:"Skip verification",logoutConfirm:"Are you sure to logout?",accountMergeNotice:"Your email has multiple accounts with different id.",accountMergeSelectOne:"Please select one you want to merge all the data into it.",accountMergeConfirm:"All data will be merged into one account, the id is {id}.",dismiss:"Dismiss",merge:"Merge",frontend:"Frontend",backend:"Backend",loading:"Loading",loadFail:"Load Failed",editing:"Editing",editFail:"Edit Failed",deleting:"Deleting",deleteFail:"Delete Failed",reqGot:"Request got",reqAborted:"Request timed out or terminated unexpectedly",updateMsg:"Please update Artalk {name} to get the best experience!",currentVersion:"Current Version",ignore:"Ignore",open:"Open",openName:"Open {name}"},ml={placeholder:"键入内容...",noComment:"「此时无声胜有声」",send:"发送",signIn:"登录",signUp:"注册",save:"保存",nick:"昵称",email:"邮箱",link:"网址",emoticon:"表情",preview:"预览",uploadImage:"上传图片",uploadFail:"上传失败",commentFail:"评论失败",restoredMsg:"内容已自动恢复",onlyAdminCanReply:"仅管理员可评论",uploadLoginMsg:"填入你的名字邮箱才能上传哦",counter:"{count} 条评论",sortLatest:"最新",sortOldest:"最早",sortBest:"最热",sortAuthor:"作者",openComment:"打开评论",closeComment:"关闭评论",listLoadFailMsg:"无法获取评论列表数据",listRetry:"点击重新获取",loadMore:"加载更多",admin:"管理员",reply:"回复",voteUp:"赞同",voteDown:"反对",voteFail:"投票失败",readMore:"阅读更多",actionConfirm:"确认操作",collapse:"折叠",collapsed:"已折叠",collapsedMsg:"该评论已被系统或管理员折叠",expand:"展开",approved:"已审",pending:"待审",pendingMsg:"审核中，仅本人可见。",edit:"编辑",editCancel:"取消编辑",delete:"删除",deleteConfirm:"确认删除",pin:"置顶",unpin:"取消置顶",seconds:"秒前",minutes:"分钟前",hours:"小时前",days:"天前",now:"刚刚",adminCheck:"键入密码来验证管理员身份：",captchaCheck:"键入验证码继续：",confirm:"确认",cancel:"取消",msgCenter:"通知中心",ctrlCenter:"控制中心",userProfile:"个人资料",noAccountPrompt:"没有账号？",haveAccountPrompt:"已有账号？",forgetPassword:"忘记密码",resetPassword:"重置密码",changePassword:"修改密码",confirmPassword:"确认密码",passwordMismatch:"两次输入的密码不一致",verificationCode:"验证码",verifySend:"发送验证码",verifyResend:"重新发送",waitSeconds:"等待 {seconds}秒",emailVerified:"邮箱已验证",password:"密码",username:"用户名",nextStep:"下一步",skipVerify:"跳过验证",logoutConfirm:"确定要退出登录吗？",accountMergeNotice:"您的电子邮件下有多个不同 ID 的账户。",accountMergeSelectOne:"请选择将所有数据合并到其中的一个。",accountMergeConfirm:"所有数据将合并到 ID 为 {id} 的账户中。",dismiss:"忽略",merge:"合并",frontend:"前端",backend:"后端",loading:"加载中",loadFail:"加载失败",editing:"修改中",editFail:"修改失败",deleting:"删除中",deleteFail:"删除失败",reqGot:"请求响应",reqAborted:"请求超时或意外终止",updateMsg:"请更新 Artalk {name} 以获得更好的体验！",currentVersion:"当前版本",ignore:"忽略",open:"打开",openName:"打开{name}"},Cn="ArtalkI18n",Sn={en:Ws,"en-US":Ws,"zh-CN":ml};function oo(e){return e=e.replace(/^([a-zA-Z]+)(-[a-zA-Z]+)?$/,((e,t,n)=>t.toLowerCase()+(n||"").toUpperCase())),Sn[e]?Sn[e]:window[Cn]&&window[Cn][e]?window[Cn][e]:Sn.en}let qn="en",Un=oo(qn);function Vs(e){e!==qn&&(qn=e,Un="string"==typeof e?oo(e):e)}function w(e,t={}){let n=Un?.[e]||e;return n=n.replace(/\{\s*(\w+?)\s*\}/g,((e,n)=>t[n]||"")),gs(n)}class Fn{constructor(){h(this,"events",[])}on(e,t,n={}){this.events.push(y({name:e,handler:t},n))}off(e,t){t&&(this.events=this.events.filter((n=>!(n.name===e&&n.handler===t))))}trigger(e,t){this.events.slice(0).filter((t=>t.name===e&&"function"==typeof t.handler)).forEach((n=>{n.once&&this.off(e,n.handler),n.handler(t)}))}}const gl={el:"",pageKey:"",pageTitle:"",server:"",site:"",placeholder:"",noComment:"",sendBtn:"",darkMode:!1,editorTravel:!0,flatMode:"auto",nestMax:2,nestSort:"DATE_ASC",emoticons:"https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json",vote:!0,voteDown:!1,uaBadge:!0,listSort:!0,preview:!0,countEl:".artalk-comment-count",pvEl:".artalk-pv-count",statPageKeyAttr:"data-page-key",gravatar:{mirror:"https://www.gravatar.com/avatar/",params:"sha256=1&d=mp&s=240"},pagination:{pageSize:20,readMore:!0,autoLoad:!0},heightLimit:{content:300,children:400,scrollable:!1},imgUpload:!0,reqTimeout:15e3,versionCheck:!0,useBackendConf:!0,locale:"en"};function zn(e,t=!1){const n=t?ms(gl,e):e;if(n.el&&"string"==typeof n.el)try{const e=document.querySelector(n.el);if(!e)throw Error(`Target element "${n.el}" was not found.`);n.el=e}catch(e){throw console.error(e),new Error("Please check your Artalk `el` config.")}return""===n.pageKey&&(n.pageKey=`${window.location.pathname}`),""===n.pageTitle&&(n.pageTitle=`${document.title}`),n.server&&(n.server=n.server.replace(/\/$/,"").replace(/\/api\/?$/,"")),"auto"===n.locale&&(n.locale=navigator.language),"auto"===n.flatMode&&(n.flatMode=window.matchMedia("(max-width: 768px)").matches),"number"==typeof n.nestMax&&Number(n.nestMax)<=1&&(n.flatMode=!0),n}function yl(e){const t=["el","pageKey","pageTitle","server","site","pvEl","countEl","statPageKeyAttr"];return Object.keys(e).forEach((n=>{t.includes(n)&&delete e[n],"darkMode"===n&&"auto"!==e[n]&&delete e[n]})),e.emoticons&&"string"==typeof e.emoticons&&(e.emoticons=e.emoticons.trim(),e.emoticons.startsWith("[")||e.emoticons.startsWith("{")?e.emoticons=JSON.parse(e.emoticons):"false"===e.emoticons&&(e.emoticons=!1)),e}function ro(e,t){return{baseURL:`${e.server}/api/v2`,siteName:e.site||"",pageKey:e.pageKey||"",pageTitle:e.pageTitle||"",timeout:e.reqTimeout,getApiToken:()=>t?.get("user").getData().token,userInfo:t?.get("user").checkHasBasicUserInfo()?{name:t?.get("user").getData().name,email:t?.get("user").getData().email}:void 0,handlers:t?.getApiHandlers()}}function vl(e){const t=Or();return t.add("need_captcha",(t=>e.checkCaptcha(t))),t.add("need_login",(()=>e.checkAdmin({}))),t}function kl(e,t,n){let s=null;const i=()=>{const i=(()=>{const n=e.getConf(),s={};return t.forEach((e=>{s[e]=n[e]})),s})();(null==s||!((e,t)=>JSON.stringify(e)===JSON.stringify(t))(s,i))&&(s=i,n(i))};e.on("mounted",i),e.on("updated",i)}class wl{constructor(e){h(this,"conf"),h(this,"data"),h(this,"$root"),h(this,"events",new Fn),h(this,"mounted",!1),h(this,"apiHandlers",null),h(this,"getCommentList",this.getCommentNodes),h(this,"getCommentDataList",this.getComments),this.conf=e,this.$root=e.el,this.$root.classList.add("artalk"),this.$root.innerHTML="",e.darkMode&&this.$root.classList.add("atk-dark-mode"),this.data=new al(this.events),this.on("mounted",(()=>{this.mounted=!0}))}inject(e,t){this[e]=t}get(e){return this[e]}getApi(){return new Pi(ro(this.conf,this))}getApiHandlers(){return this.apiHandlers||(this.apiHandlers=vl(this)),this.apiHandlers}getData(){return this.data}replyComment(e,t){this.editor.setReply(e,t)}editComment(e,t){this.editor.setEditComment(e,t)}fetch(e){this.data.fetchComments(e)}reload(){this.data.fetchComments({offset:0})}listGotoFirst(){this.events.trigger("list-goto-first")}getCommentNodes(){return this.list.getCommentNodes()}getComments(){return this.data.getComments()}editorShowLoading(){this.editor.showLoading()}editorHideLoading(){this.editor.hideLoading()}editorShowNotify(e,t){this.editor.showNotify(e,t)}editorResetState(){this.editor.resetState()}showSidebar(e){this.sidebarLayer.show(e)}hideSidebar(){this.sidebarLayer.hide()}checkAdmin(e){return this.checkerLauncher.checkAdmin(e)}checkCaptcha(e){return this.checkerLauncher.checkCaptcha(e)}on(e,t){this.events.on(e,t)}off(e,t){this.events.off(e,t)}trigger(e,t){this.events.trigger(e,t)}$t(e,t={}){return w(e,t)}setDarkMode(e){this.updateConf({darkMode:e})}updateConf(e){this.conf=ms(this.conf,zn(e,!1)),this.mounted&&this.events.trigger("updated",this.conf)}getConf(){return this.conf}getEl(){return this.$root}getMarked(){return to()}watchConf(e,t){kl(this,e,t)}}function dt(e,t){let n=e.querySelector(":scope > .atk-loading");n||(n=P('<div class="atk-loading" style="display: none;">\n      <div class="atk-loading-spinner">\n        <svg viewBox="25 25 50 50"><circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"></circle></svg>\n      </div>\n    </div>'),t?.transparentBg&&(n.style.background="transparent"),e.appendChild(n)),n.style.display="";const s=n.querySelector(".atk-loading-spinner");s&&(s.style.display="none",window.setTimeout((()=>{s.isConnected&&(s.style.display="")}),500))}function je(e){const t=e.querySelector(":scope > .atk-loading");t&&(t.style.display="none")}function Gs(e,t){e?dt(t):je(t)}function ao(e,t=!0,n){let s;if(n){const t=n.getBoundingClientRect();s=e.getBoundingClientRect().top-t.top+n.scrollTop-n.clientHeight/2+e.clientHeight/2}else{const t=e.getBoundingClientRect();s=t.top+window.scrollY-(window.innerHeight/2-t.height/2)}const i={top:s,left:0,behavior:"instant"};n?n.scroll(i):window.scroll(i)}function bl(e,t,n){const s=P(`<div class="atk-notify atk-fade-in" style="background-color: ${{s:"#57d59f",e:"#ff6f6c",w:"#ffc721",i:"#2ebcfc"}[n]}"><span class="atk-notify-content"></span></div>`);s.querySelector(".atk-notify-content").innerHTML=gs(t).replace("\n","<br/>"),e.appendChild(s);const i=()=>{s.classList.add("atk-fade-out"),setTimeout((()=>{s.remove()}),200)};let o;o=window.setTimeout((()=>{i()}),3e3),s.addEventListener("click",(()=>{i(),window.clearTimeout(o)}))}function $l(e,t,n="in"){e.classList.add(`atk-fade-${n}`);const s=()=>{e.classList.remove(`atk-fade-${n}`),e.removeEventListener("animationend",s)};e.addEventListener("animationend",s)}function Hn(e,t){$l(e,t,"in")}function Qt(e,t,n='<span class="atk-error-title">Artalk Error</span>'){let s=e.querySelector(".atk-error-layer");if(null===t)return void(null!==s&&s.remove());s||(s=P(`<div class="atk-error-layer">${n}<span class="atk-error-text"></span></div>`),e.appendChild(s));const i=s.querySelector(".atk-error-text");i.innerHTML="",null!==t&&(t instanceof HTMLElement?i.appendChild(t):i.innerText=t)}function xl(){const e=document.createElement("p");e.style.width="100%",e.style.height="200px";const t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);const n=e.offsetWidth;t.style.overflow="scroll";let s=e.offsetWidth;return n===s&&(s=t.clientWidth),document.body.removeChild(t),n-s}function Cl(e){const t=P(`<span><img class="atk-captcha-img" src="${e.get("img_data")||""}">${w("captchaCheck")}</span>`);return t.querySelector(".atk-captcha-img").onclick=()=>{const n=t.querySelector(".atk-captcha-img");e.getApi().captcha.getCaptcha().then((e=>{n.setAttribute("src",e.data.img_data)})).catch((e=>{console.error("Failed to get captcha image ",e)}))},t}function Sl(e){const t=P('<div class="atk-checker-iframe-wrap"></div>'),n=P('<iframe class="atk-fade-in" referrerpolicy="strict-origin-when-cross-origin"></iframe>');n.style.display="none",dt(t,{transparentBg:!0}),n.src=e.getOpts().getCaptchaIframeURL(),n.onload=()=>{n.style.display="",je(t)},t.append(n);const s=P('<div class="atk-close-btn"><i class="atk-icon atk-icon-close"></i></div>');t.append(s),e.hideInteractInput();let i=!1;return function t(){return G(this,null,(function*(){if(yield(e=>new Promise((t=>{window.setTimeout((()=>{t(null)}),e)})))(1e3),i)return;let n=!1;try{n=(yield e.getApi().captcha.getCaptchaStatus()).data.is_pass}catch{n=!1}n?e.triggerSuccess():t()}))}(),s.onclick=()=>{i=!0,e.cancel()},t}const El={request:(e,t)=>e.getApi().captcha.verifyCaptcha({value:t}),body:e=>e.get("iframe")?Sl(e):Cl(e),onSuccess(e,t,n,s){e.set("val",n)},onError(e,t,n,s){s.querySelector(".atk-captcha-img").click(),s.querySelector('input[type="text"]').value=""}},Tl={inputType:"password",request(e,t){return G(this,null,(function*(){return(yield e.getApi().user.login({name:e.getUser().getData().name,email:e.getUser().getData().email,password:t})).data}))},body:e=>P(`<span>${w("adminCheck")}</span>`),onSuccess(e,t,n,s){e.getUser().update({is_admin:!0,token:t.token}),e.getOpts().onReload()},onError(e,t,n,s){}};class Ll{constructor(e){h(this,"$el"),h(this,"$content"),h(this,"$actions"),this.$el=P('<div class="atk-layer-dialog-wrap">\n        <div class="atk-layer-dialog">\n          <div class="atk-layer-dialog-content"></div>\n          <div class="atk-layer-dialog-actions"></div>\n        </div>\n      </div>'),this.$actions=this.$el.querySelector(".atk-layer-dialog-actions"),this.$content=this.$el.querySelector(".atk-layer-dialog-content"),this.$content.appendChild(e)}setYes(e){const t=P(`<button data-action="confirm">${w("confirm")}</button>`);return t.onclick=this.onBtnClick(e),this.$actions.appendChild(t),this}setNo(e){const t=P(`<button data-action="cancel">${w("cancel")}</button>`);return t.onclick=this.onBtnClick(e),this.$actions.appendChild(t),this}onBtnClick(e){return t=>{const n=e(t.currentTarget,this);(void 0===n||!0===n)&&this.$el.remove()}}}function Ks(e){return t=>new Promise(((n,s)=>{const i=t.onCancel;t.onCancel=()=>{i&&i(),s(new Error("user canceled the checker"))};const o=t.onSuccess;t.onSuccess=()=>{o&&o(),n()},e(t)}))}class Al{constructor(e){h(this,"checkCaptcha",Ks((e=>{this.fire(El,e,(t=>{t.set("img_data",e.img_data),t.set("iframe",e.iframe)}))}))),h(this,"checkAdmin",Ks((e=>{this.fire(Tl,e)}))),this.opts=e}fire(e,t,n){const s=this.opts.getCtx().get("layerManager").create(`checker-${(new Date).getTime()}`);s.show();const i=()=>{s.destroy()},o={};let r=!1;const a={set:(e,t)=>{o[e]=t},get:e=>o[e],getOpts:()=>this.opts,getUser:()=>this.opts.getCtx().get("user"),getApi:()=>this.opts.getApi(),hideInteractInput:()=>{r=!0},triggerSuccess:()=>{i(),e.onSuccess&&e.onSuccess(a,"","",l),t.onSuccess&&t.onSuccess()},cancel:()=>{i(),t.onCancel&&t.onCancel()}};n&&n(a);const l=P();l.appendChild(e.body(a));const c=P(`<input id="check" type="${e.inputType||"text"}" autocomplete="off" required placeholder="">`);let h;l.appendChild(c),setTimeout((()=>c.focus()),80),c.onkeyup=e=>{("Enter"===e.key||13===e.keyCode)&&(e.preventDefault(),s.getEl().querySelector('button[data-action="confirm"]').click())};const d=new Ll(l);d.setYes((n=>{const s=c.value.trim();h||(h=n.innerText);const o=()=>{n.innerText=h||"",n.classList.remove("error")};return n.innerText=`${w("loading")}...`,e.request(a,s).then((n=>{i(),e.onSuccess&&e.onSuccess(a,n,s,l),t.onSuccess&&t.onSuccess()})).catch((t=>{(e=>{n.innerText=e,n.classList.add("error")})(String(t.message||String(t))),e.onError&&e.onError(a,t,s,l);const i=setTimeout((()=>o()),3e3);c.onfocus=()=>{o(),clearTimeout(i)}})),!1})),d.setNo((()=>(i(),t.onCancel&&t.onCancel(),!1))),r&&(c.style.display="none",d.$el.querySelector(".atk-layer-dialog-actions").style.display="none"),s.getEl().append(d.$el),t.onMount&&t.onMount(d.$el)}}class vs{constructor(e){h(this,"$el"),this.ctx=e}get conf(){return this.ctx.conf}getEl(){return this.$el}}const _l='<div class="atk-main-editor">\n  <div class="atk-header">\n    <input name="name" class="atk-name" type="text" required="required" />\n    <input name="email" class="atk-email" type="email" required="required" />\n    <input name="link" class="atk-link" type="url" />\n  </div>\n  <div class="atk-textarea-wrap">\n    <textarea class="atk-textarea"></textarea>\n  </div>\n  <div class="atk-plug-panel-wrap" style="display: none"></div>\n  <div class="atk-bottom">\n    <div class="atk-item atk-bottom-left">\n      <span class="atk-state-wrap"></span>\n      <span class="atk-plug-btn-wrap"></span>\n    </div>\n    <div class="atk-item">\n      <button type="button" class="atk-send-btn"></button>\n    </div>\n  </div>\n  <div class="atk-notify-wrap"></div>\n</div>\n',Pl={$header:".atk-header",$name:'.atk-header [name="name"]',$email:'.atk-header [name="email"]',$link:'.atk-header [name="link"]',$textareaWrap:".atk-textarea-wrap",$textarea:".atk-textarea",$bottom:".atk-bottom",$submitBtn:".atk-send-btn",$notifyWrap:".atk-notify-wrap",$bottomLeft:".atk-bottom-left",$stateWrap:".atk-state-wrap",$plugBtnWrap:".atk-plug-btn-wrap",$plugPanelWrap:".atk-plug-panel-wrap"};function Il(){const e=P(_l),t={$el:e};return Object.entries(Pl).forEach((([n,s])=>{t[n]=e.querySelector(s)})),t}class we{constructor(e){h(this,"$btn"),h(this,"$panel"),h(this,"editorStateEffectWhen"),this.kit=e}useBtn(e="<div></div>"){return this.$btn=P(`<span class="atk-plug-btn">${e}</span>`),this.$btn}usePanel(e="<div></div>"){return this.$panel=P(e),this.$panel}useContentTransformer(e){this.contentTransformer=e}usePanelShow(e){this.kit.useEvents().on("panel-show",(t=>{t===this&&e()}))}usePanelHide(e){this.kit.useEvents().on("panel-hide",(t=>{t===this&&e()}))}useEditorStateEffect(e,t){this.editorStateEffectWhen=e,this.editorStateEffect=t}}class Yt extends we{constructor(){super(...arguments),h(this,"isMoved",!1)}move(e){if(this.isMoved)return;this.isMoved=!0;const t=this.kit.useUI().$el;t.after(P('<div class="atk-editor-travel-placeholder"></div>'));const n=P("<div></div>");e.after(n),n.replaceWith(t),t.classList.add("atk-fade-in"),t.classList.add("editor-traveling")}back(){var e;this.isMoved&&(this.isMoved=!1,null==(e=this.kit.useGlobalCtx().$root.querySelector(".atk-editor-travel-placeholder"))||e.replaceWith(this.kit.useUI().$el),this.kit.useUI().$el.classList.remove("editor-traveling"))}}class Ml{constructor(e){h(this,"stateCurt","normal"),h(this,"stateUnmountFn",null),this.editor=e}get(){return this.stateCurt}switch(e,t){var n,s,i,o,r;if(this.stateUnmountFn&&(this.stateUnmountFn(),this.stateUnmountFn=null,null==(s=null==(n=this.editor.getPlugs())?void 0:n.get(Yt))||s.back()),"normal"!==e&&t){let n=t.$comment;this.editor.conf.flatMode||(n=n.querySelector(".atk-footer")),null==(o=null==(i=this.editor.getPlugs())?void 0:i.get(Yt))||o.move(n);const s=this.editor.ctx.conf.scrollRelativeTo&&this.editor.ctx.conf.scrollRelativeTo();ao(this.editor.getUI().$el,!0,s);const a=null==(r=this.editor.getPlugs())?void 0:r.getPlugs().find((t=>t.editorStateEffectWhen===e));a&&a.editorStateEffect&&(this.stateUnmountFn=a.editorStateEffect(t.comment))}this.stateCurt=e}}class Ol extends vs{constructor(e){super(e),h(this,"ui"),h(this,"state"),this.ui=Il(),this.$el=this.ui.$el,this.state=new Ml(this)}getUI(){return this.ui}getPlugs(){return this.ctx.get("editorPlugs")}getState(){return this.state.get()}getHeaderInputEls(){return{name:this.ui.$name,email:this.ui.$email,link:this.ui.$link}}getContentFinal(){let e=this.getContentRaw();const t=this.getPlugs();return t&&(e=t.getTransformedContent(e)),e}getContentRaw(){return this.ui.$textarea.value||""}getContentMarked(){return fs(this.getContentFinal())}setContent(e){var t;this.ui.$textarea.value=e,null==(t=this.getPlugs())||t.getEvents().trigger("content-updated",e)}insertContent(e){if(document.selection)this.ui.$textarea.focus(),document.selection.createRange().text=e,this.ui.$textarea.focus();else if(this.ui.$textarea.selectionStart||0===this.ui.$textarea.selectionStart){const t=this.ui.$textarea.selectionStart,n=this.ui.$textarea.selectionEnd,s=this.ui.$textarea.scrollTop;this.setContent(this.ui.$textarea.value.substring(0,t)+e+this.ui.$textarea.value.substring(n,this.ui.$textarea.value.length)),this.ui.$textarea.focus(),this.ui.$textarea.selectionStart=t+e.length,this.ui.$textarea.selectionEnd=t+e.length,this.ui.$textarea.scrollTop=s}else this.ui.$textarea.focus(),this.ui.$textarea.value+=e}focus(){this.ui.$textarea.focus()}reset(){this.setContent(""),this.resetState()}resetState(){this.state.switch("normal")}setReply(e,t){this.state.switch("reply",{comment:e,$comment:t})}setEditComment(e,t){this.state.switch("edit",{comment:e,$comment:t})}showNotify(e,t){bl(this.ui.$notifyWrap,e,t)}showLoading(){dt(this.ui.$el)}hideLoading(){je(this.ui.$el)}submit(){const e=()=>this.ctx.trigger("editor-submit");this.ctx.conf.beforeSubmit?this.ctx.conf.beforeSubmit(this,e):e()}}const Rl='<div class="atk-sidebar-layer">\n  <div class="atk-sidebar-inner">\n    <div class="atk-sidebar-header">\n      <div class="atk-sidebar-close">\n        <i class="atk-icon atk-icon-close-slim"></i>\n      </div>\n    </div>\n    <div class="atk-sidebar-iframe-wrap"></div>\n  </div>\n</div>\n';class Dl extends vs{constructor(e){super(e),h(this,"layer"),h(this,"$header"),h(this,"$closeBtn"),h(this,"$iframeWrap"),h(this,"$iframe"),h(this,"refreshWhenShow",!0),h(this,"animTimer"),this.$el=P(Rl),this.$header=this.$el.querySelector(".atk-sidebar-header"),this.$closeBtn=this.$header.querySelector(".atk-sidebar-close"),this.$iframeWrap=this.$el.querySelector(".atk-sidebar-iframe-wrap"),this.$closeBtn.onclick=()=>{this.hide()},this.ctx.on("user-changed",(()=>{this.refreshWhenShow=!0}))}show(){return G(this,arguments,(function*(e={}){if(this.$el.style.transform="",this.initLayer(),this.layer.show(),this.refreshWhenShow)this.refreshWhenShow=!1,this.$iframeWrap.innerHTML="",this.$iframe=this.createIframe(e.view),this.$iframeWrap.append(this.$iframe);else{const e=this.$iframe,t=e.src;this.getDarkMode()!==t.includes("&darkMode=1")&&this.iframeLoad(e,t.replace(/&darkMode=\d/,`&darkMode=${Number(this.getDarkMode())}`))}this.authCheck({onSuccess:()=>this.show(e)}),this.animTimer=setTimeout((()=>{this.animTimer=void 0,this.$el.style.transform="translate(0, 0)",setTimeout((()=>{this.ctx.getData().updateNotifies([])}),0),this.ctx.trigger("sidebar-show")}),100)}))}hide(){var e;null==(e=this.layer)||e.hide()}authCheck(e){return G(this,null,(function*(){const t=(yield this.ctx.getApi().user.getUserStatus(y({},this.ctx.getApi().getUserFields()))).data;t.is_admin&&!t.is_login&&(this.refreshWhenShow=!0,this.ctx.checkAdmin({onSuccess:()=>{setTimeout((()=>{e.onSuccess()}),500)},onCancel:()=>{this.hide()}}),this.hide())}))}initLayer(){this.layer||(this.layer=this.ctx.get("layerManager").create("sidebar",this.$el),this.layer.setOnAfterHide((()=>{this.ctx.editorResetState(),this.animTimer&&clearTimeout(this.animTimer),this.$el.style.transform="",this.ctx.trigger("sidebar-hide")})))}createIframe(e){const t=P('<iframe referrerpolicy="strict-origin-when-cross-origin"></iframe>'),n=io({base:this.ctx.conf.server,path:"/sidebar/"}),s={pageKey:this.conf.pageKey,site:this.conf.site||"",user:JSON.stringify(this.ctx.get("user").getData()),time:+new Date};e&&(s.view=e),s.darkMode=this.getDarkMode()?"1":"0";const i=new URLSearchParams(s);return this.iframeLoad(t,`${n}?${i.toString()}`),t}getDarkMode(){return"auto"===this.conf.darkMode?window.matchMedia("(prefers-color-scheme: dark)").matches:this.conf.darkMode}iframeLoad(e,t){e.src=t,dt(this.$iframeWrap),e.onload=()=>{je(this.$iframeWrap)}}}const Bl='<div class="atk-list">\n  <div class="atk-list-header">\n    <div class="atk-comment-count">\n      <div class="atk-text"></div>\n    </div>\n    <div class="atk-right-action">\n      <span data-action="admin-close-comment" class="atk-hide" atk-only-admin-show></span>\n      <span data-action="open-sidebar" class="atk-hide atk-on">\n        <span class="atk-unread-badge" style="display: none"></span>\n        <div class="atk-text"></div>\n      </span>\n    </div>\n  </div>\n  <div class="atk-list-body">\n    <div class="atk-list-comments-wrap"></div>\n  </div>\n  <div class="atk-list-footer">\n    <div class="atk-copyright"></div>\n  </div>\n</div>\n';function ql(e,t="DATE_DESC",n=2){const s=[];e.filter((e=>0===e.rid)).forEach((t=>{const i={id:t.id,comment:t,children:[],level:1};i.parent=i,s.push(i),function t(s){const i=e.filter((e=>e.rid===s.id));0!==i.length&&(s.level>=n&&(s=s.parent),i.forEach((e=>{const n={id:e.id,comment:e,children:[],parent:s,level:s.level+1};s.children.push(n),t(n)})))}(i)}));const i=(n,s)=>{let i=n.id-s.id;return"DATE_ASC"===t?i=+new Date(n.comment.date)-+new Date(s.comment.date):"DATE_DESC"===t?i=+new Date(s.comment.date)-+new Date(n.comment.date):"SRC_INDEX"===t?i=e.indexOf(n.comment)-e.indexOf(s.comment):"VOTE_UP_DESC"===t&&(i=s.comment.vote_up-n.comment.vote_up),i};return function e(t){t.forEach((t=>{t.children=t.children.sort(i),e(t.children)}))}(s),s}const Ul=e=>({import:t=>{ql(t,e.nestSortBy,e.nestMax).forEach((n=>{var s;const i=e.createCommentNode(n.comment);null==(s=e.$commentsWrap)||s.appendChild(i.getEl()),i.getRender().playFadeAnim();const o=(n,s)=>{s.children.forEach((s=>{const i=t.find((e=>e.id===s.comment.rid)),r=s.comment,a=e.createCommentNode(r,i);n.putChild(a),o(a,s)}))};o(i,n),i.getRender().checkHeightLimit()}))},insert:(t,n)=>{var s;const i=e.createCommentNode(t,n);if(0===t.rid)null==(s=e.$commentsWrap)||s.prepend(i.getEl());else{const n=e.findCommentNode(t.rid);n&&(n.putChild(i,"DATE_ASC"===e.nestSortBy?"append":"prepend"),i.getParents().forEach((e=>{e.getRender().heightLimitRemoveForChildren()})))}i.getRender().checkHeightLimit(),i.scrollIntoView(),i.getRender().playFadeAnim()}}),Fl=e=>({import:t=>{t.forEach((n=>{const s=0===n.rid?void 0:t.find((e=>e.id===n.rid));Zs(e,"append",n,s)}))},insert:(t,n)=>{Zs(e,"prepend",t,n).scrollIntoView()}});function Zs(e,t,n,s){n.is_collapsed&&(n.is_allow_reply=!1);const i=e.createCommentNode(n,s);if(n.visible){const n=i.getEl(),s=e.$commentsWrap;"append"===t&&s?.append(n),"prepend"===t&&s?.prepend(n),i.getRender().playFadeAnim()}return i.getRender().checkHeightLimit(),i}class zl{constructor(e){this.options=e}getStrategy(){return this.options.flatMode?Fl(this.options):Ul(this.options)}import(e){this.getStrategy().import(e)}insert(e,t){this.getStrategy().insert(e,t)}}function Hl(e){const t=window||{},n=navigator||{},s=String(e||n.userAgent),i={os:"",osVersion:"",engine:"",browser:"",device:"",language:"",version:""},o={Trident:s.includes("Trident")||s.includes("NET CLR"),Presto:s.includes("Presto"),WebKit:s.includes("AppleWebKit"),Gecko:s.includes("Gecko/")},r={Safari:s.includes("Safari"),Chrome:s.includes("Chrome")||s.includes("CriOS"),IE:s.includes("MSIE")||s.includes("Trident"),Edge:s.includes("Edge")||s.includes("Edg"),Firefox:s.includes("Firefox")||s.includes("FxiOS"),"Firefox Focus":s.includes("Focus"),Chromium:s.includes("Chromium"),Opera:s.includes("Opera")||s.includes("OPR"),Vivaldi:s.includes("Vivaldi"),Yandex:s.includes("YaBrowser"),Kindle:s.includes("Kindle")||s.includes("Silk/"),360:s.includes("360EE")||s.includes("360SE"),UC:s.includes("UC")||s.includes(" UBrowser"),QQBrowser:s.includes("QQBrowser"),QQ:s.includes("QQ/"),Baidu:s.includes("Baidu")||s.includes("BIDUBrowser"),Maxthon:s.includes("Maxthon"),Sogou:s.includes("MetaSr")||s.includes("Sogou"),LBBROWSER:s.includes("LBBROWSER"),"2345Explorer":s.includes("2345Explorer"),TheWorld:s.includes("TheWorld"),MIUI:s.includes("MiuiBrowser"),Quark:s.includes("Quark"),Qiyu:s.includes("Qiyu"),Wechat:s.includes("MicroMessenger"),Taobao:s.includes("AliApp(TB"),Alipay:s.includes("AliApp(AP"),Weibo:s.includes("Weibo"),Douban:s.includes("com.douban.frodo"),Suning:s.includes("SNEBUY-APP"),iQiYi:s.includes("IqiyiApp")},a={Windows:s.includes("Windows"),Linux:s.includes("Linux")||s.includes("X11"),macOS:s.includes("Macintosh"),Android:s.includes("Android")||s.includes("Adr"),Ubuntu:s.includes("Ubuntu"),FreeBSD:s.includes("FreeBSD"),Debian:s.includes("Debian"),"Windows Phone":s.includes("IEMobile")||s.includes("Windows Phone"),BlackBerry:s.includes("BlackBerry")||s.includes("RIM"),MeeGo:s.includes("MeeGo"),Symbian:s.includes("Symbian"),iOS:s.includes("like Mac OS X"),"Chrome OS":s.includes("CrOS"),WebOS:s.includes("hpwOS")},l={Mobile:s.includes("Mobi")||s.includes("iPh")||s.includes("480"),Tablet:s.includes("Tablet")||s.includes("Pad")||s.includes("Nexus 7")};l.Mobile?l.Mobile=!s.includes("iPad"):r.Chrome&&s.includes("Edg")?(r.Chrome=!1,r.Edge=!0):t.showModalDialog&&t.chrome&&(r.Chrome=!1,r[360]=!0),i.device="PC",i.language=(()=>{const e=(n.browserLanguage||n.language).split("-");return e[1]&&(e[1]=e[1].toUpperCase()),e.join("_")})(),Object.entries({engine:o,browser:r,os:a,device:l}).forEach((([e,t])=>{Object.entries(t).forEach((([t,n])=>{!0===n&&(i[e]=t)}))}));const c={Windows:()=>{const e=s.replace(/^.*Windows NT ([\d.]+);.*$/,"$1");return{6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000","10.0":"10","11.0":"11"}[e]||e},Android:()=>s.replace(/^.*Android ([\d.]+);.*$/,"$1"),iOS:()=>s.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,"."),Debian:()=>s.replace(/^.*Debian\/([\d.]+).*$/,"$1"),"Windows Phone":()=>s.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2"),macOS:()=>s.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,"."),WebOS:()=>s.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")};i.osVersion="",c[i.os]&&(i.osVersion=c[i.os](),i.osVersion===s&&(i.osVersion=""));const h={Safari:()=>s.replace(/^.*Version\/([\d.]+).*$/,"$1"),Chrome:()=>s.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1"),IE:()=>s.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1"),Edge:()=>s.replace(/^.*(Edge|Edg|Edg[A-Z]{1})\/([\d.]+).*$/,"$2"),Firefox:()=>s.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1"),"Firefox Focus":()=>s.replace(/^.*Focus\/([\d.]+).*$/,"$1"),Chromium:()=>s.replace(/^.*Chromium\/([\d.]+).*$/,"$1"),Opera:()=>s.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1"),Vivaldi:()=>s.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1"),Yandex:()=>s.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1"),Kindle:()=>s.replace(/^.*Version\/([\d.]+).*$/,"$1"),Maxthon:()=>s.replace(/^.*Maxthon\/([\d.]+).*$/,"$1"),QQBrowser:()=>s.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1"),QQ:()=>s.replace(/^.*QQ\/([\d.]+).*$/,"$1"),Baidu:()=>s.replace(/^.*BIDUBrowser[\s/]([\d.]+).*$/,"$1"),UC:()=>s.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1"),Sogou:()=>s.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1"),"2345Explorer":()=>s.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1"),TheWorld:()=>s.replace(/^.*TheWorld ([\d.]+).*$/,"$1"),MIUI:()=>s.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1"),Quark:()=>s.replace(/^.*Quark\/([\d.]+).*$/,"$1"),Qiyu:()=>s.replace(/^.*Qiyu\/([\d.]+).*$/,"$1"),Wechat:()=>s.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1"),Taobao:()=>s.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1"),Alipay:()=>s.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1"),Weibo:()=>s.replace(/^.*weibo__([\d.]+).*$/,"$1"),Douban:()=>s.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1"),Suning:()=>s.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1"),iQiYi:()=>s.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")};return i.version="",h[i.browser]&&(i.version=h[i.browser](),i.version===s&&(i.version="")),i.version.indexOf(".")&&(i.version=i.version.substring(0,i.version.indexOf("."))),"iOS"===i.os&&s.includes("iPad")?i.os="iPadOS":"Edge"!==i.browser||s.includes("Edg")?"MIUI"===i.browser?i.os="Android":"Chrome"===i.browser&&Number(i.version)>27||"Opera"===i.browser&&Number(i.version)>12||"Yandex"===i.browser?i.engine="Blink":void 0===i.browser&&(i.browser="Unknow App"):i.engine="EdgeHTML",i}function Nl(e,t){t.forEach((({el:t,max:n,imgCheck:s})=>{if(!t)return;s&&(t.style.maxHeight=`${n+1}px`);let i=!1;const o=()=>{if(i||ll(t)<=n)return;e.scrollable?Wl({el:t,max:n}):jl({el:t,max:n,afterExpandBtnClick:()=>{var t;i=!0,null==(t=e.afterExpandBtnClick)||t.call(e)}})};if(o(),s){const e=t.querySelectorAll(".atk-content img");0===e.length&&(t.style.maxHeight=""),e.forEach((e=>{e.onload=()=>o()}))}}))}const Xt="atk-height-limit";function jl(e){if(!e.el||!e.max||e.el.classList.contains(Xt))return;e.el.classList.add(Xt),e.el.style.height=`${e.max}px`,e.el.style.overflow="hidden";const t=P(`<div class="atk-height-limit-btn">${w("readMore")}</span>`);t.onclick=t=>{t.stopPropagation(),Nn(e.el),e.afterExpandBtnClick&&e.afterExpandBtnClick(t)},e.el.append(t)}function Nn(e){e&&e.classList.contains(Xt)&&(e.classList.remove(Xt),Array.from(e.children).forEach((e=>{e.classList.contains("atk-height-limit-btn")&&e.remove()})),e.style.height="",e.style.maxHeight="",e.style.overflow="")}const Qs="atk-height-limit-scroll";function Wl(e){e.el&&(e.el.classList.contains(Qs)||(e.el.classList.add(Qs),e.el.style.height=`${e.max}px`))}const Vl='<div class="atk-comment-wrap">\n  <div class="atk-comment">\n    <div class="atk-avatar"></div>\n    <div class="atk-main">\n      <div class="atk-header">\n        <span class="atk-item atk-nick"></span>\n        <span class="atk-badge-wrap"></span>\n        <span class="atk-item atk-date"></span>\n      </div>\n      <div class="atk-body">\n        <div class="atk-content"></div>\n      </div>\n      <div class="atk-footer">\n        <div class="atk-actions"></div>\n      </div>\n    </div>\n  </div>\n</div>\n';function Gl(e){const t=e.$el.querySelector(".atk-avatar"),n=P("<img />"),s=e.opts.avatarURLBuilder;if(n.src=s?s(e.data):e.comment.getGravatarURL(),e.data.link){const s=P('<a target="_blank" rel="noreferrer noopener nofollow"></a>');s.href=ys(e.data.link)?e.data.link:`https://${e.data.link}`,s.append(n),t.append(s)}else t.append(n)}function Kl(e){Object.entries({renderNick:Zl,renderVerifyBadge:Ql,renderDate:Yl,renderUABadge:Xl}).forEach((([t,n])=>{n(e)}))}function Zl(e){if(e.$headerNick=e.$el.querySelector(".atk-nick"),e.data.link){const t=P('<a target="_blank" rel="noreferrer noopener nofollow"></a>');t.innerText=e.data.nick,t.href=ys(e.data.link)?e.data.link:`https://${e.data.link}`,e.$headerNick.append(t)}else e.$headerNick.innerText=e.data.nick}function Ql(e){e.$headerBadgeWrap=e.$el.querySelector(".atk-badge-wrap"),e.$headerBadgeWrap.innerHTML="";const t=e.data.badge_name,n=e.data.badge_color;if(t){const s=P('<span class="atk-badge"></span>');s.innerText=t.replace("管理员",w("admin")),s.style.backgroundColor=n||"",e.$headerBadgeWrap.append(s)}else if(e.data.is_verified){const t=P(`<span class="atk-verified-icon" title="${w("emailVerified")}"></span>`);e.$headerBadgeWrap.append(t)}if(e.data.is_pinned){const t=P(`<span class="atk-pinned-badge">${w("pin")}</span>`);e.$headerBadgeWrap.append(t)}}function Yl(e){const t=e.$el.querySelector(".atk-date");t.innerText=e.comment.getDateFormatted(),t.setAttribute("data-atk-comment-date",String(+new Date(e.data.date)))}function Xl(e){if(!e.opts.uaBadge&&!e.data.ip_region)return;let t=e.$header.querySelector("atk-ua-wrap");if(t||(t=P('<span class="atk-ua-wrap"></span>'),e.$header.append(t)),t.innerHTML="",e.data.ip_region){const n=P('<span class="atk-region-badge"></span>');n.innerText=e.data.ip_region,t.append(n)}if(e.opts.uaBadge){const{browser:n,os:s}=e.comment.getUserUA();if(String(n).trim()){const e=P('<span class="atk-ua ua-browser"></span>');e.innerText=n,t.append(e)}if(String(s).trim()){const e=P('<span class="atk-ua ua-os"></span>');e.innerText=s,t.append(e)}}}function Jl(e){if(!e.data.is_collapsed)return e.$content.innerHTML=e.comment.getContentMarked(),void e.$content.classList.remove("atk-hide","atk-collapsed");e.$content.classList.add("atk-hide","atk-type-collapsed");const t=P(`\n    <div class="atk-collapsed">\n      <span class="atk-text">${w("collapsedMsg")}</span>\n      <span class="atk-show-btn">${w("expand")}</span>\n    </div>`);e.$body.insertAdjacentElement("beforeend",t);const n=t.querySelector(".atk-show-btn");n.addEventListener("click",(t=>{t.stopPropagation(),e.$content.classList.contains("atk-hide")?(e.$content.innerHTML=e.comment.getContentMarked(),e.$content.classList.remove("atk-hide"),Hn(e.$content),n.innerText=w("collapse")):(e.$content.innerHTML="",e.$content.classList.add("atk-hide"),n.innerText=w("expand"))}))}function ec(e){e.opts.flatMode||0===e.data.rid||e.opts.replyTo&&(e.$replyAt=P('<span class="atk-item atk-reply-at"><span class="atk-arrow"></span><span class="atk-nick"></span></span>'),e.$replyAt.querySelector(".atk-nick").innerText=`${e.opts.replyTo.nick}`,e.$replyAt.onclick=()=>{e.comment.getActions().goToReplyComment()},e.$headerBadgeWrap.insertAdjacentElement("afterend",e.$replyAt))}function tc(e){if(!e.opts.flatMode||!e.opts.replyTo)return;e.$replyTo=P(`\n    <div class="atk-reply-to">\n      <div class="atk-meta">${w("reply")} <span class="atk-nick"></span>:</div>\n      <div class="atk-content"></div>\n    </div>`);const t=e.$replyTo.querySelector(".atk-nick");t.innerText=`@${e.opts.replyTo.nick}`,t.onclick=()=>{e.comment.getActions().goToReplyComment()};let n=fs(e.opts.replyTo.content);e.opts.replyTo.is_collapsed&&(n=`[${w("collapsed")}]`),e.$replyTo.querySelector(".atk-content").innerHTML=n,e.$body.prepend(e.$replyTo)}function nc(e){if(!e.data.is_pending)return;const t=P(`<div class="atk-pending">${w("pendingMsg")}</div>`);e.$body.prepend(t)}class et{constructor(e){h(this,"opts"),h(this,"$el"),h(this,"isLoading",!1),h(this,"msgRecTimer"),h(this,"msgRecTimerFunc"),h(this,"isConfirming",!1),h(this,"confirmRecTimer"),this.$el=P('<span class="atk-common-action-btn"></span>'),this.opts="object"!=typeof e?{text:e}:e,this.$el.innerText=this.getText(),this.opts.adminOnly&&this.$el.setAttribute("atk-only-admin-show","")}get isMessaging(){return!!this.msgRecTimer}appendTo(e){return e.append(this.$el),this}getText(){return"string"==typeof this.opts.text?this.opts.text:this.opts.text()}setClick(e){this.$el.onclick=t=>{if(t.stopPropagation(),!this.isLoading){if(this.opts.confirm&&!this.isMessaging){const e=()=>{this.isConfirming=!1,this.$el.classList.remove("atk-btn-confirm"),this.$el.innerText=this.getText()};if(!this.isConfirming)return this.isConfirming=!0,this.$el.classList.add("atk-btn-confirm"),this.$el.innerText=this.opts.confirmText||w("actionConfirm"),void(this.confirmRecTimer=window.setTimeout((()=>e()),5e3));this.confirmRecTimer&&window.clearTimeout(this.confirmRecTimer),e()}if(this.msgRecTimer)return this.fireMsgRecTimer(),void this.clearMsgRecTimer();e()}}}updateText(e){e&&(this.opts.text=e),this.setLoading(!1),this.$el.innerText=this.getText()}setLoading(e,t){this.isLoading!==e&&(this.isLoading=e,e?(this.$el.classList.add("atk-btn-loading"),this.$el.innerText=t||`${w("loading")}...`):(this.$el.classList.remove("atk-btn-loading"),this.$el.innerText=this.getText()))}setError(e){this.setMsg(e,"atk-btn-error")}setWarn(e){this.setMsg(e,"atk-btn-warn")}setSuccess(e){this.setMsg(e,"atk-btn-success")}setMsg(e,t,n,s){this.setLoading(!1),t&&this.$el.classList.add(t),this.$el.innerText=e,this.setMsgRecTimer((()=>{this.$el.innerText=this.getText(),t&&this.$el.classList.remove(t),s&&s()}),n||2500)}setMsgRecTimer(e,t){this.fireMsgRecTimer(),this.clearMsgRecTimer(),this.msgRecTimerFunc=e,this.msgRecTimer=window.setTimeout((()=>{e(),this.clearMsgRecTimer()}),t)}fireMsgRecTimer(){this.msgRecTimerFunc&&this.msgRecTimerFunc()}clearMsgRecTimer(){this.msgRecTimer&&window.clearTimeout(this.msgRecTimer),this.msgRecTimer=void 0,this.msgRecTimerFunc=void 0}}function sc(e){Object.entries({renderVote:ic,renderReply:oc,renderCollapse:rc,renderModerator:ac,renderPin:lc,renderEdit:cc,renderDel:dc}).forEach((([t,n])=>{n(e)}))}function ic(e){e.opts.vote&&(e.voteBtnUp=new et((()=>`${w("voteUp")} (${e.data.vote_up||0})`)).appendTo(e.$actions),e.voteBtnUp.setClick((()=>{e.comment.getActions().vote("up")})),e.opts.voteDown&&(e.voteBtnDown=new et((()=>`${w("voteDown")} (${e.data.vote_down||0})`)).appendTo(e.$actions),e.voteBtnDown.setClick((()=>{e.comment.getActions().vote("down")}))))}function oc(e){if(!e.data.is_allow_reply)return;const t=P(`<span>${w("reply")}</span>`);e.$actions.append(t),t.addEventListener("click",(t=>{t.stopPropagation(),e.opts.replyComment(e.data,e.$el)}))}function rc(e){const t=new et({text:()=>e.data.is_collapsed?w("expand"):w("collapse"),adminOnly:!0});t.appendTo(e.$actions),t.setClick((()=>{e.comment.getActions().adminEdit("collapsed",t)}))}function ac(e){const t=new et({text:()=>e.data.is_pending?w("pending"):w("approved"),adminOnly:!0});t.appendTo(e.$actions),t.setClick((()=>{e.comment.getActions().adminEdit("pending",t)}))}function lc(e){const t=new et({text:()=>e.data.is_pinned?w("unpin"):w("pin"),adminOnly:!0});t.appendTo(e.$actions),t.setClick((()=>{e.comment.getActions().adminEdit("pinned",t)}))}function cc(e){const t=new et({text:w("edit"),adminOnly:!0});t.appendTo(e.$actions),t.setClick((()=>{e.opts.editComment(e.data,e.$el)}))}function dc(e){const t=new et({text:w("delete"),confirm:!0,confirmText:w("deleteConfirm"),adminOnly:!0});t.appendTo(e.$actions),t.setClick((()=>{e.comment.getActions().adminDelete(t)}))}const hc={Avatar:Gl,Header:Kl,Content:Jl,ReplyAt:ec,ReplyTo:tc,Pending:nc,Actions:sc};function uc(e){Object.entries(hc).forEach((([t,n])=>{n(e)}))}class pc{constructor(e){h(this,"comment"),h(this,"$el"),h(this,"$main"),h(this,"$header"),h(this,"$headerNick"),h(this,"$headerBadgeWrap"),h(this,"$body"),h(this,"$content"),h(this,"$childrenWrap"),h(this,"$actions"),h(this,"voteBtnUp"),h(this,"voteBtnDown"),h(this,"$replyTo"),h(this,"$replyAt"),this.comment=e}get data(){return this.comment.getData()}get opts(){return this.comment.getOpts()}render(){return this.$el=P(Vl),this.$main=this.$el.querySelector(".atk-main"),this.$header=this.$el.querySelector(".atk-header"),this.$body=this.$el.querySelector(".atk-body"),this.$content=this.$body.querySelector(".atk-content"),this.$actions=this.$el.querySelector(".atk-actions"),this.$el.setAttribute("id",`atk-comment-${this.data.id}`),uc(this),this.$childrenWrap&&this.$main.append(this.$childrenWrap),this.$el}checkHeightLimit(){const e=this.opts.heightLimit;if(!e||!e.content||!e.children)return;const t=e.content,n=e.children;Nl({afterExpandBtnClick:()=>{const e=this.comment.getChildren();1===e.length&&Nn(e[0].getRender().$content)},scrollable:e.scrollable},[{el:this.$content,max:t,imgCheck:!0},{el:this.$replyTo,max:t,imgCheck:!0},{el:this.$childrenWrap,max:n,imgCheck:!1}])}heightLimitRemoveForChildren(){this.$childrenWrap&&Nn(this.$childrenWrap)}playFadeAnim(){Hn(this.comment.getRender().$el)}playFadeAnimForBody(){Hn(this.comment.getRender().$body)}playFlashAnim(){this.$el.classList.remove("atk-flash-once"),window.setTimeout((()=>{this.$el.classList.add("atk-flash-once")}),150)}getChildrenWrap(){return this.$childrenWrap||(this.$childrenWrap=P('<div class="atk-comment-children"></div>'),this.$main.append(this.$childrenWrap)),this.$childrenWrap}setUnread(e){e?this.$el.classList.add("atk-unread"):this.$el.classList.remove("atk-unread")}setOpenable(e){e?this.$el.classList.add("atk-openable"):this.$el.classList.remove("atk-openable")}setOpenURL(e){this.setOpenable(!0),this.$el.onclick=t=>{t.stopPropagation(),window.open(e)}}setOpenAction(e){this.setOpenable(!0),this.$el.onclick=t=>{t.stopPropagation(),e()}}}class fc{constructor(e){h(this,"comment"),this.comment=e}get data(){return this.comment.getData()}get opts(){return this.comment.getOpts()}getApi(){return this.comment.getOpts().getApi()}vote(e){const t="up"===e?this.comment.getRender().voteBtnUp:this.comment.getRender().voteBtnDown;this.getApi().votes.vote(`comment_${e}`,this.data.id,y({},this.getApi().getUserFields())).then((e=>{var t,n;this.data.vote_up=e.data.up,this.data.vote_down=e.data.down,null==(t=this.comment.getRender().voteBtnUp)||t.updateText(),null==(n=this.comment.getRender().voteBtnDown)||n.updateText()})).catch((e=>{t?.setError(w("voteFail")),console.error(e)}))}adminEdit(e,t){if(t.isLoading)return;t.setLoading(!0,`${w("editing")}...`);const n=y({},this.data);"collapsed"===e?n.is_collapsed=!n.is_collapsed:"pending"===e?n.is_pending=!n.is_pending:"pinned"===e&&(n.is_pinned=!n.is_pinned),this.getApi().comments.updateComment(this.data.id,y({},n)).then((e=>{t.setLoading(!1),this.comment.setData(e.data)})).catch((e=>{console.error(e),t.setError(w("editFail"))}))}adminDelete(e){e.isLoading||(e.setLoading(!0,`${w("deleting")}...`),this.getApi().comments.deleteComment(this.data.id).then((()=>{e.setLoading(!1),this.opts.onDelete&&this.opts.onDelete(this.comment)})).catch((t=>{console.error(t),e.setError(w("deleteFail"))})))}goToReplyComment(){const e=window.location.hash,t=`#atk-comment-${this.data.rid}`;window.location.hash=t,t===e&&window.dispatchEvent(new Event("hashchange"))}}class mc{constructor(e,t){h(this,"$el"),h(this,"renderInstance"),h(this,"actionInstance"),h(this,"data"),h(this,"opts"),h(this,"parent"),h(this,"children",[]),h(this,"nestCurt"),this.opts=t,this.data=y({},e),this.data.date=this.data.date.replace(/-/g,"/"),this.parent=null,this.nestCurt=1,this.actionInstance=new fc(this),this.renderInstance=new pc(this)}render(){const e=this.renderInstance.render();this.$el&&this.$el.replaceWith(e),this.$el=e,this.opts.onAfterRender&&this.opts.onAfterRender()}getActions(){return this.actionInstance}getRender(){return this.renderInstance}getData(){return this.data}setData(e){this.data=e,this.render(),this.getRender().playFadeAnimForBody()}getParent(){return this.parent}getChildren(){return this.children}getNestCurt(){return this.nestCurt}getIsRoot(){return 0===this.data.rid}getID(){return this.data.id}putChild(e,t="append"){e.parent=this,e.nestCurt=this.nestCurt+1,this.children.push(e);const n=this.getChildrenWrapEl(),s=e.getEl();"append"===t?n.append(s):"prepend"===t&&n.prepend(s),e.getRender().playFadeAnim(),e.getRender().checkHeightLimit()}getChildrenWrapEl(){return this.nestCurt>=this.opts.nestMax?this.parent.getChildrenWrapEl():this.getRender().getChildrenWrap()}getParents(){const e=[];let t=this.parent;for(;t;)e.push(t),t=t.getParent();return e}getEl(){if(!this.$el)throw new Error("comment element not initialized before `getEl()`");return this.$el}focus(){if(!this.$el)throw new Error("comment element not initialized before `focus()`");this.getParents().forEach((e=>{e.getRender().heightLimitRemoveForChildren()})),this.scrollIntoView(),this.getRender().playFlashAnim()}scrollIntoView(){this.$el&&ao(this.$el,!1,this.opts.scrollRelativeTo&&this.opts.scrollRelativeTo())}remove(){var e;null==(e=this.$el)||e.remove()}getGravatarURL(){return hl({mirror:this.opts.gravatar.mirror,params:this.opts.gravatar.params,emailHash:this.data.email_encrypted})}getContentMarked(){return fs(this.data.content)}getDateFormatted(){var e,t;const n=new Date(this.data.date);return(null==(t=(e=this.opts).dateFormatter)?void 0:t.call(e,n))||so(n,w)}getUserUA(){const e=Hl(this.data.ua);return{browser:`${e.browser} ${e.version}`,os:`${e.os} ${e.osVersion}`}}getOpts(){return this.opts}}function gc(e,t,n,s){const i=new mc(t,{onAfterRender:()=>{e.trigger("comment-rendered",i)},onDelete:t=>{e.getData().deleteComment(t.getID())},replyTo:n,flatMode:"boolean"==typeof s?.forceFlatMode?s?.forceFlatMode:e.conf.flatMode,gravatar:e.conf.gravatar,nestMax:e.conf.nestMax,heightLimit:e.conf.heightLimit,avatarURLBuilder:e.conf.avatarURLBuilder,scrollRelativeTo:e.conf.scrollRelativeTo,vote:e.conf.vote,voteDown:e.conf.voteDown,uaBadge:e.conf.uaBadge,dateFormatter:e.conf.dateFormatter,getApi:()=>e.getApi(),replyComment:(t,n)=>e.replyComment(t,n),editComment:(t,n)=>e.editComment(t,n)});return i.render(),i}class yc{constructor(e){h(this,"opts"),h(this,"$el"),h(this,"$loading"),h(this,"$text"),h(this,"offset",0),h(this,"total",0),h(this,"origText","Load More"),this.opts=e,this.origText=this.opts.text||this.origText,this.$el=P(`<div class="atk-list-read-more" style="display: none;">\n      <div class="atk-list-read-more-inner">\n        <div class="atk-loading-icon" style="display: none;"></div>\n        <span class="atk-text">${this.origText}</span>\n      </div>\n    </div>`),this.$loading=this.$el.querySelector(".atk-loading-icon"),this.$text=this.$el.querySelector(".atk-text"),this.$el.onclick=()=>{this.click()}}get hasMore(){return this.total>this.offset+this.opts.pageSize}click(){this.hasMore&&this.opts.onClick(this.offset+this.opts.pageSize),this.checkDisabled()}show(){this.$el.style.display=""}hide(){this.$el.style.display="none"}setLoading(e){this.$loading.style.display=e?"":"none",this.$text.style.display=e?"none":""}showErr(e){this.setLoading(!1),this.$text.innerText=e,this.$el.classList.add("atk-err"),window.setTimeout((()=>{this.$text.innerText=this.origText,this.$el.classList.remove("atk-err")}),2e3)}update(e,t){this.offset=e,this.total=t,this.checkDisabled()}checkDisabled(){this.hasMore?this.show():this.hide()}}class vc{constructor(){h(this,"instance"),h(this,"onReachedBottom",null),h(this,"opt")}create(e){return this.opt=e,this.instance=new yc({pageSize:e.pageSize,onClick:t=>G(this,null,(function*(){e.ctx.fetch({offset:t})})),text:w("loadMore")}),e.readMoreAutoLoad&&(this.onReachedBottom=()=>{!this.instance.hasMore||this.opt.ctx.getData().getLoading()||this.instance.click()},this.opt.ctx.on("list-reach-bottom",this.onReachedBottom)),this.instance.$el}setLoading(e){this.instance.setLoading(e)}update(e,t){this.instance.update(e,t)}showErr(e){this.instance.showErr(e)}next(){this.instance.click()}getHasMore(){return this.instance.hasMore}getIsClearComments(e){return 0===e.offset}dispose(){this.onReachedBottom&&this.opt.ctx.off("list-reach-bottom",this.onReachedBottom),this.instance.$el.remove()}}class kc{constructor(e,t){h(this,"opts"),h(this,"total"),h(this,"$el"),h(this,"$input"),h(this,"inputTimer"),h(this,"$prevBtn"),h(this,"$nextBtn"),h(this,"page",1),this.total=e,this.opts=t,this.$el=P('<div class="atk-pagination-wrap">\n        <div class="atk-pagination">\n          <div class="atk-btn atk-btn-prev" aria-label="Previous page">\n            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="14px" width="14px" xmlns="http://www.w3.org/2000/svg"><path d="M217.9 256L345 129c9.4-9.4 9.4-24.6 0-33.9-9.4-9.4-24.6-9.3-34 0L167 239c-9.1 9.1-9.3 23.7-.7 33.1L310.9 417c4.7 4.7 10.9 7 17 7s12.3-2.3 17-7c9.4-9.4 9.4-24.6 0-33.9L217.9 256z"></path></svg>\n          </div>\n          <input type="text" class="atk-input" aria-label="Enter the number of page" />\n          <div class="atk-btn atk-btn-next" aria-label="Next page">\n            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="14px" width="14px" xmlns="http://www.w3.org/2000/svg"><path d="M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z"></path></svg>\n          </div>\n        </div>\n      </div>'),this.$input=this.$el.querySelector(".atk-input"),this.$input.value=`${this.page}`,this.$input.oninput=()=>this.input(),this.$input.onkeydown=e=>this.keydown(e),this.$prevBtn=this.$el.querySelector(".atk-btn-prev"),this.$nextBtn=this.$el.querySelector(".atk-btn-next"),this.$prevBtn.onclick=()=>this.prev(),this.$nextBtn.onclick=()=>this.next(),this.checkDisabled()}get pageSize(){return this.opts.pageSize}get offset(){return this.pageSize*(this.page-1)}get maxPage(){return Math.ceil(this.total/this.pageSize)}update(e,t){this.page=Math.ceil(e/this.pageSize)+1,this.total=t,this.setInput(this.page),this.checkDisabled()}setInput(e){this.$input.value=`${e}`}input(e=!1){window.clearTimeout(this.inputTimer);const t=this.$input.value.trim(),n=()=>{if(""===t)return void this.setInput(this.page);let e=Number(t);Number.isNaN(e)||e<1?this.setInput(this.page):(e>this.maxPage&&(this.setInput(this.maxPage),e=this.maxPage),this.change(e))};e?n():this.inputTimer=window.setTimeout((()=>n()),800)}prev(){const e=this.page-1;e<1||this.change(e)}next(){const e=this.page+1;e>this.maxPage||this.change(e)}getHasMore(){return this.page+1<=this.maxPage}change(e){this.page=e,this.opts.onChange(this.offset),this.setInput(e),this.checkDisabled()}checkDisabled(){this.page+1>this.maxPage?this.$nextBtn.classList.add("atk-disabled"):this.$nextBtn.classList.remove("atk-disabled"),this.page-1<1?this.$prevBtn.classList.add("atk-disabled"):this.$prevBtn.classList.remove("atk-disabled")}keydown(e){const t=e.keyCode||e.which;if(38===t){const e=Number(this.$input.value)+1;if(e>this.maxPage)return;this.setInput(e),this.input()}else if(40===t){const e=Number(this.$input.value)-1;if(e<1)return;this.setInput(e),this.input()}else 13===t&&this.input(!0)}setLoading(e){e?dt(this.$el):je(this.$el)}}class wc{constructor(){h(this,"instance")}create(e){return this.instance=new kc(e.total,{pageSize:e.pageSize,onChange:t=>G(this,null,(function*(){e.ctx.editorResetState(),e.ctx.fetch({offset:t,onSuccess:()=>{e.ctx.listGotoFirst()}})}))}),this.instance.$el}setLoading(e){this.instance.setLoading(e)}update(e,t){this.instance.update(e,t)}next(){this.instance.next()}getHasMore(){return this.instance.getHasMore()}getIsClearComments(){return!0}dispose(){this.instance.$el.remove()}}function bc(e){return e.pagination.readMore?new vc:new wc}function Ys(e){const t=e.getData().getListLastFetch(),n={offset:0,total:0};return t&&(n.offset=t.params.offset,t.data&&(n.total=t.params.flatMode?t.data.count:t.data.roots_count)),n}const $c=e=>{let t=null;e.watchConf(["pagination","locale"],(n=>{const s=e.get("list");t&&t.dispose(),t=bc(n);const{offset:i,total:o}=Ys(e),r=t.create({ctx:e,pageSize:n.pagination.pageSize,total:o,readMoreAutoLoad:n.pagination.autoLoad});s.$commentsWrap.after(r),t?.update(i,o)})),e.on("list-loaded",(n=>{const{offset:s,total:i}=Ys(e);t?.update(s,i)})),e.on("list-fetch",(n=>{e.getData().getComments().length>0&&t?.getIsClearComments(n)&&e.getData().clearComments()})),e.on("list-failed",(()=>{var e;null==(e=t?.showErr)||e.call(t,w("loadFail"))})),e.on("list-fetch",(e=>{t?.setLoading(!0)})),e.on("list-fetched",(({params:e})=>{t?.setLoading(!1)}))};class xc extends vs{constructor(e){super(e),h(this,"$commentsWrap"),h(this,"commentNodes",[]),this.$el=P(Bl),this.$commentsWrap=this.$el.querySelector(".atk-list-comments-wrap"),$c(e),this.initCrudEvents()}getCommentsWrapEl(){return this.$commentsWrap}getCommentNodes(){return this.commentNodes}getListLayout({forceFlatMode:e}={}){return new zl({$commentsWrap:this.$commentsWrap,nestSortBy:this.ctx.conf.nestSort,nestMax:this.ctx.conf.nestMax,flatMode:"boolean"==typeof e?e:this.ctx.conf.flatMode,createCommentNode:(t,n)=>{const s=gc(this.ctx,t,n,{forceFlatMode:e});return this.commentNodes.push(s),s},findCommentNode:e=>this.commentNodes.find((t=>t.getID()===e))})}initCrudEvents(){this.ctx.on("list-load",(e=>{this.getListLayout().import(e)})),this.ctx.on("list-loaded",(e=>{0===e.length&&(this.commentNodes=[],this.$commentsWrap.innerHTML="")})),this.ctx.on("comment-inserted",(e=>{var t;const n=e.rid?null==(t=this.commentNodes.find((t=>t.getID()===e.rid)))?void 0:t.getData():void 0;this.getListLayout().insert(e,n)})),this.ctx.on("comment-deleted",(e=>{const t=this.commentNodes.find((t=>t.getID()===e.id));t?(t.remove(),this.commentNodes=this.commentNodes.filter((t=>t.getID()!==e.id))):console.error(`comment node id=${e.id} not found`)})),this.ctx.on("comment-updated",(e=>{const t=this.commentNodes.find((t=>t.getID()===e.id));t&&t.setData(e)}))}}let Xs,Js;function jn(){return{init(){Xs=document.body.style.overflow,Js=document.body.style.paddingRight},unlock(){document.body.style.overflow=Xs,document.body.style.paddingRight=Js},lock(){document.body.style.overflow="hidden";const e=parseInt(window.getComputedStyle(document.body,null).getPropertyValue("padding-right"),10);document.body.style.paddingRight=`${xl()+e||0}px`}}}class Cc{constructor(e,t){h(this,"allowMaskClose",!0),h(this,"onAfterHide"),this.$el=e,this.opts=t}setOnAfterHide(e){this.onAfterHide=e}setAllowMaskClose(e){this.allowMaskClose=e}getAllowMaskClose(){return this.allowMaskClose}getEl(){return this.$el}show(){this.opts.onShow(),this.$el.style.display=""}hide(){this.opts.onHide(),this.$el.style.display="none",this.onAfterHide&&this.onAfterHide()}destroy(){this.opts.onHide(),this.$el.remove(),this.onAfterHide&&this.onAfterHide()}}class Sc{constructor(){h(this,"$wrap"),h(this,"$mask"),h(this,"items",[]),this.$wrap=P('<div class="atk-layer-wrap" style="display: none;"><div class="atk-layer-mask"></div></div>'),this.$mask=this.$wrap.querySelector(".atk-layer-mask")}createItem(e,t){(t=t||this.createItemElement(e)).setAttribute("data-layer-name",e),this.$wrap.appendChild(t);const n=new Cc(t,{onHide:()=>this.hideWrap(t),onShow:()=>this.showWrap()});return this.getMask().addEventListener("click",(()=>{n.getAllowMaskClose()&&n.hide()})),this.items.push(n),n}createItemElement(e){const t=document.createElement("div");return t.classList.add("atk-layer-item"),t.style.display="none",this.$wrap.appendChild(t),t}getWrap(){return this.$wrap}getMask(){return this.$mask}showWrap(){this.$wrap.style.display="block",this.$mask.style.display="block",this.$mask.classList.add("atk-fade-in"),jn().lock()}hideWrap(e){this.items.map((e=>e.getEl())).filter((t=>t!==e&&t.isConnected&&"none"!==t.style.display)).length>0||(this.$wrap.style.display="none",jn().unlock())}}class Ec{constructor(e){h(this,"wrap"),this.wrap=new Sc,document.body.appendChild(this.wrap.getWrap()),e.on("unmounted",(()=>{this.wrap.getWrap().remove()})),jn().init()}getEl(){return this.wrap.getWrap()}create(e,t){return this.wrap.createItem(e,t)}}const ei="ArtalkUser";class Tc{constructor(e){h(this,"data"),this.opts=e;const t=JSON.parse(window.localStorage.getItem(ei)||"{}");this.data={name:t.name||t.nick||"",email:t.email||"",link:t.link||"",token:t.token||"",is_admin:t.is_admin||t.isAdmin||!1}}getData(){return this.data}update(e={}){Object.entries(e).forEach((([e,t])=>{this.data[e]=t})),window.localStorage.setItem(ei,JSON.stringify(this.data)),this.opts.onUserChanged&&this.opts.onUserChanged(this.data)}logout(){this.update({token:"",is_admin:!1})}checkHasBasicUserInfo(){return!!this.data.name&&!!this.data.email}}const Lc={i18n(e){Vs(e.conf.locale),e.watchConf(["locale"],(e=>{Vs(e.locale)}))},user:e=>new Tc({onUserChanged:t=>{e.trigger("user-changed",t)}}),layerManager:e=>new Ec(e),checkerLauncher:e=>new Al({getCtx:()=>e,getApi:()=>e.getApi(),onReload:()=>e.reload(),getCaptchaIframeURL:()=>`${e.conf.server}/api/v2/captcha/?t=${+new Date}`}),editor(e){const t=new Ol(e);return e.$root.appendChild(t.$el),t},list(e){const t=new xc(e);return e.$root.appendChild(t.$el),t},sidebarLayer:e=>new Dl(e),editorPlugs(){}},Ac=e=>{e.watchConf(["site","pageKey","pageTitle","countEl","pvEl","statPageKeyAttr"],(t=>{lo({getApi:()=>e.getApi(),siteName:t.site,pageKey:t.pageKey,pageTitle:t.pageTitle,countEl:t.countEl,pvEl:t.pvEl,pageKeyAttr:t.statPageKeyAttr,pvAdd:"boolean"!=typeof e.conf.pvAdd||e.conf.pvAdd})}))};function lo(e){return G(this,null,(function*(){yield Pc(e);const t=yield _c(e);yield Ic(e,t)}))}function _c(e){return G(this,null,(function*(){if(!e.pvAdd||!e.pageKey)return;const t=(yield e.getApi().pages.logPv({page_key:e.pageKey,page_title:e.pageTitle,site_name:e.siteName})).data.pv;return{[e.pageKey]:t}}))}function Pc(e){return G(this,null,(function*(){yield co({opt:e,query:"page_comment",containers:[e.countEl,"#ArtalkCount"]})}))}function Ic(e,t){return G(this,null,(function*(){yield co({opt:e,query:"page_pv",containers:[e.pvEl,"#ArtalkPV"],cache:t})}))}function co(e){return G(this,null,(function*(){const{opt:t}=e;let n=e.cache||{};const s=Mc(e.containers),i=Oc(s,t.pageKeyAttr,t.pageKey,n);if(i.length>0){const s=(yield t.getApi().stats.getStats(e.query,{page_keys:i.join(","),site_name:t.siteName})).data.data;n=y(y({},n),s)}Rc(s,n,t.pageKey)}))}function Mc(e){const t=new Set;return new Set(e).forEach((e=>{document.querySelectorAll(e).forEach((e=>t.add(e)))})),t}function Oc(e,t,n,s){const i=Array.from(e).map((e=>e.getAttribute(t)||n)).filter((e=>e&&"number"!=typeof s[e]));return[...new Set(i)]}function Rc(e,t,n){e.forEach((e=>{const s=e.getAttribute("data-page-key"),i=s&&t[s]||n&&t[n]||0;e.innerText=`${Number(i)}`}))}const Dc=e=>{e.watchConf(["imgLazyLoad","markedOptions"],(t=>{ol({markedOptions:e.getConf().markedOptions,imgLazyLoad:e.getConf().imgLazyLoad})})),e.watchConf(["markedReplacers"],(e=>{e.markedReplacers&&il(e.markedReplacers)}))},ti="ArtalkContent";class Bc extends we{constructor(e){super(e);const t=()=>{this.save()};this.kit.useMounted((()=>{const e=window.localStorage.getItem(ti)||"";""!==e.trim()&&(this.kit.useEditor().showNotify(w("restoredMsg"),"i"),this.kit.useEditor().setContent(e)),this.kit.useEvents().on("content-updated",t)})),this.kit.useUnmounted((()=>{this.kit.useEvents().off("content-updated",t)}))}save(){window.localStorage.setItem(ti,this.kit.useEditor().getContentRaw().trim())}}class qc extends we{constructor(e){super(e);const t=e=>this.onKeydown(e),n=()=>this.onInput();this.kit.useMounted((()=>{this.kit.useUI().$textarea.placeholder=this.kit.useConf().placeholder||w("placeholder"),this.kit.useUI().$textarea.addEventListener("keydown",t),this.kit.useUI().$textarea.addEventListener("input",n)})),this.kit.useUnmounted((()=>{this.kit.useUI().$textarea.removeEventListener("keydown",t),this.kit.useUI().$textarea.removeEventListener("input",n)})),this.kit.useEvents().on("content-updated",(()=>{window.setTimeout((()=>{this.adaptiveHeightByContent()}),80)}))}onKeydown(e){9===(e.keyCode||e.which)&&(e.preventDefault(),this.kit.useEditor().insertContent("\t"))}onInput(){this.kit.useEvents().trigger("content-updated",this.kit.useEditor().getContentRaw())}adaptiveHeightByContent(){const e=this.kit.useUI().$textarea.offsetHeight-this.kit.useUI().$textarea.clientHeight;this.kit.useUI().$textarea.style.height="0px",this.kit.useUI().$textarea.style.height=`${this.kit.useUI().$textarea.scrollHeight+e}px`}}class Uc extends we{constructor(e){super(e);const t=()=>{this.kit.useEditor().submit()};this.kit.useMounted((()=>{this.kit.useUI().$submitBtn.innerText=this.kit.useConf().sendBtn||w("send"),this.kit.useUI().$submitBtn.addEventListener("click",t)})),this.kit.useUnmounted((()=>{this.kit.useUI().$submitBtn.removeEventListener("click",t)}))}}class ho{constructor(e){this.kit=e}reqAdd(){return G(this,null,(function*(){return(yield this.kit.useApi().comments.createComment(y({},yield this.getSubmitAddParams()))).data}))}getSubmitAddParams(){return G(this,null,(function*(){const{name:e,email:t,link:n}=this.kit.useUser().getData(),s=this.kit.useConf();return{content:this.kit.useEditor().getContentFinal(),name:e,email:t,link:n,rid:0,page_key:s.pageKey,page_title:s.pageTitle,site_name:s.site,ua:yield pl()}}))}postSubmitAdd(e){this.kit.useGlobalCtx().getData().insertComment(e)}}class ks extends we{constructor(e){super(e),h(this,"customs",[]),h(this,"defaultPreset"),this.defaultPreset=new ho(this.kit);const t=()=>this.do();this.kit.useMounted((()=>{this.kit.useGlobalCtx().on("editor-submit",t)})),this.kit.useUnmounted((()=>{this.kit.useGlobalCtx().off("editor-submit",t)}))}registerCustom(e){this.customs.push(e)}do(){return G(this,null,(function*(){if(""===this.kit.useEditor().getContentFinal().trim())return void this.kit.useEditor().focus();const e=this.customs.find((e=>e.activeCond()));this.kit.useEditor().showLoading();try{let t;e?.pre&&e.pre(),t=e?.req?yield e.req():yield this.defaultPreset.reqAdd(),e?.post?e.post(t):this.defaultPreset.postSubmitAdd(t)}catch(e){return console.error(e),void this.kit.useEditor().showNotify(`${w("commentFail")}: ${e.message||String(e)}`,"e")}finally{this.kit.useEditor().hideLoading()}this.kit.useEditor().reset(),this.kit.useGlobalCtx().trigger("editor-submitted")}))}}class Fc extends we{constructor(e){super(e),h(this,"comment"),this.useEditorStateEffect("reply",(e=>(this.setReply(e),()=>{this.cancelReply()}))),this.kit.useEvents().on("mounted",(()=>{const e=this.kit.useDeps(ks);if(!e)throw Error("SubmitPlug not initialized");const t=new ho(this.kit);e.registerCustom({activeCond:()=>!!this.comment,req:()=>G(this,null,(function*(){if(!this.comment)throw new Error("reply comment cannot be empty");return(yield this.kit.useApi().comments.createComment(Fe(y({},yield t.getSubmitAddParams()),{rid:this.comment.id,page_key:this.comment.page_key,page_title:void 0,site_name:this.comment.site_name}))).data})),post:e=>{const n=this.kit.useConf();e.page_key!==n.pageKey&&window.open(`${e.page_url}#atk-comment-${e.id}`),t.postSubmitAdd(e)}})}))}setReply(e){const t=this.kit.useUI();if(!t.$sendReplyBtn){const n=P(`<span class="atk-state-btn"><span class="atk-text-wrap">${w("reply")} <span class="atk-text"></span></span><span class="atk-cancel atk-icon-close atk-icon"></span></span>`);n.querySelector(".atk-text").innerText=`@${e.nick}`,n.addEventListener("click",(()=>{this.kit.useEditor().resetState()})),t.$stateWrap.append(n),t.$sendReplyBtn=n}this.comment=e,t.$textarea.focus()}cancelReply(){if(!this.comment)return;const e=this.kit.useUI();e.$sendReplyBtn&&(e.$sendReplyBtn.remove(),e.$sendReplyBtn=void 0),this.comment=void 0}}class zc extends we{constructor(e){super(e),h(this,"comment"),h(this,"originalSubmitBtnText","Send"),this.useEditorStateEffect("edit",(e=>(this.edit(e),()=>{this.cancelEdit()}))),this.kit.useMounted((()=>{const e=this.kit.useDeps(ks);if(!e)throw Error("SubmitPlug not initialized");e.registerCustom({activeCond:()=>!!this.comment,req:()=>G(this,null,(function*(){const e={content:this.kit.useEditor().getContentFinal(),nick:this.kit.useUI().$name.value,email:this.kit.useUI().$email.value,link:this.kit.useUI().$link.value},t=this.comment;return(yield this.kit.useApi().comments.updateComment(t.id,y(y({},t),e))).data})),post:e=>{this.kit.useGlobalCtx().getData().updateComment(e)}})}))}edit(e){const t=this.kit.useUI();if(!t.$editCancelBtn){const e=P(`<span class="atk-state-btn"><span class="atk-text-wrap">${w("editCancel")}</span><span class="atk-cancel atk-icon-close atk-icon"></span></span>`);e.onclick=()=>{this.kit.useEditor().resetState()},t.$stateWrap.append(e),t.$editCancelBtn=e}this.comment=e,t.$header.style.display="none",t.$name.value=e.nick||"",t.$email.value=e.email||"",t.$link.value=e.link||"",this.kit.useEditor().setContent(e.content),t.$textarea.focus(),this.updateSubmitBtnText(w("save"))}cancelEdit(){if(!this.comment)return;const e=this.kit.useUI();e.$editCancelBtn&&(e.$editCancelBtn.remove(),e.$editCancelBtn=void 0),this.comment=void 0;const{name:t,email:n,link:s}=this.kit.useUser().getData();e.$name.value=t,e.$email.value=n,e.$link.value=s,this.kit.useEditor().setContent(""),this.restoreSubmitBtnText(),e.$header.style.display=""}updateSubmitBtnText(e){this.originalSubmitBtnText=this.kit.useUI().$submitBtn.innerText,this.kit.useUI().$submitBtn.innerText=e}restoreSubmitBtnText(){this.kit.useUI().$submitBtn.innerText=this.originalSubmitBtnText}}class Hc extends we{constructor(e){super(e);const t=()=>this.open(),n=()=>this.close();this.kit.useMounted((()=>{this.kit.useEvents().on("editor-open",t),this.kit.useEvents().on("editor-close",n)})),this.kit.useUnmounted((()=>{this.kit.useEvents().off("editor-open",t),this.kit.useEvents().off("editor-close",n)}))}open(){var e;null==(e=this.kit.useUI().$textareaWrap.querySelector(".atk-comment-closed"))||e.remove(),this.kit.useUI().$textarea.style.display="",this.kit.useUI().$bottom.style.display=""}close(){this.kit.useUI().$textareaWrap.querySelector(".atk-comment-closed")||this.kit.useUI().$textareaWrap.prepend(P(`<div class="atk-comment-closed">${w("onlyAdminCanReply")}</div>`)),this.kit.useUser().getData().is_admin?(this.kit.useUI().$textarea.style.display="",this.kit.useUI().$bottom.style.display=""):(this.kit.useUI().$textarea.style.display="none",this.kit.useEvents().trigger("panel-close"),this.kit.useUI().$bottom.style.display="none")}}class Nc extends we{get $inputs(){return this.kit.useEditor().getHeaderInputEls()}constructor(e){super(e);const t={},n={},s=(e,t,n)=>()=>{this.kit.useEvents().trigger(e,{field:n,$input:t})};this.kit.useMounted((()=>{Object.entries(this.$inputs).forEach((([e,i])=>{i.addEventListener("input",t[e]=s("header-input",i,e)),i.addEventListener("change",n[e]=s("header-change",i,e))}))})),this.kit.useUnmounted((()=>{Object.entries(this.$inputs).forEach((([e,s])=>{s.removeEventListener("input",t[e]),s.removeEventListener("change",n[e])}))}))}}class jc extends we{constructor(e){super(e),h(this,"query",{timer:null,abortFn:null});const t=({$input:e,field:t})=>{"edit"!==this.kit.useEditor().getState()&&(this.kit.useUser().update({[t]:e.value.trim()}),("name"===t||"email"===t)&&this.fetchUserInfo())},n={name:w("nick"),email:w("email"),link:w("link")};this.kit.useMounted((()=>{Object.entries(this.kit.useEditor().getHeaderInputEls()).forEach((([e,t])=>{t.placeholder=n[e],t.value=this.kit.useUser().getData()[e]||""})),this.kit.useEvents().on("header-input",t)})),this.kit.useUnmounted((()=>{this.kit.useEvents().off("header-input",t)}))}fetchUserInfo(){this.kit.useUser().logout(),this.query.timer&&window.clearTimeout(this.query.timer),this.query.abortFn&&this.query.abortFn(),this.query.timer=window.setTimeout((()=>{this.query.timer=null;const e=this.kit.useApi(),t="getUserCancelToken";this.query.abortFn=()=>e.abortRequest(t),e.user.getUser(y({},e.getUserFields()),{cancelToken:t}).then((e=>this.onUserInfoFetched(e.data))).catch((e=>{})).finally((()=>{this.query.abortFn=null}))}),400)}onUserInfoFetched(e){var t;e.is_login||this.kit.useUser().logout(),this.kit.useGlobalCtx().getData().updateNotifies(e.notifies),this.kit.useUser().checkHasBasicUserInfo()&&!e.is_login&&null!=(t=e.user)&&t.is_admin&&this.kit.useGlobalCtx().checkAdmin({onSuccess:()=>{}}),e.user&&e.user.link&&(this.kit.useUI().$link.value=e.user.link,this.kit.useUser().update({link:e.user.link}))}}class Wc extends we{constructor(e){super(e);const t=({field:e})=>{"link"===e&&this.onLinkInputChange()};this.kit.useMounted((()=>{this.kit.useEvents().on("header-change",t)})),this.kit.useUnmounted((()=>{this.kit.useEvents().off("header-change",t)}))}onLinkInputChange(){const e=this.kit.useUI().$link.value.trim();e&&!/^(http|https):\/\//.test(e)&&(this.kit.useUI().$link.value=`https://${e}`,this.kit.useUser().update({link:this.kit.useUI().$link.value}))}}class uo extends we{constructor(e){super(e),h(this,"emoticons",[]),h(this,"loadingTask",null),h(this,"$grpWrap"),h(this,"$grpSwitcher"),h(this,"isListLoaded",!1),h(this,"isImgLoaded",!1),this.kit.useMounted((()=>{this.usePanel('<div class="atk-editor-plug-emoticons"></div>'),this.useBtn(`<i aria-label="${w("emoticon")}"><svg fill="currentColor" aria-hidden="true" height="14" viewBox="0 0 14 14" width="14"><path d="m4.26829 5.29294c0-.94317.45893-1.7074 1.02439-1.7074.56547 0 1.02439.76423 1.02439 1.7074s-.45892 1.7074-1.02439 1.7074c-.56546 0-1.02439-.76423-1.02439-1.7074zm4.43903 1.7074c.56546 0 1.02439-.76423 1.02439-1.7074s-.45893-1.7074-1.02439-1.7074c-.56547 0-1.02439.76423-1.02439 1.7074s.45892 1.7074 1.02439 1.7074zm-1.70732 2.73184c-1.51883 0-2.06312-1.52095-2.08361-1.58173l-1.29551.43231c.03414.10244.868 2.51604 3.3798 2.51604 2.51181 0 3.34502-2.41291 3.37982-2.51604l-1.29484-.43573c-.02254.06488-.56683 1.58583-2.08498 1.58583zm7-2.73252c0 3.86004-3.1401 7.00034-7 7.00034s-7-3.1396-7-6.99966c0-3.86009 3.1401-7.00034 7-7.00034s7 3.14025 7 7.00034zm-1.3659 0c0-3.10679-2.5275-5.63442-5.6341-5.63442-3.10663 0-5.63415 2.52832-5.63415 5.6351 0 3.10676 2.52752 5.63446 5.63415 5.63446 3.1066 0 5.6341-2.5277 5.6341-5.63446z"/></svg></i>`)})),this.kit.useUnmounted((()=>{})),this.useContentTransformer((e=>this.transEmoticonImageText(e))),this.usePanelShow((()=>{G(this,null,(function*(){yield this.loadEmoticonsData(),this.isImgLoaded||(this.initEmoticonsList(),this.isImgLoaded=!0),setTimeout((()=>{this.changeListHeight()}),30)}))})),this.usePanelHide((()=>{this.$panel.parentElement.style.height=""})),window.setTimeout((()=>{this.loadEmoticonsData()}),1e3)}loadEmoticonsData(){return G(this,null,(function*(){if(!this.isListLoaded){if(null!==this.loadingTask)return void(yield this.loadingTask);this.loadingTask=G(this,null,(function*(){dt(this.$panel),this.emoticons=yield this.handleData(this.kit.useConf().emoticons),je(this.$panel),this.loadingTask=null,this.isListLoaded=!0})),yield this.loadingTask}}))}handleData(e){return G(this,null,(function*(){if(!Array.isArray(e)&&["object","string"].includes(typeof e)&&(e=[e]),!Array.isArray(e))return Qt(this.$panel,`[${w("emoticon")}] Data must be of Array/Object/String type`),je(this.$panel),[];const t=t=>{"object"==typeof t&&(t.name&&e.find((e=>e.name===t.name))||e.push(t))},n=e=>G(this,null,(function*(){yield Promise.all(e.map(((e,s)=>G(this,null,(function*(){if("object"!=typeof e||Array.isArray(e)){if(Array.isArray(e))yield n(e);else if("string"==typeof e){const s=yield this.remoteLoad(e);Array.isArray(s)?yield n(s):"object"==typeof s&&t(s)}}else t(e)})))))}));return yield n(e),e.forEach((e=>{this.isOwOFormat(e)?this.convertOwO(e).forEach((e=>{t(e)})):Array.isArray(e)&&e.forEach((e=>{t(e)}))})),e=e.filter((e=>"object"==typeof e&&!Array.isArray(e)&&!!e&&!!e.name)),this.solveNullKey(e),this.solveSameKey(e),e}))}remoteLoad(e){return G(this,null,(function*(){if(!e)return[];try{return yield(yield fetch(e)).json()}catch(e){return je(this.$panel),console.error("[Emoticons] Load Failed:",e),Qt(this.$panel,`[${w("emoticon")}] ${w("loadFail")}: ${String(e)}`),[]}}))}solveNullKey(e){e.forEach((e=>{e.items.forEach(((t,n)=>{t.key||(t.key=`${e.name} ${n+1}`)}))}))}solveSameKey(e){const t={};e.forEach((e=>{e.items.forEach((e=>{!e.key||""===String(e.key).trim()||(t[e.key]?t[e.key]++:t[e.key]=1,t[e.key]>1&&(e.key=`${e.key} ${t[e.key]}`))}))}))}isOwOFormat(e){try{return"object"==typeof e&&!!Object.values(e).length&&Array.isArray(Object.keys(Object.values(e)[0].container))&&Object.keys(Object.values(e)[0].container[0]).includes("icon")}catch{return!1}}convertOwO(e){const t=[];return Object.entries(e).forEach((([e,n])=>{const s={name:e,type:n.type,items:[]};n.container.forEach(((t,n)=>{const i=t.icon;if(/<(img|IMG)/.test(i)){const e=/src=["'](.*?)["']/.exec(i);e&&e.length>1&&(t.icon=e[1])}s.items.push({key:t.text||`${e} ${n+1}`,val:t.icon})})),t.push(s)})),t}initEmoticonsList(){this.$grpWrap=P('<div class="atk-grp-wrap"></div>'),this.$panel.append(this.$grpWrap),this.emoticons.forEach(((e,t)=>{const n=P('<div class="atk-grp" style="display: none;"></div>');this.$grpWrap.append(n),n.setAttribute("data-index",String(t)),n.setAttribute("data-grp-name",e.name),n.setAttribute("data-type",e.type),e.items.forEach((t=>{const s=P('<span class="atk-item"></span>');if(n.append(s),t.key&&!new RegExp(`^(${e.name})?\\s?[0-9]+$`).test(t.key)&&s.setAttribute("title",t.key),"image"===e.type){const e=document.createElement("img");e.src=t.val,e.alt=t.key,s.append(e)}else s.innerText=t.val;s.onclick=()=>{"image"===e.type?this.kit.useEditor().insertContent(`:[${t.key}]`):this.kit.useEditor().insertContent(t.val||"")}}))})),this.emoticons.length>1&&(this.$grpSwitcher=P('<div class="atk-grp-switcher"></div>'),this.$panel.append(this.$grpSwitcher),this.emoticons.forEach(((e,t)=>{const n=P("<span />");n.innerText=e.name,n.setAttribute("data-index",String(t)),n.onclick=()=>this.openGrp(t),this.$grpSwitcher.append(n)}))),this.emoticons.length>0&&this.openGrp(0)}openGrp(e){var t,n,s;Array.from(this.$grpWrap.children).forEach((t=>{const n=t;n.getAttribute("data-index")!==String(e)?n.style.display="none":n.style.display=""})),null==(t=this.$grpSwitcher)||t.querySelectorAll("span.active").forEach((e=>e.classList.remove("active"))),null==(s=null==(n=this.$grpSwitcher)?void 0:n.querySelector(`span[data-index="${e}"]`))||s.classList.add("active"),this.changeListHeight()}changeListHeight(){}transEmoticonImageText(e){return!this.emoticons||!Array.isArray(this.emoticons)||this.emoticons.forEach((t=>{"image"===t.type&&Object.entries(t.items).forEach((([t,n])=>{e=e.split(`:[${n.key}]`).join(`<img src="${n.val}" atk-emoticon="${n.key}">`)}))})),e}}const ni=["png","jpg","jpeg","gif","bmp","svg","webp"];class po extends we{constructor(e){super(e),h(this,"$imgUploadInput"),this.kit.useMounted((()=>this.init())),this.initDragImg()}init(){this.$imgUploadInput=document.createElement("input"),this.$imgUploadInput.type="file",this.$imgUploadInput.style.display="none",this.$imgUploadInput.accept=ni.map((e=>`.${e}`)).join(",");const e=this.useBtn(`<i aria-label="${w("uploadImage")}"><svg fill="currentColor" aria-hidden="true" height="14" viewBox="0 0 14 14" width="14"><path d="m0 1.94444c0-1.074107.870333-1.94444 1.94444-1.94444h10.11116c1.0741 0 1.9444.870333 1.9444 1.94444v10.11116c0 1.0741-.8703 1.9444-1.9444 1.9444h-10.11116c-1.074107 0-1.94444-.8703-1.94444-1.9444zm1.94444-.38888c-.21466 0-.38888.17422-.38888.38888v7.06689l2.33333-2.33333 2.33333 2.33333 3.88888-3.88889 2.3333 2.33334v-5.51134c0-.21466-.1742-.38888-.3888-.38888zm10.49996 8.09977-2.3333-2.33333-3.88888 3.8889-2.33333-2.33334-2.33333 2.33334v.8447c0 .2146.17422.3888.38888.3888h10.11116c.2146 0 .3888-.1742.3888-.3888zm-7.1944-6.54422c-.75133 0-1.36111.60978-1.36111 1.36111 0 .75134.60978 1.36111 1.36111 1.36111s1.36111-.60977 1.36111-1.36111c0-.75133-.60978-1.36111-1.36111-1.36111z"/></svg></i>`);e.after(this.$imgUploadInput),e.onclick=()=>{const e=this.$imgUploadInput;e.onchange=()=>{G(this,null,(function*(){if(!e.files||0===e.files.length)return;const t=e.files[0];this.uploadImg(t)}))},e.click()},this.kit.useConf().imgUpload||this.$btn.setAttribute("atk-only-admin-show","")}initDragImg(){const e=e=>{if(e)for(let t=0;t<e.length;t++){const n=e[t];this.uploadImg(n)}},t=e=>{e.stopPropagation(),e.preventDefault()},n=t=>{var n;const s=null==(n=t.dataTransfer)?void 0:n.files;s?.length&&(t.preventDefault(),e(s))},s=t=>{var n;const s=null==(n=t.clipboardData)?void 0:n.files;s?.length&&(t.preventDefault(),e(s))};this.kit.useMounted((()=>{this.kit.useUI().$textarea.addEventListener("dragover",t),this.kit.useUI().$textarea.addEventListener("drop",n),this.kit.useUI().$textarea.addEventListener("paste",s)})),this.kit.useUnmounted((()=>{this.kit.useUI().$textarea.removeEventListener("dragover",t),this.kit.useUI().$textarea.removeEventListener("drop",n),this.kit.useUI().$textarea.removeEventListener("paste",s)}))}uploadImg(e){return G(this,null,(function*(){const t=/[^.]+$/.exec(e.name);if(!t||!ni.includes(String(t[0]).toLowerCase()))return;if(!this.kit.useUser().checkHasBasicUserInfo())return void this.kit.useEditor().showNotify(w("uploadLoginMsg"),"w");let n="\n";""===this.kit.useUI().$textarea.value.trim()&&(n="");const s=`${n}![](Uploading ${e.name}...)`;let i;this.kit.useEditor().insertContent(s);try{const t=this.kit.useConf().imgUploader;i=t?{public_url:yield t(e)}:(yield this.kit.useApi().upload.upload({file:e})).data}catch(e){console.error(e),this.kit.useEditor().showNotify(`${w("uploadFail")}: ${e.message}`,"e")}if(i&&i.public_url){let e=i.public_url;ys(e)||(e=io({base:this.kit.useConf().server,path:e})),this.kit.useEditor().setContent(this.kit.useUI().$textarea.value.replace(s,`${n}![](${e})`))}else this.kit.useEditor().setContent(this.kit.useUI().$textarea.value.replace(s,""))}))}}class fo extends we{constructor(e){super(e),h(this,"isPlugPanelShow",!1),this.kit.useMounted((()=>{this.usePanel('<div class="atk-editor-plug-preview"></div>'),this.useBtn(`<i aria-label="${w("preview")}"><svg fill="currentColor" aria-hidden="true" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z"></path></svg></i>`)})),this.kit.useUnmounted((()=>{})),this.kit.useEvents().on("content-updated",(e=>{this.isPlugPanelShow&&this.updateContent()})),this.usePanelShow((()=>{this.isPlugPanelShow=!0,this.updateContent()})),this.usePanelHide((()=>{this.isPlugPanelShow=!1}))}updateContent(){this.$panel.innerHTML=this.kit.useEditor().getContentMarked()}}const Vc=[Bc,Nc,jc,Wc,qc,ks,Uc,Yt,Fc,zc,Hc,uo,po,fo];function Gc(e){const t=new Map;return t.set(po,e.imgUpload),t.set(uo,e.emoticons),t.set(fo,e.preview),t.set(Yt,e.editorTravel),Vc.filter((e=>!t.has(e)||!!t.get(e)))}class Kc{constructor(e){this.plugs=e}useEditor(){return this.plugs.editor}useGlobalCtx(){return this.plugs.editor.ctx}useConf(){return this.plugs.editor.ctx.conf}useApi(){return this.plugs.editor.ctx.getApi()}useUser(){return this.plugs.editor.ctx.get("user")}useUI(){return this.plugs.editor.getUI()}useEvents(){return this.plugs.getEvents()}useMounted(e){this.useEvents().on("mounted",e)}useUnmounted(e){this.useEvents().on("unmounted",e)}useDeps(e){return this.plugs.get(e)}}const Zc=e=>{const t=e.get("editor"),n=new Qc(t);e.inject("editorPlugs",n)};class Qc{constructor(e){h(this,"plugs",[]),h(this,"openedPlug",null),h(this,"events",new Fn),this.editor=e;let t=!1;this.editor.ctx.watchConf(["imgUpload","emoticons","preview","editorTravel","locale"],(e=>{t&&this.getEvents().trigger("unmounted"),this.clear(),Gc(e).forEach((e=>{const t=new Kc(this);this.plugs.push(new e(t))})),this.getEvents().trigger("mounted"),t=!0,this.loadPluginUI()})),this.events.on("panel-close",(()=>this.closePlugPanel()))}getPlugs(){return this.plugs}getEvents(){return this.events}clear(){this.plugs=[],this.events=new Fn,this.openedPlug&&this.closePlugPanel()}loadPluginUI(){this.editor.getUI().$plugPanelWrap.innerHTML="",this.editor.getUI().$plugPanelWrap.style.display="none",this.editor.getUI().$plugBtnWrap.innerHTML="",this.plugs.forEach((e=>this.loadPluginItem(e)))}loadPluginItem(e){const t=e.$btn;if(!t)return;this.editor.getUI().$plugBtnWrap.appendChild(t),!t.onclick&&(t.onclick=()=>{this.editor.getUI().$plugBtnWrap.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),e!==this.openedPlug?(this.openPlugPanel(e),t.classList.add("active")):this.closePlugPanel()});const n=e.$panel;n&&(n.style.display="none",this.editor.getUI().$plugPanelWrap.appendChild(n))}get(e){return this.plugs.find((t=>t instanceof e))}openPlugPanel(e){this.plugs.forEach((t=>{const n=t.$panel;n&&(t===e?(n.style.display="",this.events.trigger("panel-show",e)):(n.style.display="none",this.events.trigger("panel-hide",e)))})),this.editor.getUI().$plugPanelWrap.style.display="",this.openedPlug=e}closePlugPanel(){this.openedPlug&&(this.editor.getUI().$plugPanelWrap.style.display="none",this.events.trigger("panel-hide",this.openedPlug),this.openedPlug=null)}getTransformedContent(e){let t=e;return this.plugs.forEach((e=>{e.contentTransformer&&(t=e.contentTransformer(t))})),t}}const Yc=e=>{let t;e.on("mounted",(()=>{t=e.get("list").$el.querySelector('[data-action="admin-close-comment"]'),t.addEventListener("click",(()=>{const t=e.getData().getPage();if(!t)throw new Error("Page data not found");t.admin_only=!t.admin_only,Xc(e,t)}))})),e.on("page-loaded",(n=>{var s,i;const o=e.get("editor");!0===n?.admin_only?(null==(s=o.getPlugs())||s.getEvents().trigger("editor-close"),t&&(t.innerText=w("openComment"))):(null==(i=o.getPlugs())||i.getEvents().trigger("editor-open"),t&&(t.innerText=w("closeComment")))})),e.on("list-loaded",(t=>{e.editorResetState()}))};function Xc(e,t){e.editorShowLoading(),e.getApi().pages.updatePage(t.id,t).then((({data:t})=>{e.getData().updatePage(t)})).catch((t=>{e.editorShowNotify(`${w("editFail")}: ${t.message||String(t)}`,"e")})).finally((()=>{e.editorHideLoading()}))}const Jc=e=>{e.on("comment-rendered",(t=>{if(!0===e.conf.listUnreadHighlight){const n=e.getData().getNotifies(),s=n.find((e=>e.comment_id===t.getID()));s?(t.getRender().setUnread(!0),t.getRender().setOpenAction((()=>{window.open(s.read_link),e.getData().updateNotifies(n.filter((e=>e.comment_id!==t.getID())))}))):t.getRender().setUnread(!1)}})),e.on("list-goto",(t=>{const n=no("atk_notify_key");n&&e.getApi().notifies.markNotifyRead(t,n).then((()=>{e.getData().updateNotifies(e.getData().getNotifies().filter((e=>e.comment_id!==t)))}))}))},ed=e=>{e.on("list-loaded",(()=>{(()=>{var t,n;const s=e.get("list").$el.querySelector(".atk-comment-count .atk-text");if(!s)return;const i=gs(w("counter",{count:`${Number(null==(n=null==(t=e.getData().getListLastFetch())?void 0:t.data)?void 0:n.count)||0}`}));s.innerHTML=i.replace(/(\d+)/,'<span class="atk-comment-count-num">$1</span>')})()})),e.on("comment-inserted",(()=>{const t=e.getData().getListLastFetch();t?.data&&(t.data.count+=1)})),e.on("comment-deleted",(()=>{const t=e.getData().getListLastFetch();t?.data&&(t.data.count-=1)}))},td=e=>{let t=null;const n=()=>{if(!t)return;const n=e.get("user").getData();if(n.name&&n.email){t.classList.remove("atk-hide");const e=t.querySelector(".atk-text");e&&(e.innerText=n.is_admin?w("ctrlCenter"):w("msgCenter"))}else t.classList.add("atk-hide")};e.watchConf(["locale"],(s=>{t=e.get("list").$el.querySelector('[data-action="open-sidebar"]'),t&&(t.onclick=()=>{e.showSidebar()},n())})),e.on("user-changed",(e=>{n()}))},nd=e=>{let t=null;e.on("mounted",(()=>{t=e.get("list").$el.querySelector(".atk-unread-badge")})),e.on("notifies-updated",(e=>{(e=>{t&&(e>0?(t.innerText=`${Number(e||0)}`,t.style.display="block"):t.style.display="none")})(e.length||0)}))},sd=e=>{let t=0;const n=({locker:n})=>{const s=id();s&&(n&&t===s||(t=s,e.trigger("list-goto",s)))},s=()=>n({locker:!1}),i=()=>n({locker:!0});e.on("mounted",(()=>{window.addEventListener("hashchange",s),e.on("list-loaded",i)})),e.on("unmounted",(()=>{window.removeEventListener("hashchange",s),e.off("list-loaded",i)}))};function id(){const e=window.location.hash.match(/#atk-comment-([0-9]+)/);let t=e&&e[1]&&!Number.isNaN(parseFloat(e[1]))?parseFloat(e[1]):null;return t||(t=Number(no("atk_comment"))),t||null}const od=e=>{e.on("list-goto",(t=>G(void 0,null,(function*(){let n=e.getCommentNodes().find((e=>e.getID()===t));if(!n){const s=(yield e.getApi().comments.getComment(t)).data;e.get("list").getListLayout({forceFlatMode:!0}).insert(s.comment,s.reply_comment),n=e.getCommentNodes().find((e=>e.getID()===t))}n&&n.focus()}))))},mo="2.9.1",rd=e=>{e.on("mounted",(()=>{const t=e.get("list").$el.querySelector(".atk-copyright");t&&(t.innerHTML=`Powered By <a href="https://artalk.js.org" target="_blank" title="Artalk v${mo}">Artalk</a>`)}))},ad=e=>{e.on("list-loaded",(t=>{const n=e.get("list"),s=t.length<=0;let i=n.getCommentsWrapEl().querySelector(".atk-list-no-comment");s?i||(i=P('<div class="atk-list-no-comment"></div>'),i.innerHTML=Qi(n.ctx.conf.noComment||n.ctx.$t("noComment")),n.getCommentsWrapEl().appendChild(i)):i?.remove()}))},ld=e=>{const t=t=>{e.conf.listFetchParamsModifier=t,e.reload()};e.watchConf(["listSort","locale"],(n=>{const s=e.get("list").$el.querySelector(".atk-comment-count");s&&(n.listSort?(e=>{cd({$dropdownWrap:e,dropdownList:[[w("sortLatest"),()=>{t((e=>{e.sort_by="date_desc"}))}],[w("sortBest"),()=>{t((e=>{e.sort_by="vote"}))}],[w("sortOldest"),()=>{t((e=>{e.sort_by="date_asc"}))}],[w("sortAuthor"),()=>{t((e=>{e.view_only_admin=!0}))}]]})})(s):dd({$dropdownWrap:s}))}))};function cd(e){const{$dropdownWrap:t,dropdownList:n}=e;if(t.querySelector(".atk-dropdown"))return;t.classList.add("atk-dropdown-wrap"),t.append(P('<span class="atk-arrow-down-icon"></span>'));let s=0;const i=P('<ul class="atk-dropdown atk-fade-in"></ul>');n.forEach(((e,t)=>{const[n,o]=e,r=P('<li class="atk-dropdown-item"><span></span></li>'),a=r.querySelector("span");a.innerText=n,a.onclick=()=>{((e,t,n,o)=>{o(),s=e,i.querySelectorAll(".active").forEach((e=>{e.classList.remove("active")})),t.classList.add("active"),i.style.display="none",setTimeout((()=>{i.style.display=""}),80)})(t,r,0,o)},i.append(r),t===s&&r.classList.add("active")})),t.append(i)}function dd(e){var t,n;const{$dropdownWrap:s}=e;s.classList.remove("atk-dropdown-wrap"),null==(t=s.querySelector(".atk-arrow-down-icon"))||t.remove(),null==(n=s.querySelector(".atk-dropdown"))||n.remove()}const hd=e=>{let t=null;e.on("mounted",(()=>{t=window.setInterval((()=>{e.get("list").$el.querySelectorAll("[data-atk-comment-date]").forEach((t=>{var n,s;const i=new Date(Number(t.getAttribute("data-atk-comment-date")));t.innerText=(null==(s=(n=e.getConf()).dateFormatter)?void 0:s.call(n,i))||so(i,e.$t)}))}),3e4)})),e.on("unmounted",(()=>{t&&window.clearInterval(t)}))};function go(e){const t=P('<span><span class="error-message"></span><br/><br/></span>');if(t.querySelector(".error-message").innerText=`${w("listLoadFailMsg")}\n${e.errMsg}`,e.retryFn){const n=P(`<span style="cursor:pointer;">${w("listRetry")}</span>`);n.onclick=()=>e.retryFn&&e.retryFn(),t.appendChild(n)}if(e.onOpenSidebar){const n=P(`<span atk-only-admin-show> | <span style="cursor:pointer;">${w("openName",{name:w("ctrlCenter")})}</span></span>`);t.appendChild(n),n.onclick=()=>e.onOpenSidebar&&e.onOpenSidebar()}Qt(e.$err,t)}const ud=e=>{e.on("list-fetch",(()=>{Qt(e.get("list").$el,null)})),e.on("list-failed",(t=>{go({$err:e.get("list").$el,errMsg:t.msg,errData:t.data,retryFn:()=>e.fetch({offset:0})})}))},pd=e=>{e.on("list-fetch",(t=>{const n=e.get("list");0===t.offset&&Gs(!0,n.$el)})),e.on("list-fetched",(()=>{Gs(!1,e.get("list").$el)}))},fd=e=>{e.on("list-fetch",(t=>{if(e.getData().getLoading())return;e.getData().setLoading(!0);const n=y({offset:0,limit:e.conf.pagination.pageSize,flatMode:e.conf.flatMode,paramsModifier:e.conf.listFetchParamsModifier},t);e.getData().setListLastFetch({params:n});const s={limit:n.limit,offset:n.offset,flat_mode:n.flatMode,page_key:e.getConf().pageKey,site_name:e.getConf().site};n.paramsModifier&&n.paramsModifier(s),e.getApi().comments.getComments(y(y({},s),e.getApi().getUserFields())).then((({data:t})=>{e.getData().setListLastFetch({params:n,data:t}),e.getData().loadComments(t.comments),e.getData().updatePage(t.page),n.onSuccess&&n.onSuccess(t),e.trigger("list-fetched",{params:n,data:t})})).catch((t=>{const s={msg:t.msg||String(t),data:t.data};throw n.onError&&n.onError(s),e.trigger("list-failed",s),e.trigger("list-fetched",{params:n,error:s}),t})).finally((()=>{e.getData().setLoading(!1)}))}))},md=e=>{let t=null;const n=()=>{t?.disconnect(),t=null};e.on("list-loaded",(()=>{n();const s=e.get("list").getCommentsWrapEl().childNodes,i=s.length>2?s[s.length-2]:null;if(i){if(!("IntersectionObserver"in window))return void console.warn("IntersectionObserver api not supported");(s=>{const i=e.conf.scrollRelativeTo&&e.conf.scrollRelativeTo()||null;t=new IntersectionObserver((([t])=>{t.isIntersecting&&(n(),e.trigger("list-reach-bottom"))}),{threshold:.9,root:i}),t.observe(s)})(i)}})),e.on("unmounted",(()=>{n()}))},gd=e=>{const t=()=>{const t=e.get("list"),n=e.conf.scrollRelativeTo&&e.conf.scrollRelativeTo();(n||window).scroll({top:cl(t.$el,n).top,left:0})};e.on("mounted",(()=>{e.on("list-goto-first",t)})),e.on("unmounted",(()=>{e.off("list-goto-first",t)}))},yd=[fd,pd,Jc,Yc,ed,td,nd,ld,sd,od,ad,rd,hd,ud,md,gd],vd=e=>{e.on("list-fetch",(t=>{if(0!==t.offset)return;const n=e.getApi().getUserFields();n&&e.getApi().notifies.getNotifies(n).then((t=>{e.getData().updateNotifies(t.data.notifies)}))}))};let yo=!1;const kd=e=>{e.watchConf(["apiVersion","versionCheck"],(t=>{const n=e.get("list");t.apiVersion&&t.versionCheck&&!yo&&wd(n,mo,t.apiVersion)}))};function wd(e,t,n){const s=ul(t,n);if(0===s)return;const i=P(`<div class="atk-version-check-notice">${w("updateMsg",{name:w(s<0?"frontend":"backend")})} <span class="atk-info">${w("currentVersion")}: ${w("frontend")} ${t} / ${w("backend")} ${n}</span></div>`),o=P(`<span class="atk-ignore-btn">${w("ignore")}</span>`);o.onclick=()=>{i.remove(),yo=!0},i.append(o),e.$el.parentElement.prepend(i)}const bd=e=>{const t=()=>{xd(e.get("user").getData().is_admin,$d({$root:e.$root}))};e.on("list-loaded",(()=>{t()})),e.on("user-changed",(e=>{t()}))};function $d(e){const t=[];e.$root.querySelectorAll("[atk-only-admin-show]").forEach((e=>t.push(e)));const n=document.querySelector(".atk-sidebar");return n&&n.querySelectorAll("[atk-only-admin-show]").forEach((e=>t.push(e))),t}function xd(e,t){t.forEach((t=>{e?t.classList.remove("atk-hide"):t.classList.add("atk-hide")}))}let Ze;function En(e,t){const n="atk-dark-mode";e.forEach((e=>{t?e.classList.add(n):e.classList.remove(n)}))}const Cd=e=>{let t;const n=n=>{const s=[e.$root,e.get("layerManager").getEl()];Ze||(Ze=window.matchMedia("(prefers-color-scheme: dark)")),"auto"===n?(t||(t=e=>En(s,e.matches),Ze.addEventListener("change",t)),En(s,Ze.matches)):(t&&(Ze.removeEventListener("change",t),t=void 0),En(s,n))};e.watchConf(["darkMode"],(e=>n(e.darkMode))),e.on("created",(()=>n(e.conf.darkMode))),e.on("unmounted",(()=>{t&&Ze?.removeEventListener("change",t),t=void 0}))},Sd=[Dc,Zc,bd,...yd,vd,Ac,kd,Cd],vo=new Set([...Sd]),ko=new WeakMap;function wo(e){return G(this,null,(function*(){var t;const n=new Set,s=t=>{t.forEach((t=>{"function"==typeof t&&!n.has(t)&&(t(e,ko.get(t)),n.add(t))}))};s(vo);const{data:i}=yield e.getApi().conf.conf().catch((t=>{throw Td(e,t),t}));let o={apiVersion:null==(t=i.version)?void 0:t.version};if(e.conf.useBackendConf){if(!i.frontend_conf)throw new Error("The remote backend does not respond to the frontend conf, but `useBackendConf` conf is enabled");o=y(y({},o),yl(i.frontend_conf))}e.conf.remoteConfModifier&&e.conf.remoteConfModifier(o),o.pluginURLs&&(yield Ed(o.pluginURLs,e.conf.server).then((e=>{s(e)})).catch((e=>{console.error("Failed to load plugin",e)}))),e.trigger("created"),e.updateConf(o),e.trigger("mounted"),e.conf.remoteConfModifier||e.fetch({offset:0})}))}function Ed(e,t){return G(this,null,(function*(){const n=new Set;if(!e||!Array.isArray(e))return n;const s=[];return e.forEach((e=>{/^(http|https):\/\//.test(e)||(e=`${t.replace(/\/$/,"")}/${e.replace(/^\//,"")}`),s.push(new Promise((t=>{if(document.querySelector(`script[src="${e}"]`))return void t();const n=document.createElement("script");n.src=e,document.head.appendChild(n),n.onload=()=>t(),n.onerror=e=>{console.error("[artalk] Failed to load plugin",e),t()}})))})),yield Promise.all(s),Object.values(window.ArtalkPlugins||{}).forEach((e=>{"function"==typeof e&&n.add(e)})),n}))}function Td(e,t){var n;let s="";if(null!=(n=t.data)&&n.err_no_site){const t={create_name:e.conf.site,create_urls:`${window.location.protocol}//${window.location.host}`};s=`sites|${JSON.stringify(t)}`}go({$err:e.get("list").$el,errMsg:t.msg||String(t),errData:t.data,retryFn:()=>wo(e),onOpenSidebar:e.get("user").getData().is_admin?()=>e.showSidebar({view:s}):void 0})}class ws{constructor(e){h(this,"ctx");const t=zn(e,!0);this.ctx=new wl(t),Object.entries(Lc).forEach((([e,t])=>{const n=t(this.ctx);n&&this.ctx.inject(e,n)})),wo(this.ctx)}getConf(){return this.ctx.getConf()}getEl(){return this.ctx.$root}update(e){return this.ctx.updateConf(e),this}reload(){this.ctx.reload()}destroy(){for(this.ctx.trigger("unmounted");this.ctx.$root.firstChild;)this.ctx.$root.removeChild(this.ctx.$root.firstChild)}on(e,t){this.ctx.on(e,t)}off(e,t){this.ctx.off(e,t)}trigger(e,t){this.ctx.trigger(e,t)}setDarkMode(e){this.ctx.setDarkMode(e)}static init(e){return new ws(e)}static use(e,t){vo.add(e),ko.set(e,t)}static loadCountWidget(e){const t=zn(e,!0);lo({getApi:()=>new Pi(ro(t)),siteName:t.site,countEl:t.countEl,pvEl:t.pvEl,pageKeyAttr:t.statPageKeyAttr,pvAdd:!1})}get $root(){return this.ctx.$root}get conf(){return this.ctx.getConf()}}const Ld=()=>{new ws({el:"#Comments",site:"ittst",server:"https://artalk.loliko.cn"}),document.getElementById("Comments").classList.add("loaded")};function vt(e,t,n){const s=document.createElement(t);return e&&(s.className=e),n&&n.appendChild(s),s}function Ad(e,t,n){let s=`translate3d(${e}px,0px,0)`;return void 0!==n&&(s+=` scale3d(${n},${n},1)`),s}function Wn(e,t,n){e.style.width="number"==typeof t?`${t}px`:t,e.style.height="number"==typeof n?`${n}px`:n}window.addEventListener("load",Ld);const Te={IDLE:"idle",LOADING:"loading",LOADED:"loaded",ERROR:"error"};function _d(e){return"button"in e&&1===e.button||e.ctrlKey||e.metaKey||e.altKey||e.shiftKey}function kt(e,t,n=document){let s=[];if(e instanceof Element)s=[e];else if(e instanceof NodeList||Array.isArray(e))s=Array.from(e);else{const i="string"==typeof e?e:t;i&&(s=Array.from(n.querySelectorAll(i)))}return s}function Pd(e){return"function"==typeof e&&e.prototype&&e.prototype.goTo}function si(){return!(!navigator.vendor||!navigator.vendor.match(/apple/i))}class Id{constructor(e,t){this.type=e,this.defaultPrevented=!1,t&&Object.assign(this,t)}preventDefault(){this.defaultPrevented=!0}}class Md{constructor(){this._listeners={},this._filters={},this.pswp=void 0,this.options=void 0}addFilter(e,t,n=100){var s,i,o;this._filters[e]||(this._filters[e]=[]),null===(s=this._filters[e])||void 0===s||s.push({fn:t,priority:n}),null===(i=this._filters[e])||void 0===i||i.sort(((e,t)=>e.priority-t.priority)),null===(o=this.pswp)||void 0===o||o.addFilter(e,t,n)}removeFilter(e,t){this._filters[e]&&(this._filters[e]=this._filters[e].filter((e=>e.fn!==t))),this.pswp&&this.pswp.removeFilter(e,t)}applyFilters(e,...t){var n;return null===(n=this._filters[e])||void 0===n||n.forEach((e=>{t[0]=e.fn.apply(this,t)})),t[0]}on(e,t){var n,s;this._listeners[e]||(this._listeners[e]=[]),null===(n=this._listeners[e])||void 0===n||n.push(t),null===(s=this.pswp)||void 0===s||s.on(e,t)}off(e,t){var n;this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter((e=>t!==e))),null===(n=this.pswp)||void 0===n||n.off(e,t)}dispatch(e,t){var n;if(this.pswp)return this.pswp.dispatch(e,t);const s=new Id(e,t);return null===(n=this._listeners[e])||void 0===n||n.forEach((e=>{e.call(this,s)})),s}}class Od{constructor(e,t){if(this.element=vt("pswp__img pswp__img--placeholder",e?"img":"div",t),e){const t=this.element;t.decoding="async",t.alt="",t.src=e,t.setAttribute("role","presentation")}this.element.setAttribute("aria-hidden","true")}setDisplayedSize(e,t){this.element&&("IMG"===this.element.tagName?(Wn(this.element,250,"auto"),this.element.style.transformOrigin="0 0",this.element.style.transform=Ad(0,0,e/250)):Wn(this.element,e,t))}destroy(){var e;null!==(e=this.element)&&void 0!==e&&e.parentNode&&this.element.remove(),this.element=null}}class Rd{constructor(e,t,n){this.instance=t,this.data=e,this.index=n,this.element=void 0,this.placeholder=void 0,this.slide=void 0,this.displayedImageWidth=0,this.displayedImageHeight=0,this.width=Number(this.data.w)||Number(this.data.width)||0,this.height=Number(this.data.h)||Number(this.data.height)||0,this.isAttached=!1,this.hasSlide=!1,this.isDecoding=!1,this.state=Te.IDLE,this.data.type?this.type=this.data.type:this.data.src?this.type="image":this.type="html",this.instance.dispatch("contentInit",{content:this})}removePlaceholder(){this.placeholder&&!this.keepPlaceholder()&&setTimeout((()=>{this.placeholder&&(this.placeholder.destroy(),this.placeholder=void 0)}),1e3)}load(e,t){if(this.slide&&this.usePlaceholder())if(this.placeholder){const e=this.placeholder.element;e&&!e.parentElement&&this.slide.container.prepend(e)}else{const e=this.instance.applyFilters("placeholderSrc",!(!this.data.msrc||!this.slide.isFirstSlide)&&this.data.msrc,this);this.placeholder=new Od(e,this.slide.container)}this.element&&!t||this.instance.dispatch("contentLoad",{content:this,isLazy:e}).defaultPrevented||(this.isImageContent()?(this.element=vt("pswp__img","img"),this.displayedImageWidth&&this.loadImage(e)):(this.element=vt("pswp__content","div"),this.element.innerHTML=this.data.html||""),t&&this.slide&&this.slide.updateContentSize(!0))}loadImage(e){var t,n;if(!this.isImageContent()||!this.element||this.instance.dispatch("contentLoadImage",{content:this,isLazy:e}).defaultPrevented)return;const s=this.element;this.updateSrcsetSizes(),this.data.srcset&&(s.srcset=this.data.srcset),s.src=null!==(t=this.data.src)&&void 0!==t?t:"",s.alt=null!==(n=this.data.alt)&&void 0!==n?n:"",this.state=Te.LOADING,s.complete?this.onLoaded():(s.onload=()=>{this.onLoaded()},s.onerror=()=>{this.onError()})}setSlide(e){this.slide=e,this.hasSlide=!0,this.instance=e.pswp}onLoaded(){this.state=Te.LOADED,this.slide&&this.element&&(this.instance.dispatch("loadComplete",{slide:this.slide,content:this}),this.slide.isActive&&this.slide.heavyAppended&&!this.element.parentNode&&(this.append(),this.slide.updateContentSize(!0)),(this.state===Te.LOADED||this.state===Te.ERROR)&&this.removePlaceholder())}onError(){this.state=Te.ERROR,this.slide&&(this.displayError(),this.instance.dispatch("loadComplete",{slide:this.slide,isError:!0,content:this}),this.instance.dispatch("loadError",{slide:this.slide,content:this}))}isLoading(){return this.instance.applyFilters("isContentLoading",this.state===Te.LOADING,this)}isError(){return this.state===Te.ERROR}isImageContent(){return"image"===this.type}setDisplayedSize(e,t){if(this.element&&(this.placeholder&&this.placeholder.setDisplayedSize(e,t),!this.instance.dispatch("contentResize",{content:this,width:e,height:t}).defaultPrevented&&(Wn(this.element,e,t),this.isImageContent()&&!this.isError()))){const n=!this.displayedImageWidth&&e;this.displayedImageWidth=e,this.displayedImageHeight=t,n?this.loadImage(!1):this.updateSrcsetSizes(),this.slide&&this.instance.dispatch("imageSizeChange",{slide:this.slide,width:e,height:t,content:this})}}isZoomable(){return this.instance.applyFilters("isContentZoomable",this.isImageContent()&&this.state!==Te.ERROR,this)}updateSrcsetSizes(){if(!this.isImageContent()||!this.element||!this.data.srcset)return;const e=this.element,t=this.instance.applyFilters("srcsetSizesWidth",this.displayedImageWidth,this);(!e.dataset.largestUsedSize||t>parseInt(e.dataset.largestUsedSize,10))&&(e.sizes=t+"px",e.dataset.largestUsedSize=String(t))}usePlaceholder(){return this.instance.applyFilters("useContentPlaceholder",this.isImageContent(),this)}lazyLoad(){this.instance.dispatch("contentLazyLoad",{content:this}).defaultPrevented||this.load(!0)}keepPlaceholder(){return this.instance.applyFilters("isKeepingPlaceholder",this.isLoading(),this)}destroy(){this.hasSlide=!1,this.slide=void 0,!this.instance.dispatch("contentDestroy",{content:this}).defaultPrevented&&(this.remove(),this.placeholder&&(this.placeholder.destroy(),this.placeholder=void 0),this.isImageContent()&&this.element&&(this.element.onload=null,this.element.onerror=null,this.element=void 0))}displayError(){if(this.slide){var e,t;let n=vt("pswp__error-msg","div");n.innerText=null!==(e=null===(t=this.instance.options)||void 0===t?void 0:t.errorMsg)&&void 0!==e?e:"",n=this.instance.applyFilters("contentErrorElement",n,this),this.element=vt("pswp__content pswp__error-msg-container","div"),this.element.appendChild(n),this.slide.container.innerText="",this.slide.container.appendChild(this.element),this.slide.updateContentSize(!0),this.removePlaceholder()}}append(){if(this.isAttached||!this.element)return;if(this.isAttached=!0,this.state===Te.ERROR)return void this.displayError();if(this.instance.dispatch("contentAppend",{content:this}).defaultPrevented)return;const e="decode"in this.element;this.isImageContent()?e&&this.slide&&(!this.slide.isActive||si())?(this.isDecoding=!0,this.element.decode().catch((()=>{})).finally((()=>{this.isDecoding=!1,this.appendImage()}))):this.appendImage():this.slide&&!this.element.parentNode&&this.slide.container.appendChild(this.element)}activate(){this.instance.dispatch("contentActivate",{content:this}).defaultPrevented||!this.slide||(this.isImageContent()&&this.isDecoding&&!si()?this.appendImage():this.isError()&&this.load(!1,!0),this.slide.holderElement&&this.slide.holderElement.setAttribute("aria-hidden","false"))}deactivate(){this.instance.dispatch("contentDeactivate",{content:this}),this.slide&&this.slide.holderElement&&this.slide.holderElement.setAttribute("aria-hidden","true")}remove(){this.isAttached=!1,!this.instance.dispatch("contentRemove",{content:this}).defaultPrevented&&(this.element&&this.element.parentNode&&this.element.remove(),this.placeholder&&this.placeholder.element&&this.placeholder.element.remove())}appendImage(){this.isAttached&&(this.instance.dispatch("contentAppendImage",{content:this}).defaultPrevented||(this.slide&&this.element&&!this.element.parentNode&&this.slide.container.appendChild(this.element),(this.state===Te.LOADED||this.state===Te.ERROR)&&this.removePlaceholder()))}}function Dd(e,t){if(e.getViewportSizeFn){const n=e.getViewportSizeFn(e,t);if(n)return n}return{x:document.documentElement.clientWidth,y:window.innerHeight}}function Ut(e,t,n,s,i){let o=0;if(t.paddingFn)o=t.paddingFn(n,s,i)[e];else if(t.padding)o=t.padding[e];else{const n="padding"+e[0].toUpperCase()+e.slice(1);t[n]&&(o=t[n])}return Number(o)||0}function Bd(e,t,n,s){return{x:t.x-Ut("left",e,t,n,s)-Ut("right",e,t,n,s),y:t.y-Ut("top",e,t,n,s)-Ut("bottom",e,t,n,s)}}const ii=4e3;class qd{constructor(e,t,n,s){this.pswp=s,this.options=e,this.itemData=t,this.index=n,this.panAreaSize=null,this.elementSize=null,this.fit=1,this.fill=1,this.vFill=1,this.initial=1,this.secondary=1,this.max=1,this.min=1}update(e,t,n){const s={x:e,y:t};this.elementSize=s,this.panAreaSize=n;const i=n.x/s.x,o=n.y/s.y;this.fit=Math.min(1,i<o?i:o),this.fill=Math.min(1,i>o?i:o),this.vFill=Math.min(1,o),this.initial=this._getInitial(),this.secondary=this._getSecondary(),this.max=Math.max(this.initial,this.secondary,this._getMax()),this.min=Math.min(this.fit,this.initial,this.secondary),this.pswp&&this.pswp.dispatch("zoomLevelsUpdate",{zoomLevels:this,slideData:this.itemData})}_parseZoomLevelOption(e){const t=e+"ZoomLevel",n=this.options[t];if(n)return"function"==typeof n?n(this):"fill"===n?this.fill:"fit"===n?this.fit:Number(n)}_getSecondary(){let e=this._parseZoomLevelOption("secondary");return e||(e=Math.min(1,3*this.fit),this.elementSize&&e*this.elementSize.x>ii&&(e=ii/this.elementSize.x),e)}_getInitial(){return this._parseZoomLevelOption("initial")||this.fit}_getMax(){return this._parseZoomLevelOption("max")||Math.max(1,4*this.fit)}}function bo(e,t,n){const s=t.createContentFromData(e,n);let i;const{options:o}=t;if(o){let r;i=new qd(o,e,-1),r=t.pswp?t.pswp.viewportSize:Dd(o,t);const a=Bd(o,r,e,n);i.update(s.width,s.height,a)}return s.lazyLoad(),i&&s.setDisplayedSize(Math.ceil(s.width*i.initial),Math.ceil(s.height*i.initial)),s}function Ud(e,t){const n=t.getItemData(e);if(!t.dispatch("lazyLoadSlide",{index:e,itemData:n}).defaultPrevented)return bo(n,t,e)}class Fd extends Md{getNumItems(){var e;let t=0;const n=null===(e=this.options)||void 0===e?void 0:e.dataSource;n&&"length"in n?t=n.length:n&&"gallery"in n&&(n.items||(n.items=this._getGalleryDOMElements(n.gallery)),n.items&&(t=n.items.length));const s=this.dispatch("numItems",{dataSource:n,numItems:t});return this.applyFilters("numItems",s.numItems,n)}createContentFromData(e,t){return new Rd(e,this,t)}getItemData(e){var t;const n=null===(t=this.options)||void 0===t?void 0:t.dataSource;let s={};Array.isArray(n)?s=n[e]:n&&"gallery"in n&&(n.items||(n.items=this._getGalleryDOMElements(n.gallery)),s=n.items[e]);let i=s;i instanceof Element&&(i=this._domElementToItemData(i));const o=this.dispatch("itemData",{itemData:i||{},index:e});return this.applyFilters("itemData",o.itemData,e)}_getGalleryDOMElements(e){var t,n;return null!==(t=this.options)&&void 0!==t&&t.children||null!==(n=this.options)&&void 0!==n&&n.childSelector?kt(this.options.children,this.options.childSelector,e)||[]:[e]}_domElementToItemData(e){const t={element:e},n="A"===e.tagName?e:e.querySelector("a");if(n){t.src=n.dataset.pswpSrc||n.href,n.dataset.pswpSrcset&&(t.srcset=n.dataset.pswpSrcset),t.width=n.dataset.pswpWidth?parseInt(n.dataset.pswpWidth,10):0,t.height=n.dataset.pswpHeight?parseInt(n.dataset.pswpHeight,10):0,t.w=t.width,t.h=t.height,n.dataset.pswpType&&(t.type=n.dataset.pswpType);const i=e.querySelector("img");var s;if(i)t.msrc=i.currentSrc||i.src,t.alt=null!==(s=i.getAttribute("alt"))&&void 0!==s?s:"";(n.dataset.pswpCropped||n.dataset.cropped)&&(t.thumbCropped=!0)}return this.applyFilters("domItemData",t,e,n)}lazyLoadData(e,t){return bo(e,this,t)}}class zd extends Fd{constructor(e){super(),this.options=e||{},this._uid=0,this.shouldOpen=!1,this._preloadedContent=void 0,this.onThumbnailsClick=this.onThumbnailsClick.bind(this)}init(){kt(this.options.gallery,this.options.gallerySelector).forEach((e=>{e.addEventListener("click",this.onThumbnailsClick,!1)}))}onThumbnailsClick(e){if(_d(e)||window.pswp)return;let t={x:e.clientX,y:e.clientY};!t.x&&!t.y&&(t=null);let n=this.getClickedIndex(e);n=this.applyFilters("clickedIndex",n,e,this);const s={gallery:e.currentTarget};n>=0&&(e.preventDefault(),this.loadAndOpen(n,s,t))}getClickedIndex(e){if(this.options.getClickedIndexFn)return this.options.getClickedIndexFn.call(this,e);const t=e.target,n=kt(this.options.children,this.options.childSelector,e.currentTarget).findIndex((e=>e===t||e.contains(t)));return-1!==n?n:this.options.children||this.options.childSelector?-1:0}loadAndOpen(e,t,n){if(window.pswp||!this.options)return!1;if(!t&&this.options.gallery&&this.options.children){const e=kt(this.options.gallery);e[0]&&(t={gallery:e[0]})}return this.options.index=e,this.options.initialPointerPos=n,this.shouldOpen=!0,this.preload(e,t),!0}preload(e,t){const{options:n}=this;t&&(n.dataSource=t);const s=[],i=typeof n.pswpModule;if(Pd(n.pswpModule))s.push(Promise.resolve(n.pswpModule));else{if("string"===i)throw new Error("pswpModule as string is no longer supported");if("function"!==i)throw new Error("pswpModule is not valid");s.push(n.pswpModule())}"function"==typeof n.openPromise&&s.push(n.openPromise()),!1!==n.preloadFirstSlide&&e>=0&&(this._preloadedContent=Ud(e,this));const o=++this._uid;Promise.all(s).then((e=>{if(this.shouldOpen){const t=e[0];this._openPhotoswipe(t,o)}}))}_openPhotoswipe(e,t){if(t!==this._uid&&this.shouldOpen||(this.shouldOpen=!1,window.pswp))return;const n="object"==typeof e?new e.default(this.options):new e(this.options);this.pswp=n,window.pswp=n,Object.keys(this._listeners).forEach((e=>{var t;null===(t=this._listeners[e])||void 0===t||t.forEach((t=>{n.on(e,t)}))})),Object.keys(this._filters).forEach((e=>{var t;null===(t=this._filters[e])||void 0===t||t.forEach((t=>{n.addFilter(e,t.fn,t.priority)}))})),this._preloadedContent&&(n.contentLoader.addToCache(this._preloadedContent),this._preloadedContent=void 0),n.on("destroy",(()=>{this.pswp=void 0,delete window.pswp})),n.init()}destroy(){var e;null===(e=this.pswp)||void 0===e||e.destroy(),this.shouldOpen=!1,this._listeners={},kt(this.options.gallery,this.options.gallerySelector).forEach((e=>{e.removeEventListener("click",this.onThumbnailsClick,!1)}))}}let $t,Hd=kr((()=>import("./photoswipe.esm.CKijkUPa.js")),[]);function oi(){$t=new zd({gallery:".custom-md img, #post-cover img",pswpModule:()=>Hd,closeSVG:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ffffff"><path d="M480-424 284-228q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536-480l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480-424Z"/></svg>',zoomSVG:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ffffff"><path d="M340-540h-40q-17 0-28.5-11.5T260-580q0-17 11.5-28.5T300-620h40v-40q0-17 11.5-28.5T380-700q17 0 28.5 11.5T420-660v40h40q17 0 28.5 11.5T500-580q0 17-11.5 28.5T460-540h-40v40q0 17-11.5 28.5T380-460q-17 0-28.5-11.5T340-500v-40Zm40 220q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l224 224q11 11 11 28t-11 28q-11 11-28 11t-28-11L532-372q-30 24-69 38t-83 14Zm0-80q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>',padding:{top:20,bottom:20,left:20,right:20},wheelToZoom:!0,arrowPrev:!1,arrowNext:!1,imageClickAction:"close",tapAction:"close",doubleTapAction:"zoom"}),$t.addFilter("domItemData",((e,t)=>(t instanceof HTMLImageElement&&(e.src=t.src,e.w=Number(t.naturalWidth||window.innerWidth),e.h=Number(t.naturalHeight||window.innerHeight),e.msrc=t.src),e))),$t.init()}const ri=()=>{$t||oi(),window.swup.hooks.on("page:view",(()=>{oi()})),window.swup.hooks.on("content:replace",(()=>{$t?.destroy?.()}),{before:!0})};window.swup?ri():document.addEventListener("swup:enable",ri);const be=(e,t)=>{const{o:n,i:s,u:i}=e;let o,r=n;const a=(e,t)=>{const n=r,a=e,l=t||(s?!s(n,a):n!==a);return(l||i)&&(r=a,o=n),[r,l,o]};return[t?e=>a(t(r,o),e):a,e=>[r,!!e,o]]},Nd=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,ke=Nd?window:{},$o=Math.max,jd=Math.min,Vn=Math.round,Jt=Math.abs,ai=Math.sign,xo=ke.cancelAnimationFrame,bs=ke.requestAnimationFrame,en=ke.setTimeout,Gn=ke.clearTimeout,cn=e=>typeof ke[e]<"u"?ke[e]:void 0,Wd=cn("MutationObserver"),li=cn("IntersectionObserver"),tn=cn("ResizeObserver"),Ht=cn("ScrollTimeline"),$s=e=>void 0===e,dn=e=>null===e,Re=e=>"number"==typeof e,Lt=e=>"string"==typeof e,xs=e=>"boolean"==typeof e,_e=e=>"function"==typeof e,De=e=>Array.isArray(e),nn=e=>"object"==typeof e&&!De(e)&&!dn(e),Cs=e=>{const t=!!e&&e.length,n=Re(t)&&t>-1&&t%1==0;return!!(De(e)||!_e(e)&&n)&&(!(t>0&&nn(e))||t-1 in e)},sn=e=>!!e&&e.constructor===Object,on=e=>e instanceof HTMLElement,hn=e=>e instanceof Element;function ee(e,t){if(Cs(e))for(let n=0;n<e.length&&!1!==t(e[n],n,e);n++);else e&&ee(Object.keys(e),(n=>t(e[n],n,e)));return e}const Co=(e,t)=>e.indexOf(t)>=0,xt=(e,t)=>e.concat(t),ae=(e,t,n)=>(!Lt(t)&&Cs(t)?Array.prototype.push.apply(e,t):e.push(t),e),Ge=e=>Array.from(e||[]),Ss=e=>De(e)?e:!Lt(e)&&Cs(e)?Ge(e):[e],Kn=e=>!!e&&!e.length,Zn=e=>Ge(new Set(e)),Se=(e,t,n)=>{ee(e,(e=>!e||e.apply(void 0,t||[]))),!n&&(e.length=0)},So="paddingTop",Eo="paddingRight",To="paddingLeft",Lo="paddingBottom",Ao="marginLeft",_o="marginRight",Po="marginBottom",Io="overflowX",Mo="overflowY",un="width",pn="height",Ne="visible",Qe="hidden",at="scroll",Vd=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},fn=(e,t,n,s)=>{if(e&&t){let s=!0;return ee(n,(n=>{e[n]!==t[n]&&(s=!1)})),s}return!1},Oo=(e,t)=>fn(e,t,["w","h"]),Nt=(e,t)=>fn(e,t,["x","y"]),Gd=(e,t)=>fn(e,t,["t","r","b","l"]),Ye=()=>{},q=(e,...t)=>e.bind(0,...t),st=e=>{let t;const n=e?en:bs,s=e?Gn:xo;return[i=>{s(t),t=n((()=>i()),_e(e)?e():e)},()=>s(t)]},Qn=(e,t)=>{const{_:n,v:s,p:i,S:o}=t||{};let r,a,l,c,h=Ye;const d=function(t){h(),Gn(r),c=r=a=void 0,h=Ye,e.apply(this,t)},u=e=>o&&a?o(a,e):e,p=()=>{h!==Ye&&d(u(l)||l)},m=function(){const e=Ge(arguments),t=_e(n)?n():n;if(Re(t)&&t>=0){const n=_e(s)?s():s,o=Re(n)&&n>=0,m=t>0?en:bs,g=t>0?Gn:xo,f=u(e)||e,y=d.bind(0,f);let k;h(),i&&!c?(y(),c=!0,k=m((()=>c=void 0),t)):(k=m(y,t),o&&!r&&(r=en(p,n))),h=()=>g(k),a=l=f}else d(e)};return m.m=p,m},Ro=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Pe=e=>e?Object.keys(e):[],Q=(e,t,n,s,i,o,r)=>{const a=[t,n,s,i,o,r];return("object"!=typeof e||dn(e))&&!_e(e)&&(e={}),ee(a,(t=>{ee(t,((n,s)=>{const i=t[s];if(e===i)return!0;const o=De(i);if(i&&sn(i)){const t=e[s];let n=t;o&&!De(t)?n=[]:!o&&!sn(t)&&(n={}),e[s]=Q(n,i)}else e[s]=o?i.slice():i}))})),e},Do=(e,t)=>ee(Q({},e),((e,t,n)=>{void 0===e?delete n[t]:e&&sn(e)&&(n[t]=Do(e))})),Es=e=>!Pe(e).length,Bo=(e,t,n)=>$o(e,jd(t,n)),Xe=e=>Zn((De(e)?e:(e||"").split(" ")).filter((e=>e))),Ts=(e,t)=>e&&e.getAttribute(t),ci=(e,t)=>e&&e.hasAttribute(t),qe=(e,t,n)=>{ee(Xe(t),(t=>{e&&e.setAttribute(t,String(n||""))}))},Me=(e,t)=>{ee(Xe(t),(t=>e&&e.removeAttribute(t)))},mn=(e,t)=>{const n=Xe(Ts(e,t)),s=q(qe,e,t),i=(e,t)=>{const s=new Set(n);return ee(Xe(e),(e=>{s[t](e)})),Ge(s).join(" ")};return{O:e=>s(i(e,"delete")),$:e=>s(i(e,"add")),C:e=>{const t=Xe(e);return t.reduce(((e,t)=>e&&n.includes(t)),t.length>0)}}},qo=(e,t,n)=>(mn(e,t).O(n),q(Ls,e,t,n)),Ls=(e,t,n)=>(mn(e,t).$(n),q(qo,e,t,n)),rn=(e,t,n,s)=>(s?Ls:qo)(e,t,n),As=(e,t,n)=>mn(e,t).C(n),Uo=e=>mn(e,"class"),Fo=(e,t)=>{Uo(e).O(t)},_s=(e,t)=>(Uo(e).$(t),q(Fo,e,t)),zo=(e,t)=>{const n=t?hn(t)&&t:document;return n?Ge(n.querySelectorAll(e)):[]},Kd=(e,t)=>{const n=t?hn(t)&&t:document;return n&&n.querySelector(e)},Yn=(e,t)=>hn(e)&&e.matches(t),Ho=e=>Yn(e,"body"),Xn=e=>e?Ge(e.childNodes):[],Ct=e=>e&&e.parentElement,it=(e,t)=>hn(e)&&e.closest(t),Jn=e=>document.activeElement,Zd=(e,t,n)=>{const s=it(e,t),i=e&&Kd(n,s),o=it(i,t)===s;return!(!s||!i)&&(s===e||i===e||o&&it(it(e,n),t)!==s)},lt=e=>{ee(Ss(e),(e=>{const t=Ct(e);e&&t&&t.removeChild(e)}))},xe=(e,t)=>q(lt,e&&t&&ee(Ss(t),(t=>{t&&e.appendChild(t)}))),ot=e=>{const t=document.createElement("div");return qe(t,"class",e),t},No=e=>{const t=ot();return t.innerHTML=e.trim(),ee(Xn(t),(e=>lt(e)))},di=(e,t)=>e.getPropertyValue(t)||e[t]||"",jo=e=>{const t=e||0;return isFinite(t)?t:0},Ft=e=>jo(parseFloat(e||"")),es=e=>Math.round(1e4*e)/1e4,Wo=e=>`${es(jo(e))}px`;function St(e,t){e&&t&&ee(t,((t,n)=>{try{const s=e.style,i=dn(t)||xs(t)?"":Re(t)?Wo(t):t;0===n.indexOf("--")?s.setProperty(n,i):s[n]=i}catch{}}))}function ze(e,t,n){const s=Lt(t);let i=s?"":{};if(e){const o=ke.getComputedStyle(e,n)||e.style;i=s?di(o,t):Ge(t).reduce(((e,t)=>(e[t]=di(o,t),e)),i)}return i}const hi=(e,t,n)=>{const s=t?`${t}-`:"",i=n?`-${n}`:"",o=`${s}top${i}`,r=`${s}right${i}`,a=`${s}bottom${i}`,l=`${s}left${i}`,c=ze(e,[o,r,a,l]);return{t:Ft(c[o]),r:Ft(c[r]),b:Ft(c[a]),l:Ft(c[l])}},Qd=(e,t)=>"translate"+(nn(e)?`(${e.x},${e.y})`:`Y(${e})`),Yd=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),Xd={w:0,h:0},gn=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:Xd,Jd=e=>gn("inner",e||ke),rt=q(gn,"offset"),Vo=q(gn,"client"),an=q(gn,"scroll"),Ps=e=>{const t=parseFloat(ze(e,un))||0,n=parseFloat(ze(e,pn))||0;return{w:t-Vn(t),h:n-Vn(n)}},Tn=e=>e.getBoundingClientRect(),eh=e=>!!e&&Yd(e),ts=e=>!(!e||!e[pn]&&!e[un]),Go=(e,t)=>{const n=ts(e);return!ts(t)&&n},ui=(e,t,n,s)=>{ee(Xe(t),(t=>{e&&e.removeEventListener(t,n,s)}))},ie=(e,t,n,s)=>{var i;const o=null==(i=s&&s.H)||i,r=s&&s.I||!1,a=s&&s.A||!1,l={passive:o,capture:r};return q(Se,Xe(t).map((t=>{const s=a?i=>{ui(e,t,s,r),n&&n(i)}:n;return e&&e.addEventListener(t,s,l),q(ui,e,t,s,r)})))},Ko=e=>e.stopPropagation(),ns=e=>e.preventDefault(),Zo=e=>Ko(e)||ns(e),Oe=(e,t)=>{const{x:n,y:s}=Re(t)?{x:t,y:t}:t||{};Re(n)&&(e.scrollLeft=n),Re(s)&&(e.scrollTop=s)},Ce=e=>({x:e.scrollLeft,y:e.scrollTop}),Qo=()=>({D:{x:0,y:0},M:{x:0,y:0}}),th=(e,t)=>{const{D:n,M:s}=e,{w:i,h:o}=t,r=(e,t,n)=>{let s=ai(e)*n,i=ai(t)*n;if(s===i){const n=Jt(e),o=Jt(t);i=n>o?0:i,s=n<o?0:s}return s=s===i?0:s,[s+0,i+0]},[a,l]=r(n.x,s.x,i),[c,h]=r(n.y,s.y,o);return{D:{x:a,y:c},M:{x:l,y:h}}},pi=({D:e,M:t})=>{const n=(e,t)=>0===e&&e<=t;return{x:n(e.x,t.x),y:n(e.y,t.y)}},fi=({D:e,M:t},n)=>{const s=(e,t,n)=>Bo(0,1,(e-n)/(e-t)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},ss=e=>{e&&e.focus&&e.focus({preventScroll:!0})},mi=(e,t)=>{ee(Ss(t),e)},is=e=>{const t=new Map,n=(e,n)=>{if(e){const s=t.get(e);mi((e=>{s&&s[e?"delete":"clear"](e)}),n)}else t.forEach((e=>{e.clear()})),t.clear()},s=(e,i)=>{if(Lt(e)){const s=t.get(e)||new Set;return t.set(e,s),mi((e=>{_e(e)&&s.add(e)}),i),q(n,e,i)}xs(i)&&i&&n();const o=Pe(e),r=[];return ee(o,(t=>{const n=e[t];n&&ae(r,s(t,n))})),q(Se,r)};return s(e||{}),[s,n,(e,n)=>{ee(Ge(t.get(e)),(e=>{n&&!Kn(n)?e.apply(0,n):e()}))}]},gi=e=>JSON.stringify(e,((e,t)=>{if(_e(t))throw 0;return t})),yi=(e,t)=>e?`${t}`.split(".").reduce(((e,t)=>e&&Ro(e,t)?e[t]:void 0),e):void 0,nh={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},Yo=(e,t)=>{const n={};return ee(xt(Pe(t),Pe(e)),(s=>{const i=e[s],o=t[s];if(nn(i)&&nn(o))Q(n[s]={},Yo(i,o)),Es(n[s])&&delete n[s];else if(Ro(t,s)&&o!==i){let e=!0;if(De(i)||De(o))try{gi(i)===gi(o)&&(e=!1)}catch{}e&&(n[s]=o)}})),n},vi=(e,t,n)=>s=>[yi(e,s),n||void 0!==yi(t,s)],ht="data-overlayscrollbars",jt="os-environment",zt=`${jt}-scrollbar-hidden`,Ln=`${ht}-initialize`,Wt="noClipping",ki=`${ht}-body`,We=ht,sh="host",Ue=`${ht}-viewport`,ih=Io,oh=Mo,rh="arrange",Xo="measuring",ah="scrolling",Jo="scrollbarHidden",lh="noContent",os=`${ht}-padding`,wi=`${ht}-content`,Is="os-size-observer",ch=`${Is}-appear`,dh=`${Is}-listener`,hh="os-trinsic-observer",uh="os-theme-none",Ee="os-scrollbar",ph=`${Ee}-rtl`,fh=`${Ee}-horizontal`,mh=`${Ee}-vertical`,er=`${Ee}-track`,Ms=`${Ee}-handle`,gh=`${Ee}-visible`,yh=`${Ee}-cornerless`,bi=`${Ee}-interaction`,$i=`${Ee}-unusable`,rs=`${Ee}-auto-hide`,xi=`${rs}-hidden`,Ci=`${Ee}-wheel`,vh=`${er}-interactive`,kh=`${Ms}-interactive`;let tr;const wh=()=>tr,bh=e=>{tr=e};let An;const $h=()=>{const e=(e,t,n)=>{xe(document.body,e),xe(document.body,e);const s=Vo(e),i=rt(e),o=Ps(t);return n&&lt(e),{x:i.h-s.h+o.h,y:i.w-s.w+o.w}},t=No(`<div class="${jt}"><div></div><style>${`.${jt}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${jt} div{width:200%;height:200%;margin:10px 0}.${zt}{scrollbar-width:none!important}.${zt}::-webkit-scrollbar,.${zt}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`}</style></div>`)[0],n=t.firstChild,s=t.lastChild,i=wh();i&&(s.nonce=i);const[o,,r]=is(),[a,l]=be({o:e(t,n),i:Nt},q(e,t,n,!0)),[c]=l(),h=(e=>{let t=!1;const n=_s(e,zt);try{t="none"===ze(e,"scrollbar-width")||"none"===ze(e,"display","::-webkit-scrollbar")}catch{}return n(),t})(t),d={x:0===c.x,y:0===c.y},u={elements:{host:null,padding:!h,viewport:e=>h&&Ho(e)&&e,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},p=Q({},nh),m=q(Q,{},p),g=q(Q,{},u),f={T:c,k:d,R:h,V:!!Ht,L:q(o,"r"),U:g,P:e=>Q(u,e)&&g(),N:m,q:e=>Q(p,e)&&m(),B:Q({},u),F:Q({},p)};if(Me(t,"style"),lt(t),ie(ke,"resize",(()=>{r("r",[])})),_e(ke.matchMedia)&&!h&&(!d.x||!d.y)){const e=t=>{const n=ke.matchMedia(`(resolution: ${ke.devicePixelRatio}dppx)`);ie(n,"change",(()=>{t(),e(t)}),{A:!0})};e((()=>{const[e,t]=a();Q(f.T,e),r("r",[t])}))}return f},Be=()=>(An||(An=$h()),An),nr=(e,t)=>_e(t)?t.apply(0,e):t,xh=(e,t,n,s)=>{const i=$s(s)?n:s;return nr(e,i)||t.apply(0,e)},sr=(e,t,n,s)=>{const i=$s(s)?n:s,o=nr(e,i);return!!o&&(on(o)?o:t.apply(0,e))},Ch=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{k:i,R:o,U:r}=Be(),{nativeScrollbarsOverlaid:a,body:l}=r().cancel,c=n??a,h=$s(s)?l:s,d=(i.x||i.y)&&c,u=e&&(dn(h)?!o:h);return!!d||!!u},Os=new WeakMap,Sh=(e,t)=>{Os.set(e,t)},Eh=e=>{Os.delete(e)},ir=e=>Os.get(e),Th=(e,t,n)=>{let s=!1;const i=!!n&&new WeakMap,o=o=>{if(i&&n){ee(n.map((t=>{const[n,s]=t||[];return[s&&n?(o||zo)(n,e):[],s]})),(n=>ee(n[0],(o=>{const r=n[1],a=i.get(o)||[];if(e.contains(o)&&r){const e=ie(o,r,(n=>{s?(e(),i.delete(o)):t(n)}));i.set(o,ae(a,e))}else Se(a),i.delete(o)}))))}};return o(),[()=>{s=!0},o]},Si=(e,t,n,s)=>{let i=!1;const{j:o,X:r,Y:a,W:l,J:c,G:h}=s||{},d=Qn((()=>i&&n(!0)),{_:33,v:99}),[u,p]=Th(e,d,a),m=r||[],g=xt(o||[],m),f=(i,o)=>{if(!Kn(o)){const r=c||Ye,a=h||Ye,d=[],u=[];let g=!1,f=!1;if(ee(o,(n=>{const{attributeName:i,target:o,type:c,oldValue:h,addedNodes:p,removedNodes:y}=n,k="attributes"===c,w="childList"===c,v=e===o,b=k&&i,$=b&&Ts(o,i||""),x=Lt($)?$:null,E=b&&h!==x,C=Co(m,i)&&E;if(t&&(w||!v)){const t=k&&E,c=t&&l&&Yn(o,l),u=(c?!r(o,i,h,x):!k||t)&&!a(n,!!c,e,s);ee(p,(e=>ae(d,e))),ee(y,(e=>ae(d,e))),f=f||u}!t&&v&&E&&!r(o,i,h,x)&&(ae(u,i),g=g||C)})),p((e=>Zn(d).reduce(((t,n)=>(ae(t,zo(e,n)),Yn(n,e)?ae(t,n):t)),[]))),t)return!i&&f&&n(!1),[!1];if(!Kn(u)||g){const e=[Zn(u),g];return!i&&n.apply(0,e),e}}},y=new Wd(q(f,!1));return[()=>(y.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:g,subtree:t,childList:t,characterData:t}),i=!0,()=>{i&&(u(),y.disconnect(),i=!1)}),()=>{if(i)return d.m(),f(!0,y.takeRecords())}]},or={},rr={},Lh=e=>{ee(e,(e=>ee(e,((t,n)=>{or[n]=e[n]}))))},ar=(e,t,n)=>Pe(e).map((s=>{const{static:i,instance:o}=e[s],[r,a,l]=n||[],c=n?o:i;if(c){const e=n?c(r,a,t):c(t);return(l||rr)[s]=e}})),At=e=>rr[e],Ah="__osOptionsValidationPlugin",_h="__osSizeObserverPlugin",Ph=(e,t)=>{const{k:n}=t,[s,i]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,i]},ct=e=>0===e.indexOf(Ne),Ih=(e,t)=>{const n=(e,t,n,s)=>{const i=e===Ne?Qe:e.replace(`${Ne}-`,""),o=ct(e),r=ct(n);return t||s?o&&r?Ne:o?t&&s?i:t?Ne:Qe:t?i:r&&s?Ne:Qe:Qe},s={x:n(t.x,e.x,t.y,e.y),y:n(t.y,e.y,t.x,e.x)};return{K:s,Z:{x:s.x===at,y:s.y===at}}},lr="__osScrollbarsHidingPlugin",Mh="__osClickScrollPlugin",cr=(e,t,n)=>{const{dt:s}=n||{},i=At(_h),[o]=be({o:!1,u:!0});return()=>{const n=[],r=No(`<div class="${Is}"><div class="${dh}"></div></div>`)[0],a=r.firstChild,l=e=>{let n=!1,s=!1;if(e instanceof ResizeObserverEntry){const[t,,i]=o(e.contentRect),r=ts(t);s=Go(t,i),n=!s&&!r}else s=!0===e;n||t({ft:!0,dt:s})};if(tn){const e=new tn((e=>l(e.pop())));e.observe(a),ae(n,(()=>{e.disconnect()}))}else{if(!i)return Ye;{const[e,t]=i(a,l,s);ae(n,xt([_s(r,ch),ie(r,"animationstart",e)],t))}}return q(Se,ae(n,xe(e,r)))}},Oh=(e,t)=>{let n;const s=ot(hh),[i]=be({o:!1}),o=(e,n)=>{if(e){const s=i((e=>0===e.h||e.isIntersecting||e.intersectionRatio>0)(e)),[,o]=s;return o&&!n&&t(s)&&[s]}},r=(e,t)=>o(t.pop(),e);return[()=>{const t=[];if(li)n=new li(q(r,!1),{root:e}),n.observe(s),ae(t,(()=>{n.disconnect()}));else{const e=()=>{const e=rt(s);o(e)};ae(t,cr(s,e)()),e()}return q(Se,ae(t,xe(e,s)))},()=>n&&r(!0,n.takeRecords())]},Rh=(e,t,n,s)=>{let i,o,r,a,l,c;const h=`[${We}]`,d=`[${Ue}]`,u=["id","class","style","open","wrap","cols","rows"],{vt:p,ht:m,ot:g,gt:f,bt:y,nt:k,wt:w,yt:v,St:b,Ot:$}=e,x=e=>"rtl"===ze(e,"direction"),E={$t:!1,ct:x(p)},C=Be(),S=At(lr),[T]=be({i:Oo,o:{w:0,h:0}},(()=>{const s=S&&S.tt(e,t,E,C,n).ut,i=!(w&&k)&&As(m,We,Wt),o=!k&&v(rh),r=o&&Ce(f),a=r&&$(),l=b(Xo,i),c=o&&s&&s()[0],h=an(g),d=Ps(g);return c&&c(),Oe(f,r),a&&a(),i&&l(),{w:h.w+d.w,h:h.h+d.h}})),L=Qn(s,{_:()=>i,v:()=>o,S(e,t){const[n]=e,[s]=t;return[xt(Pe(n),Pe(s)).reduce(((e,t)=>(e[t]=n[t]||s[t],e)),{})]}}),A=e=>{const t=x(p);Q(e,{Ct:c!==t}),Q(E,{ct:t}),c=t},P=(e,t)=>{const[n,i]=e,o={xt:i};return Q(E,{$t:n}),!t&&s(o),o},M=({ft:e,dt:t})=>{const n=e&&!t||!C.R?s:L,i={ft:e||t,dt:t};A(i),n(i)},q=(e,t)=>{const[,n]=T(),i={Ht:n};return A(i),n&&!t&&(e?s:L)(i),i},I=(e,t,n)=>{const s={Et:t};return A(s),t&&!n&&L(s),s},[_,R]=y?Oh(m,P):[],O=!k&&cr(m,M,{dt:!0}),[D,U]=Si(m,!1,I,{X:u,j:u}),B=k&&tn&&new tn((e=>{const t=e[e.length-1].contentRect;M({ft:!0,dt:Go(t,l)}),l=t})),j=Qn((()=>{const[,e]=T();s({Ht:e})}),{_:222,p:!0});return[()=>{B&&B.observe(m);const e=O&&O(),t=_&&_(),n=D(),s=C.L((e=>{e?L({zt:e}):j()}));return()=>{B&&B.disconnect(),e&&e(),t&&t(),a&&a(),n(),s()}},({It:e,At:t,Dt:n})=>{const s={},[l]=e("update.ignoreMutation"),[c,p]=e("update.attributes"),[m,f]=e("update.elementEvents"),[w,v]=e("update.debounce"),b=t||n;if(f||p){r&&r(),a&&a();const[e,t]=Si(y||g,!0,q,{j:xt(u,c||[]),Y:m,W:h,G:(e,t)=>{const{target:n,attributeName:s}=e;return!(t||!s||k)&&Zd(n,h,d)||!!it(n,`.${Ee}`)||!!(e=>_e(l)&&l(e))(e)}});a=e(),r=t}if(v)if(L.m(),De(w)){const e=w[0],t=w[1];i=Re(e)&&e,o=Re(t)&&t}else Re(w)?(i=w,o=!1):(i=!1,o=!1);if(b){const e=U(),t=R&&R(),n=r&&r();e&&Q(s,I(e[0],e[1],b)),t&&Q(s,P(t[0],b)),n&&Q(s,q(n[0],b))}return A(s),s},E]},Dh=(e,t,n,s)=>{const i="--os-viewport-percent",o="--os-scroll-percent",r="--os-scroll-direction",{U:a}=Be(),{scrollbars:l}=a(),{slot:c}=l,{vt:h,ht:d,ot:u,Mt:p,gt:m,wt:g,nt:f}=t,{scrollbars:y}=p?{}:e,{slot:k}=y||{},w=[],v=[],b=[],$=sr([h,d,u],(()=>f&&g?h:d),c,k),x=e=>{if(Ht){const t=new Ht({source:m,axis:e});return{kt:e=>{const n=e.Tt.animate({clear:["left"],[o]:[0,1]},{timeline:t});return()=>n.cancel()}}}},E={x:x("x"),y:x("y")},C=(e,t,n)=>{const s=n?_s:Fo;ee(e,(e=>{s(e.Tt,t)}))},S=(e,t)=>{ee(e,(e=>{const[n,s]=t(e);St(n,s)}))},T=(e,t,n)=>{const s=xs(n),i=!s||!n;(!s||n)&&C(v,e,t),i&&C(b,e,t)},L=e=>{const t=e?"x":"y",n=ot(`${Ee} ${e?fh:mh}`),i=ot(er),o=ot(Ms),r={Tt:n,Ut:i,Pt:o},a=E[t];return ae(e?v:b,r),ae(w,[xe(n,i),xe(i,o),q(lt,n),a&&a.kt(r),s(r,T,e)]),r},A=q(L,!0),P=q(L,!1);return A(),P(),[{Nt:()=>{const e=(()=>{const{Rt:e,Vt:t}=n,s=(e,t)=>Bo(0,1,e/(e+t)||0);return{x:s(t.x,e.x),y:s(t.y,e.y)}})(),t=e=>t=>[t.Tt,{[i]:es(e)+""}];S(v,t(e.x)),S(b,t(e.y))},qt:()=>{if(!Ht){const{Lt:e}=n,t=fi(e,Ce(m)),s=e=>t=>[t.Tt,{[o]:es(e)+""}];S(v,s(t.x)),S(b,s(t.y))}},Bt:()=>{const{Lt:e}=n,t=pi(e),s=e=>t=>[t.Tt,{[r]:e?"0":"1"}];S(v,s(t.x)),S(b,s(t.y))},Ft:()=>{if(f&&!g){const{Rt:e,Lt:t}=n,s=pi(t),i=fi(t,Ce(m)),o=t=>{const{Tt:n}=t,o=Ct(n)===u&&n,r=(e,t,n)=>{const s=t*e;return Wo(n?s:-s)};return[o,o&&{transform:Qd({x:r(i.x,e.x,s.x),y:r(i.y,e.y,s.y)})}]};S(v,o),S(b,o)}},jt:T,Xt:{Yt:v,Wt:A,Jt:q(S,v)},Gt:{Yt:b,Wt:P,Jt:q(S,b)}},()=>(xe($,v[0].Tt),xe($,b[0].Tt),q(Se,w))]},Bh=(e,t,n,s)=>(i,o,r)=>{const{ht:a,ot:l,nt:c,gt:h,Kt:d,Ot:u}=t,{Tt:p,Ut:m,Pt:g}=i,[f,y]=st(333),[k,w]=st(444),v=e=>{_e(h.scrollBy)&&h.scrollBy({behavior:"smooth",left:e.x,top:e.y})};let b=!0;return q(Se,[ie(g,"pointermove pointerleave",s),ie(p,"pointerenter",(()=>{o(bi,!0)})),ie(p,"pointerleave pointercancel",(()=>{o(bi,!1)})),!c&&ie(p,"mousedown",(()=>{const e=Jn();(ci(e,Ue)||ci(e,We)||e===document.body)&&en(q(ss,l),25)})),ie(p,"wheel",(e=>{const{deltaX:t,deltaY:n,deltaMode:s}=e;b&&0===s&&Ct(p)===a&&v({x:t,y:n}),b=!1,o(Ci,!0),f((()=>{b=!0,o(Ci)})),ns(e)}),{H:!1,I:!0}),ie(p,"pointerdown",q(ie,d,"click",Zo,{A:!0,I:!0,H:!1}),{I:!0}),(()=>{const t="pointerup pointercancel lostpointercapture",s="client"+(r?"X":"Y"),i=r?un:pn,o=r?"left":"top",a=r?"w":"h",l=r?"x":"y",c=[];return ie(m,"pointerdown",(r=>{const p=it(r.target,`.${Ms}`)===g,f=p?g:m,y=e.scrollbars,b=y[p?"dragScroll":"clickScroll"],{button:$,isPrimary:x,pointerType:E}=r,{pointers:C}=y;if(0===$&&x&&b&&(C||[]).includes(E)){Se(c),w();const e=!p&&(r.shiftKey||"instant"===b),y=q(Tn,g),$=q(Tn,m),x=(e,t)=>(e||y())[o]-(t||$())[o],E=Vn(Tn(h)[i])/rt(h)[a]||1,C=((e,t)=>s=>{const{Rt:i}=n,o=rt(m)[a]-rt(g)[a],r=t*s/o*i[l];Oe(h,{[l]:e+r})})(Ce(h)[l],1/E),S=r[s],T=y(),L=$(),A=T[i],P=x(T,L)+A/2,M=S-L[o],I=p?0:M-P,_=e=>{Se(D),f.releasePointerCapture(e.pointerId)},R=p||e,O=u(),D=[ie(d,t,_),ie(d,"selectstart",(e=>ns(e)),{H:!1}),ie(m,t,_),R&&ie(m,"pointermove",(e=>C(I+(e[s]-S)))),R&&(()=>{const e=Ce(h);O();const t=Ce(h),n={x:t.x-e.x,y:t.y-e.y};(Jt(n.x)>3||Jt(n.y)>3)&&(u(),Oe(h,e),v(n),k(O))})];if(f.setPointerCapture(r.pointerId),e)C(I);else if(!p){const e=At(Mh);if(e){const t=e(C,I,A,(e=>{e?O():ae(D,O)}));ae(D,t),ae(c,q(t,!0))}}}}))})(),y,w])},qh=(e,t,n,s,i,o)=>{let r,a,l,c,h,d=Ye,u=0;const p=e=>"mouse"===e.pointerType,[m,g]=st(),[f,y]=st(100),[k,w]=st(100),[v,b]=st((()=>u)),[$,x]=Dh(e,i,s,Bh(t,i,s,(e=>p(e)&&_()))),{ht:E,Qt:C,wt:S}=i,{jt:T,Nt:L,qt:A,Bt:P,Ft:M}=$,I=(e,t)=>{if(b(),e)T(xi);else{const e=q(T,xi,!0);u>0&&!t?v(e):e()}},_=()=>{(l?!r:!c)&&(I(!0),f((()=>{I(!1)})))},R=e=>{T(rs,e,!0),T(rs,e,!1)},O=e=>{p(e)&&(r=l,l&&I(!0))},D=[b,y,w,g,()=>d(),ie(E,"pointerover",O,{A:!0}),ie(E,"pointerenter",O),ie(E,"pointerleave",(e=>{p(e)&&(r=!1,l&&I(!1))})),ie(E,"pointermove",(e=>{p(e)&&a&&_()})),ie(C,"scroll",(e=>{m((()=>{A(),_()})),o(e),M()}))];return[()=>q(Se,ae(D,x())),({It:e,Dt:t,Zt:i,tn:o})=>{const{nn:r,sn:p,en:m,cn:g}=o||{},{Ct:f,dt:y}=i||{},{ct:w}=n,{k:v}=Be(),{K:b,rn:$}=s,[x,E]=e("showNativeOverlaidScrollbars"),[_,O]=e("scrollbars.theme"),[D,U]=e("scrollbars.visibility"),[B,j]=e("scrollbars.autoHide"),[F,z]=e("scrollbars.autoHideSuspend"),[N]=e("scrollbars.autoHideDelay"),[W,H]=e("scrollbars.dragScroll"),[G,Q]=e("scrollbars.clickScroll"),[V,Z]=e("overflow"),K=y&&!t,J=$.x||$.y,Y=r||p||g||f||t,X=m||U||Z,ee=x&&v.x&&v.y,te=(e,t,n)=>{const s=e.includes(at)&&(D===Ne||"auto"===D&&t===at);return T(gh,s,n),s};if(u=N,K&&(F&&J?(R(!1),d(),k((()=>{d=ie(C,"scroll",q(R,!0),{A:!0})}))):R(!0)),E&&T(uh,ee),O&&(T(h),T(_,!0),h=_),z&&!F&&R(!0),j&&(a="move"===B,l="leave"===B,c="never"===B,I(c,!0)),H&&T(kh,W),Q&&T(vh,!!G),X){const e=te(V.x,b.x,!0),t=te(V.y,b.y,!1);T(yh,!(e&&t))}Y&&(A(),L(),M(),g&&P(),T($i,!$.x,!0),T($i,!$.y,!1),T(ph,w&&!S))},{},$]},Uh=e=>{const t=Be(),{U:n,R:s}=t,{elements:i}=n(),{padding:o,viewport:r,content:a}=i,l=on(e),c=l?{}:e,{elements:h}=c,{padding:d,viewport:u,content:p}=h||{},m=l?e:c.target,g=Ho(m),f=m.ownerDocument,y=f.documentElement,k=()=>f.defaultView||ke,w=q(xh,[m]),v=q(sr,[m]),b=q(ot,""),$=q(w,b,r),x=q(v,b,a),E=$(u),C=E===m,S=C&&g,T=!C&&x(p),L=!C&&E===T,A=S?y:E,P=S?A:m,M=!C&&v(b,o,d),I=!L&&T,_=[I,A,M,P].map((e=>on(e)&&!Ct(e)&&e)),R=e=>e&&Co(_,e),O=!R(A)&&(e=>{const t=rt(e),n=an(e),s=ze(e,Io),i=ze(e,Mo);return n.w-t.w>0&&!ct(s)||n.h-t.h>0&&!ct(i)})(A)?A:m,D=S?y:A,U={vt:m,ht:P,ot:A,ln:M,bt:I,gt:D,Qt:S?f:A,an:g?y:O,Kt:f,wt:g,Mt:l,nt:C,un:k,yt:e=>As(A,Ue,e),St:(e,t)=>rn(A,Ue,e,t),Ot:()=>rn(D,Ue,ah,!0)},{vt:B,ht:j,ln:F,ot:z,bt:N}=U,W=[()=>{Me(j,[We,Ln]),Me(B,Ln),g&&Me(y,[Ln,We])}];let H=Xn([N,z,F,j,B].find((e=>e&&!R(e))));const G=S?B:N||z,Q=q(Se,W);return[U,()=>{const e=k(),t=Jn(),n=e=>{xe(Ct(e),Xn(e)),lt(e)},i=e=>ie(e,"focusin focusout focus blur",Zo,{I:!0,H:!1}),o="tabindex",r=Ts(z,o),a=i(t);return qe(j,We,C?"":sh),qe(F,os,""),qe(z,Ue,""),qe(N,wi,""),C||(qe(z,o,r||"-1"),g&&qe(y,ki,"")),xe(G,H),xe(j,F),xe(F||j,!C&&z),xe(z,N),ae(W,[a,()=>{const e=Jn(),t=R(z),s=t&&e===z?B:e,a=i(s);Me(F,os),Me(N,wi),Me(z,Ue),g&&Me(y,ki),r?qe(z,o,r):Me(z,o),R(N)&&n(N),t&&n(z),R(F)&&n(F),ss(s),a()}]),s&&!C&&(Ls(z,Ue,Jo),ae(W,q(Me,z,Ue))),ss(!C&&g&&t===B&&e.top===e?z:t),a(),H=0,Q},Q]},Fh=({bt:e})=>({Zt:t,_n:n,Dt:s})=>{const{xt:i}=t||{},{$t:o}=n;e&&(i||s)&&St(e,{[pn]:o&&"100%"})},zh=({ht:e,ln:t,ot:n,nt:s},i)=>{const[o,r]=be({i:Gd,o:hi()},q(hi,e,"padding",""));return({It:e,Zt:a,_n:l,Dt:c})=>{let[h,d]=r(c);const{R:u}=Be(),{ft:p,Ht:m,Ct:g}=a||{},{ct:f}=l,[y,k]=e("paddingAbsolute");(p||d||c||m)&&([h,d]=o(c));const w=!s&&(k||g||d);if(w){const e=!y||!t&&!u,s=h.r+h.l,o=h.t+h.b,r={[_o]:e&&!f?-s:0,[Po]:e?-o:0,[Ao]:e&&f?-s:0,top:e?-h.t:0,right:e?f?-h.r:"auto":0,left:e?f?"auto":-h.l:0,[un]:e&&`calc(100% + ${s}px)`},a={[So]:e?h.t:0,[Eo]:e?h.r:0,[Lo]:e?h.b:0,[To]:e?h.l:0};St(t||n,r),St(n,a),Q(i,{ln:h,dn:!e,rt:t?a:Q({},r,a)})}return{fn:w}}},Hh=(e,t)=>{const n=Be(),{ht:s,ln:i,ot:o,nt:r,Qt:a,gt:l,wt:c,St:h,un:d}=e,{R:u}=n,p=c&&r,m=q($o,0),g={display:()=>!1,direction:e=>"ltr"!==e,flexDirection:e=>e.endsWith("-reverse"),writingMode:e=>"horizontal-tb"!==e},f=Pe(g),y={i:Oo,o:{w:0,h:0}},k={i:Nt,o:{}},w=e=>{h(Xo,!p&&e)},[v,b]=be(y,q(Ps,o)),[$,x]=be(y,q(an,o)),[E,C]=be(y),[S]=be(k),[T,L]=be(y),[A]=be(k),[P]=be({i:(e,t)=>fn(e,t,f),o:{}},(()=>eh(o)?ze(o,f):{})),[M,I]=be({i:(e,t)=>Nt(e.D,t.D)&&Nt(e.M,t.M),o:Qo()}),_=At(lr),R=(e,t)=>`${t?ih:oh}${Vd(e)}`;return({It:r,Zt:c,_n:y,Dt:k},{fn:q})=>{const{ft:O,Ht:D,Ct:U,dt:B,zt:j}=c||{},F=_&&_.tt(e,t,y,n,r),{it:z,ut:N,_t:W}=F||{},[H,G]=Ph(r,n),[V,Z]=r("overflow"),K=ct(V.x),J=ct(V.y);let Y=b(k),X=x(k),ee=C(k),te=L(k);G&&u&&h(Jo,!H);{As(s,We,Wt)&&w(!0);const[e]=N?N():[],[t]=Y=v(k),[n]=X=$(k),i=Vo(o),r=p&&Jd(d()),a={w:m(n.w+t.w),h:m(n.h+t.h)},l={w:m((r?r.w:i.w+m(i.w-n.w))+t.w),h:m((r?r.h:i.h+m(i.h-n.h))+t.h)};e&&e(),te=T(l),ee=E(((e,t)=>{const n=ke.devicePixelRatio%1!=0?1:0,s={w:m(e.w-t.w),h:m(e.h-t.h)};return{w:s.w>n?s.w:0,h:s.h>n?s.h:0}})(a,l),k)}const[ne,se]=te,[oe,re]=ee,[ae,le]=X,[ce,he]=Y,[de,ue]=S({x:oe.w>0,y:oe.h>0}),pe=K&&J&&(de.x||de.y)||K&&de.x&&!de.y||J&&de.y&&!de.x,me=q||U||j||he||le||se||re||Z||G||!0,ge=Ih(de,V),[fe,ye]=A(ge.K),[we,ve]=P(k),be=U||B||ve||ue||k,[$e,xe]=be?M((e=>{if(!f.some((t=>{const n=e[t];return n&&g[t](n)})))return{D:{x:0,y:0},M:{x:1,y:1}};w(!0);const t=Ce(l),n=h(lh,!0),s=ie(a,at,(e=>{const n=Ce(l);e.isTrusted&&n.x===t.x&&n.y===t.y&&Ko(e)}),{I:!0,A:!0});Oe(l,{x:0,y:0}),n();const i=Ce(l),o=an(l);Oe(l,{x:o.w,y:o.h});const r=Ce(l);Oe(l,{x:r.x-i.x<1&&-o.w,y:r.y-i.y<1&&-o.h});const c=Ce(l);return Oe(l,t),bs((()=>s())),{D:i,M:c}})(we),k):I();return me&&(ye&&(e=>{const t=e=>[Ne,Qe,at].map((t=>R(t,e))),n=t(!0).concat(t()).join(" ");h(n),h(Pe(e).map((t=>R(e[t],"x"===t))).join(" "),!0)})(ge.K),W&&z&&St(o,W(ge,y,z(ge,ae,ce)))),w(!1),rn(s,We,Wt,pe),rn(i,os,Wt,pe),Q(t,{K:fe,Vt:{x:ne.w,y:ne.h},Rt:{x:oe.w,y:oe.h},rn:de,Lt:th($e,oe)}),{en:ye,nn:se,sn:re,cn:xe||re,vn:be}}},Nh=e=>{const[t,n,s]=Uh(e),i={ln:{t:0,r:0,b:0,l:0},dn:!1,rt:{[_o]:0,[Po]:0,[Ao]:0,[So]:0,[Eo]:0,[Lo]:0,[To]:0},Vt:{x:0,y:0},Rt:{x:0,y:0},K:{x:Qe,y:Qe},rn:{x:!1,y:!1},Lt:Qo()},{vt:o,gt:r,nt:a,Ot:l}=t,{R:c,k:h}=Be(),d=!c&&(h.x||h.y),u=[Fh(t),zh(t,i),Hh(t,i)];return[n,e=>{const t={},n=d&&Ce(r),s=n&&l();return ee(u,(n=>{Q(t,n(e,t)||{})})),Oe(r,n),s&&s(),!a&&Oe(o,0),t},i,t,s]},jh=(e,t,n,s,i)=>{let o=!1;const r=vi(t,{}),[a,l,c,h,d]=Nh(e),[u,p,m]=Rh(h,c,r,(e=>{w({},e)})),[g,f,,y]=qh(e,t,m,c,h,i),k=e=>Pe(e).some((t=>!!e[t])),w=(e,i)=>{if(n())return!1;const{pn:r,Dt:a,At:c,hn:h}=e,d=r||{},u=!!a||!o,g={It:vi(t,d,u),pn:d,Dt:u};if(h)return f(g),!1;const y=i||p(Q({},g,{At:c})),w=l(Q({},g,{_n:m,Zt:y}));f(Q({},g,{Zt:y,tn:w}));const v=k(y),b=k(w),$=v||b||!Es(d)||u;return o=!0,$&&s(e,{Zt:y,tn:w}),$};return[()=>{const{an:e,gt:t,Ot:n}=h,s=Ce(e),i=[u(),a(),g()],o=n();return Oe(t,s),o(),q(Se,i)},w,()=>({gn:m,bn:c}),{wn:h,yn:y},d]},Ve=(e,t,n)=>{const{N:s}=Be(),i=on(e),o=i?e:e.target,r=ir(o);if(t&&!r){let r=!1;const a=[],l={},c=e=>{const t=Do(e),n=At(Ah);return n?n(t,!0):t},h=Q({},s(),c(t)),[d,u,p]=is(),[m,g,f]=is(n),y=(e,t)=>{f(e,t),p(e,t)},[k,w,v,b,$]=jh(e,h,(()=>r),(({pn:e,Dt:t},{Zt:n,tn:s})=>{const{ft:i,Ct:o,xt:r,Ht:a,Et:l,dt:c}=n,{nn:h,sn:d,en:u,cn:p}=s;y("updated",[E,{updateHints:{sizeChanged:!!i,directionChanged:!!o,heightIntrinsicChanged:!!r,overflowEdgeChanged:!!h,overflowAmountChanged:!!d,overflowStyleChanged:!!u,scrollCoordinatesChanged:!!p,contentMutation:!!a,hostMutation:!!l,appear:!!c},changedOptions:e||{},force:!!t}])}),(e=>y("scroll",[E,e]))),x=e=>{Eh(o),Se(a),r=!0,y("destroyed",[E,e]),u(),g()},E={options(e,t){if(e){const n=t?s():{},i=Yo(h,Q(n,c(e)));Es(i)||(Q(h,i),w({pn:i}))}return Q({},h)},on:m,off:(e,t)=>{e&&t&&g(e,t)},state(){const{gn:e,bn:t}=v(),{ct:n}=e,{Vt:s,Rt:i,K:o,rn:a,ln:l,dn:c,Lt:h}=t;return Q({},{overflowEdge:s,overflowAmount:i,overflowStyle:o,hasOverflow:a,scrollCoordinates:{start:h.D,end:h.M},padding:l,paddingAbsolute:c,directionRTL:n,destroyed:r})},elements(){const{vt:e,ht:t,ln:n,ot:s,bt:i,gt:o,Qt:r}=b.wn,{Xt:a,Gt:l}=b.yn,c=e=>{const{Pt:t,Ut:n,Tt:s}=e;return{scrollbar:s,track:n,handle:t}},h=e=>{const{Yt:t,Wt:n}=e,s=c(t[0]);return Q({},s,{clone:()=>{const e=c(n());return w({hn:!0}),e}})};return Q({},{target:e,host:t,padding:n||s,viewport:s,content:i||s,scrollOffsetElement:o,scrollEventElement:r,scrollbarHorizontal:h(a),scrollbarVertical:h(l)})},update:e=>w({Dt:e,At:!0}),destroy:q(x,!1),plugin:e=>l[Pe(e)[0]]};return ae(a,[$]),Sh(o,E),ar(or,Ve,[E,d,l]),Ch(b.wn.wt,!i&&e.cancel)?(x(!0),E):(ae(a,k()),y("initialized",[E]),E.update(),E)}return r};Ve.plugin=e=>{const t=De(e),n=t?e:[e],s=n.map((e=>ar(e,Ve)[0]));return Lh(n),t?s:s[0]},Ve.valid=e=>{const t=e&&e.elements,n=_e(t)&&t();return sn(n)&&!!ir(n.target)},Ve.env=()=>{const{T:e,k:t,R:n,V:s,B:i,F:o,U:r,P:a,N:l,q:c}=Be();return Q({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:i,staticDefaultOptions:o,getDefaultInitialization:r,setDefaultInitialization:a,getDefaultOptions:l,setDefaultOptions:c})},Ve.nonce=bh;const dr=!!document.getElementById("banner-wrapper");function Rs(e,t){document.addEventListener("click",(n=>{let s=document.getElementById(e),i=n.target;if(i instanceof Node){for(let e of t){let t=document.getElementById(e);if(t==i||t?.contains(i))return}s.classList.add("float-panel-closed")}}))}function Wh(){const e=wr();br(e)}function Vh(){$r(xr())}function hr(){const e=document.querySelector("body");e&&(Ve({target:e,cancel:{nativeScrollbarsOverlaid:!0}},{scrollbars:{theme:"scrollbar-base scrollbar-auto py-1",autoHide:"move",autoHideDelay:500,autoHideSuspend:!1}}),document.querySelectorAll("pre").forEach((e=>{Ve(e,{scrollbars:{theme:"scrollbar-base scrollbar-dark px-2",autoHide:"leave",autoHideDelay:500,autoHideSuspend:!1}})})))}function Gh(){const e=document.getElementById("banner");e?e.classList.remove("opacity-0","scale-105"):console.error("Failed to find the banner element")}function ur(){Wh(),Vh(),hr(),Gh()}Rs("display-setting",["display-setting","display-settings-switch"]),Rs("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]),Rs("search-panel",["search-panel","search-bar","search-switch"]),ur(),document.addEventListener("astro:after-swap",ur);const Ei=()=>{window.swup.hooks.on("link:click",(()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),!dr)return;let e=.3*window.innerHeight-72-16,t=document.getElementById("navbar-wrapper");!t||!document.body.classList.contains("lg:is-home")||(document.body.scrollTop>=e||document.documentElement.scrollTop>=e)&&t.classList.add("navbar-hidden")})),window.swup.hooks.on("content:replace",hr),window.swup.hooks.on("visit:start",(e=>{const t=document.querySelector("body");Cr(e.to.url,Sr("/"))?t.classList.add("lg:is-home"):t.classList.remove("lg:is-home");const n=document.getElementById("page-height-extend");n&&n.classList.remove("hidden")})),window.swup.hooks.on("page:view",(()=>{const e=document.getElementById("page-height-extend");e&&e.classList.remove("hidden")})),window.swup.hooks.on("visit:end",(e=>{const t=document.getElementById("page-height-extend");t&&t.classList.add("hidden")}))};window?.swup?.hooks?Ei():document.addEventListener("swup:enable",Ei);let _n=document.getElementById("back-to-top-btn"),Pn=document.getElementById("navbar-wrapper");function Kh(){if(_n&&(document.body.scrollTop>600||document.documentElement.scrollTop>600?_n.classList.remove("hide"):_n.classList.add("hide")),dr&&Pn){let e=.3*window.innerHeight-72-16;document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024&&(e=.6*window.innerHeight-72-16),document.body.scrollTop>=e||document.documentElement.scrollTop>=e?Pn.classList.add("navbar-hidden"):Pn.classList.remove("navbar-hidden")}}function Zh(){"dark"===localStorage.theme?(document.documentElement.classList.remove("dark"),localStorage.theme="light"):(document.documentElement.classList.add("dark"),localStorage.theme="dark")}function pr(){let e=document.getElementById("scheme-switch");e&&e.addEventListener("click",(function(){Zh()}));let t=document.getElementById("display-settings-switch");t&&t.addEventListener("click",(function(){let e=document.getElementById("display-setting");e&&e.classList.toggle("float-panel-closed")}));let n=document.getElementById("nav-menu-switch");n&&n.addEventListener("click",(function(){let e=document.getElementById("nav-menu-panel");e&&e.classList.toggle("float-panel-closed")}))}window.onscroll=Kh,pr(),document.addEventListener("astro:after-swap",(()=>{pr()}),{once:!1});class Qh extends HTMLElement{constructor(){if(super(),"true"!==this.dataset.isCollapsed)return;const e=this.dataset.id,t=this.querySelector(".expand-btn"),n=this.querySelector(`#${e}`);t.addEventListener("click",(()=>{n.classList.remove("collapsed"),t.classList.add("hidden")}))}}customElements.define("widget-layout",Qh);